<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.78.2"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Your First Dubbo Filter | Apache Dubbo</title><meta property="og:title" content="Your First Dubbo Filter"><meta property="og:description" content="This article will introduce you that how to implement a dubbo filter"><meta property="og:type" content="article"><meta property="og:url" content="/blog/2018/07/01/your-first-dubbo-filter/"><meta property="article:published_time" content="2018-07-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-11-16T19:43:34+08:00"><meta property="og:site_name" content="Apache Dubbo"><meta itemprop=name content="Your First Dubbo Filter"><meta itemprop=description content="This article will introduce you that how to implement a dubbo filter"><meta itemprop=datePublished content="2018-07-01T00:00:00+00:00"><meta itemprop=dateModified content="2020-11-16T19:43:34+08:00"><meta itemprop=wordCount content="824"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Your First Dubbo Filter"><meta name=twitter:description content="This article will introduce you that how to implement a dubbo filter"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-112489517-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preload href=/scss/main.min.b8ee4a8008ba3340c2f9a4386c269cfd0c363b329f020f483656c1193857d326.css as=style><link href=/scss/main.min.b8ee4a8008ba3340c2f9a4386c269cfd0c363b329f020f483656c1193857d326.css rel=stylesheet integrity><script src=/js/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 321.39 78.54"><title id="title19">DUBBO LOGO</title><path class="cls-1" d="M68.46 50.38c0 14.06 11.39 22.11 25.45 22.11s25.45-8.05 25.45-22.11V7.25H68.46zm21.24-28h8.6V31H89.7zm0 22.25h8.6v8.6H89.7zM33.24 7.25H4.06v64H33.24c10.95.0 19.3-7.18 23.29-17.15a45.12 45.12.0 002.38-14.87A45.12 45.12.0 0056.53 24.4C52.84 14.62 44.19 7.25 33.24 7.25zm.43 14.63H30.34a3.44 3.44.0 00-3.44 3.44V53.23a3.44 3.44.0 003.44 3.44h3.33v4.63h-8.3a6.87 6.87.0 01-6.87-6.87V24.12a6.87 6.87.0 016.87-6.87h8.3zM285.51 6.06c-17.05.0-30.88 10.28-30.88 33.21s13.83 33.21 30.88 33.21 30.88-10.28 30.88-33.21S302.56 6.06 285.51 6.06zm7.59 48.36a6.87 6.87.0 01-6.87 6.87h-8.3V56.67h3.33a3.44 3.44.0 003.44-3.44V25.31a3.44 3.44.0 00-3.44-3.44h-3.33V17.25h8.3a6.87 6.87.0 016.87 6.87zm-53.4-17.56A17.39 17.39.0 00227.31 7.25H195.1v64h32.21a19.44 19.44.0 0012.38-34.44zM211.63 61.29h-6.08l18.68-44h6.08zM177 36.85A17.39 17.39.0 00164.65 7.25H132.43v64h32.21A19.44 19.44.0 00177 36.85zM149 61.29h-6.08l18.68-44h6.08z" style="fill:#fff;fill-opacity:1"/></svg></span><span class="text-uppercase font-weight-bold">Apache Dubbo</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/blog/><span class=active>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/blog/2018/07/01/%E7%AC%AC%E4%B8%80%E4%B8%AA-dubbo-filter/>中文</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/blog/2018/07/01/%E7%AC%AC%E4%B8%80%E4%B8%AA-dubbo-filter/>中文</a></div></div><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/blog/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Blog</a></li><ul><li class="collapse show" id=blog><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/blog/news/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Articles</a></li><ul><li class="collapse show" id=blognews><a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190826dubbo-admin-service-test href=/blog/2019/08/26/dubbo-admin-service-test/>Service test in dubbo admin</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190811tracing-dubbo-service-with-apache-skywalking href=/blog/2019/08/11/tracing-dubbo-service-with-apache-skywalking/>Use apache skywalking in dubbo</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190502dubbo-extensible-mechanism-source-code-analysis-part-2 href=/blog/2019/05/02/dubbo-extensible-mechanism-source-code-analysis-part-2/>Dubbo extensible mechanism - part 2</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190425dubbo-extensible-mechanism-source-code-analysis-part-1 href=/blog/2019/04/25/dubbo-extensible-mechanism-source-code-analysis-part-1/>Dubbo extensible mechanism - part 1</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190220implementation-background-and-practice-of-dubbo-client-asynchronous-interface href=/blog/2019/02/20/implementation-background-and-practice-of-dubbo-client-asynchronous-interface/>Dubbo Async Client</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190220implementation-background-and-practice-of-dubbo-server-asynchronous-interface href=/blog/2019/02/20/implementation-background-and-practice-of-dubbo-server-asynchronous-interface/>Dubbo Async Server</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190117how-to-use-fescar-to-ensure-consistency-between-dubbo-microservices href=/blog/2019/01/17/how-to-use-fescar-to-ensure-consistency-between-dubbo-microservices/>Use Fescar in Dubbo</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20181210the-fifth-dubbo-meetup-has-been-held-in-hangzhou href=/blog/2018/12/10/the-fifth-dubbo-meetup-has-been-held-in-hangzhou/>The fifth Dubbo meetup</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20181107dubbo-integrates-with-nacos-to-become-a-registry href=/blog/2018/11/07/dubbo-integrates-with-nacos-to-become-a-registry/>Use Dubbo with Nacos</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20181005introduction-to-the-dubbo-protocol href=/blog/2018/10/05/introduction-to-the-dubbo-protocol/>Introduction to the Dubbo protocol</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180930integrate-dubbo-with-kubernetes href=/blog/2018/09/30/integrate-dubbo-with-kubernetes/>Integrate Dubbo with Kubernetes</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180902how-to-prepare-an-apache-release href=/blog/2018/09/02/how-to-prepare-an-apache-release/>How to prepare an Apache Release</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180902how-to-implement-a-fully-asynchronous-calls-chain-based-on-dubbo href=/blog/2018/09/02/how-to-implement-a-fully-asynchronous-calls-chain-based-on-dubbo/>New Async Call</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180826the-fourth-dubbo-meetup-has-been-held-in-chengdu href=/blog/2018/08/26/the-fourth-dubbo-meetup-has-been-held-in-chengdu/>The fourth Dubbo meetup</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814dubbo-basic-usage-dubbo-consumer-configuration href=/blog/2018/08/14/dubbo-basic-usage-dubbo-consumer-configuration/>Dubbo Consumer Configuration</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814dubbo-several-ways-about-synchronousasynchronous-invoke href=/blog/2018/08/14/dubbo-several-ways-about-synchronous/asynchronous-invoke/>Dubbo Invoke</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814dubbo-basic-usage-dubbo-provider-configuration href=/blog/2018/08/14/dubbo-basic-usage-dubbo-provider-configuration/>Dubbo Provider Configuration</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814manipulating-services-dynamically-via-qos href=/blog/2018/08/14/manipulating-services-dynamically-via-qos/>Dubbo QoS Introduction</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814source-code-analysis-of-spring-boot-dubbo-app-start-and-stop href=/blog/2018/08/14/source-code-analysis-of-spring-boot-dubbo-app-start-and-stop/>Dubbo start/stop in spring boot</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814implementation-of-cross-language-calls-by-dubbo2js href=/blog/2018/08/14/implementation-of-cross-language-calls-by-dubbo2.js/>dubbo2.js introduction</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814generic-invoke-of-dubbo href=/blog/2018/08/14/generic-invoke-of-dubbo/>Generic invoke</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180810dubbos-load-balance href=/blog/2018/08/10/dubbos-load-balance/>Dubbo's Load Balance</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180807use-annotations-in-dubbo href=/blog/2018/08/07/use-annotations-in-dubbo/>Use Annotations In Dubbo</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180807using-zookeeper-in-dubbo href=/blog/2018/08/07/using-zookeeper-in-dubbo/>Using Zookeeper in Dubbo</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180807your-first-dubbo-demo href=/blog/2018/08/07/your-first-dubbo-demo/>Your First Dubbo Demo</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180730the-third-dubbo-meetup-has-been-held-in-shenzhen href=/blog/2018/07/30/the-third-dubbo-meetup-has-been-held-in-shenzhen/>The third Dubbo meetup</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180727sentinel-the-flow-sentinel-of-dubbo-services href=/blog/2018/07/27/sentinel-the-flow-sentinel-of-dubbo-services/>Introduce sentinel</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180712tracking-with-pinpoint href=/blog/2018/07/12/tracking-with-pinpoint/>Tracking with Pinpoint</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-blog20180701your-first-dubbo-filter href=/blog/2018/07/01/your-first-dubbo-filter/>Your First Dubbo Filter</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180623the-second-dubbo-shanghai-meetup-has-been-held-successfully href=/blog/2018/06/23/the-second-dubbo-shanghai-meetup-has-been-held-successfully/>The second Dubbo meetup</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180512the-first-dubbo-meetup-has-been-held-in-beijing href=/blog/2018/05/12/the-first-dubbo-meetup-has-been-held-in-beijing/>The first Dubbo meetup</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180502the-apachecon-na-schedule-has-been-announced href=/blog/2018/05/02/the-apachecon-na-schedule-has-been-announced/>ApacheCon NA</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180425the-gsocgoogle-summer-of-code-2018 href=/blog/2018/04/25/the-gsocgoogle-summer-of-code-2018/>GSoC 2018</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180422dubbo-roadmap-is-announced-in-qcon-beijing-2018 href=/blog/2018/04/22/dubbo-roadmap-is-announced-in-qcon-beijing-2018/>QCon Beijing 2018</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/blog/releases/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Releases</a></li><ul><li class=collapse id=blogreleases><a class="td-sidebar-link td-sidebar-link__page" id=m-blog20200518past-releases href=/blog/2020/05/18/past-releases/>Past Releases</a></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/apache/dubbo-website/edit/master/content/en/blog/news/first-dubbo-filter.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/apache/dubbo-website/new/master/content/en/blog/news/first-dubbo-filter.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i>Create child page</a>
<a href="https://github.com/apache/dubbo-website/issues/new?title=Your%20First%20Dubbo%20Filter" target=_blank><i class="fab fa-github fa-fw"></i>Create documentation issue</a>
<a href=https://github.com/apache/dubbo/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i>Create project issue</a></div></div><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><a class="btn btn-lg -bg-orange td-rss-button d-none d-lg-block" href=/blog/news/index.xml target=_blank>RSS <i class="fa fa-rss ml-2"></i></a><div class=td-content><h1>Your First Dubbo Filter</h1><div class=lead>This article will introduce you that how to implement a dubbo filter</div><div class="td-byline mb-4"><time datetime=2018-07-01 class=text-muted>Sunday, July 01, 2018</time></div><h3 id=overview>Overview</h3><p>In overall design of Dubbo, Filter is a very important concept, most of Dubbo&rsquo;s functions are based on this
extension point, and the Filter interception will be executed during each call.</p><h4 id=extension-mechanism-of-dubbo-filter>Extension Mechanism of Dubbo Filter</h4><p>There are already about 20 Filters implemented in Dubbo. Their entry is ProtocolFilterWrapper, ProtocolFilterWrapper
makes a Wrapper on Protocol and will be loaded when the extension is loaded. Then, let&rsquo;s see how
the Filter chain is constructed.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#586e75>//ProtocolFilterWrapper.java
</span><span style=color:#586e75></span><span style=color:#268bd2>public</span> <span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;</span> Invoker<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;</span> <span style=color:#268bd2>refer</span><span style=color:#719e07>(</span>Class<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;</span> type<span style=color:#719e07>,</span> URL url<span style=color:#719e07>)</span> <span style=color:#268bd2>throws</span> RpcException <span style=color:#719e07>{</span>
        <span style=color:#719e07>if</span> <span style=color:#719e07>(</span>Constants<span style=color:#719e07>.</span>REGISTRY_PROTOCOL<span style=color:#719e07>.</span>equals<span style=color:#719e07>(</span>url<span style=color:#719e07>.</span>getProtocol<span style=color:#719e07>()))</span> <span style=color:#719e07>{</span>
            <span style=color:#719e07>return</span> protocol<span style=color:#719e07>.</span>refer<span style=color:#719e07>(</span>type<span style=color:#719e07>,</span> url<span style=color:#719e07>);</span>
        <span style=color:#719e07>}</span>
        <span style=color:#719e07>return</span> buildInvokerChain<span style=color:#719e07>(</span>protocol<span style=color:#719e07>.</span>refer<span style=color:#719e07>(</span>type<span style=color:#719e07>,</span> url<span style=color:#719e07>),</span> Constants<span style=color:#719e07>.</span>REFERENCE_FILTER_KEY<span style=color:#719e07>,</span> Constants<span style=color:#719e07>.</span>CONSUMER<span style=color:#719e07>);</span>
    <span style=color:#719e07>}</span>
    
    <span style=color:#268bd2>private</span> <span style=color:#268bd2>static</span> <span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;</span> Invoker<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;</span> <span style=color:#268bd2>buildInvokerChain</span><span style=color:#719e07>(</span><span style=color:#268bd2>final</span> Invoker<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;</span> invoker<span style=color:#719e07>,</span> String key<span style=color:#719e07>,</span> String group<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
        Invoker<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;</span> last <span style=color:#719e07>=</span> invoker<span style=color:#719e07>;</span>
        List<span style=color:#719e07>&lt;</span>Filter<span style=color:#719e07>&gt;</span> filters <span style=color:#719e07>=</span> ExtensionLoader<span style=color:#719e07>.</span>getExtensionLoader<span style=color:#719e07>(</span>Filter<span style=color:#719e07>.</span>class<span style=color:#719e07>).</span>getActivateExtension<span style=color:#719e07>(</span>invoker<span style=color:#719e07>.</span>getUrl<span style=color:#719e07>(),</span> key<span style=color:#719e07>,</span> group<span style=color:#719e07>);</span>
        <span style=color:#719e07>if</span> <span style=color:#719e07>(</span>filters<span style=color:#719e07>.</span>size<span style=color:#719e07>()</span> <span style=color:#719e07>&gt;</span> 0<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
            <span style=color:#719e07>for</span> <span style=color:#719e07>(</span><span style=color:#dc322f>int</span> i <span style=color:#719e07>=</span> filters<span style=color:#719e07>.</span>size<span style=color:#719e07>()</span> <span style=color:#719e07>-</span> 1<span style=color:#719e07>;</span> i <span style=color:#719e07>&gt;=</span> 0<span style=color:#719e07>;</span> i <span style=color:#719e07>--)</span> <span style=color:#719e07>{</span>
                <span style=color:#268bd2>final</span> Filter filter <span style=color:#719e07>=</span> filters<span style=color:#719e07>.</span>get<span style=color:#719e07>(</span>i<span style=color:#719e07>);</span>
                <span style=color:#268bd2>final</span> Invoker<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;</span> next <span style=color:#719e07>=</span> last<span style=color:#719e07>;</span>
                last <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> Invoker<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;()</span> <span style=color:#719e07>{</span>

                    <span style=color:#268bd2>public</span> Class<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;</span> <span style=color:#268bd2>getInterface</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
                        <span style=color:#719e07>return</span> invoker<span style=color:#719e07>.</span>getInterface<span style=color:#719e07>();</span>
                    <span style=color:#719e07>}</span>

                    <span style=color:#268bd2>public</span> URL <span style=color:#268bd2>getUrl</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
                        <span style=color:#719e07>return</span> invoker<span style=color:#719e07>.</span>getUrl<span style=color:#719e07>();</span>
                    <span style=color:#719e07>}</span>

                    <span style=color:#268bd2>public</span> <span style=color:#dc322f>boolean</span> <span style=color:#268bd2>isAvailable</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
                        <span style=color:#719e07>return</span> invoker<span style=color:#719e07>.</span>isAvailable<span style=color:#719e07>();</span>
                    <span style=color:#719e07>}</span>

                    <span style=color:#268bd2>public</span> Result <span style=color:#268bd2>invoke</span><span style=color:#719e07>(</span>Invocation invocation<span style=color:#719e07>)</span> <span style=color:#268bd2>throws</span> RpcException <span style=color:#719e07>{</span>
                        <span style=color:#719e07>return</span> filter<span style=color:#719e07>.</span>invoke<span style=color:#719e07>(</span>next<span style=color:#719e07>,</span> invocation<span style=color:#719e07>);</span>
                    <span style=color:#719e07>}</span>

                    <span style=color:#268bd2>public</span> <span style=color:#dc322f>void</span> <span style=color:#268bd2>destroy</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
                        invoker<span style=color:#719e07>.</span>destroy<span style=color:#719e07>();</span>
                    <span style=color:#719e07>}</span>

                    <span style=color:#268bd2>@Override</span>
                    <span style=color:#268bd2>public</span> String <span style=color:#268bd2>toString</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
                        <span style=color:#719e07>return</span> invoker<span style=color:#719e07>.</span>toString<span style=color:#719e07>();</span>
                    <span style=color:#719e07>}</span>
                <span style=color:#719e07>};</span>
            <span style=color:#719e07>}</span>
        <span style=color:#719e07>}</span>
        <span style=color:#719e07>return</span> last<span style=color:#719e07>;</span>
    <span style=color:#719e07>}</span>

</code></pre></div><h4 id=activation-mechanism-of-dubbo-filter>Activation Mechanism of Dubbo Filter</h4><p>Through the above code we can see that, in the method buildInvokerChain, first get all
activated chains, the chain here is already sorted. Then construct a call chain of Filter
through the Invoker, finally the constructed call chain can be roughly expressed as: Filter1->Filter2->Filter3->&mldr;&mldr;->Invoker,
now let&rsquo;s see the detailed flow of the activated chain in the above step.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#268bd2>public</span> List<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;</span> <span style=color:#268bd2>getActivateExtension</span><span style=color:#719e07>(</span>URL url<span style=color:#719e07>,</span> String key<span style=color:#719e07>,</span> String group<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
        String value <span style=color:#719e07>=</span> url<span style=color:#719e07>.</span>getParameter<span style=color:#719e07>(</span>key<span style=color:#719e07>);</span>
        <span style=color:#719e07>return</span> getActivateExtension<span style=color:#719e07>(</span>url<span style=color:#719e07>,</span> value <span style=color:#719e07>==</span> <span style=color:#cb4b16>null</span> <span style=color:#719e07>||</span> value<span style=color:#719e07>.</span>length<span style=color:#719e07>()</span> <span style=color:#719e07>==</span> 0 <span style=color:#719e07>?</span> <span style=color:#cb4b16>null</span> <span style=color:#719e07>:</span> Constants<span style=color:#719e07>.</span>COMMA_SPLIT_PATTERN<span style=color:#719e07>.</span>split<span style=color:#719e07>(</span>value<span style=color:#719e07>),</span> group<span style=color:#719e07>);</span>
    <span style=color:#719e07>}</span>
    
    <span style=color:#268bd2>public</span> List<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;</span> <span style=color:#268bd2>getActivateExtension</span><span style=color:#719e07>(</span>URL url<span style=color:#719e07>,</span> String<span style=color:#719e07>[]</span> values<span style=color:#719e07>,</span> String group<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
        List<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;</span> exts <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> ArrayList<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;();</span>
        
        List<span style=color:#719e07>&lt;</span>String<span style=color:#719e07>&gt;</span> names <span style=color:#719e07>=</span> values <span style=color:#719e07>==</span> <span style=color:#cb4b16>null</span> <span style=color:#719e07>?</span> <span style=color:#719e07>new</span> ArrayList<span style=color:#719e07>&lt;</span>String<span style=color:#719e07>&gt;(</span>0<span style=color:#719e07>)</span> <span style=color:#719e07>:</span> Arrays<span style=color:#719e07>.</span>asList<span style=color:#719e07>(</span>values<span style=color:#719e07>);</span>

        <span style=color:#719e07>if</span> <span style=color:#719e07>(!</span> names<span style=color:#719e07>.</span>contains<span style=color:#719e07>(</span>Constants<span style=color:#719e07>.</span>REMOVE_VALUE_PREFIX <span style=color:#719e07>+</span> Constants<span style=color:#719e07>.</span>DEFAULT_KEY<span style=color:#719e07>))</span> <span style=color:#719e07>{</span>
            getExtensionClasses<span style=color:#719e07>();</span>
            <span style=color:#719e07>for</span> <span style=color:#719e07>(</span>Map<span style=color:#719e07>.</span>Entry<span style=color:#719e07>&lt;</span>String<span style=color:#719e07>,</span> Activate<span style=color:#719e07>&gt;</span> entry <span style=color:#719e07>:</span> cachedActivates<span style=color:#719e07>.</span>entrySet<span style=color:#719e07>())</span> <span style=color:#719e07>{</span>
                String name <span style=color:#719e07>=</span> entry<span style=color:#719e07>.</span>getKey<span style=color:#719e07>();</span>
                Activate activate <span style=color:#719e07>=</span> entry<span style=color:#719e07>.</span>getValue<span style=color:#719e07>();</span>
                <span style=color:#719e07>if</span> <span style=color:#719e07>(</span>isMatchGroup<span style=color:#719e07>(</span>group<span style=color:#719e07>,</span> activate<span style=color:#719e07>.</span>group<span style=color:#719e07>()))</span> <span style=color:#719e07>{</span>
                    T ext <span style=color:#719e07>=</span> getExtension<span style=color:#719e07>(</span>name<span style=color:#719e07>);</span>
                    <span style=color:#719e07>if</span> <span style=color:#719e07>(!</span> names<span style=color:#719e07>.</span>contains<span style=color:#719e07>(</span>name<span style=color:#719e07>)</span> <span style=color:#719e07>&amp;&amp;</span> <span style=color:#719e07>!</span> names<span style=color:#719e07>.</span>contains<span style=color:#719e07>(</span>Constants<span style=color:#719e07>.</span>REMOVE_VALUE_PREFIX <span style=color:#719e07>+</span> name<span style=color:#719e07>)</span> 
                            <span style=color:#719e07>&amp;&amp;</span> isActive<span style=color:#719e07>(</span>activate<span style=color:#719e07>,</span> url<span style=color:#719e07>))</span> <span style=color:#719e07>{</span>
                        exts<span style=color:#719e07>.</span>add<span style=color:#719e07>(</span>ext<span style=color:#719e07>);</span>
                    <span style=color:#719e07>}</span>
                <span style=color:#719e07>}</span>
            <span style=color:#719e07>}</span>
            Collections<span style=color:#719e07>.</span>sort<span style=color:#719e07>(</span>exts<span style=color:#719e07>,</span> ActivateComparator<span style=color:#719e07>.</span>COMPARATOR<span style=color:#719e07>);</span>
        <span style=color:#719e07>}</span>
        List<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;</span> usrs <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> ArrayList<span style=color:#719e07>&lt;</span>T<span style=color:#719e07>&gt;();</span>
        <span style=color:#719e07>for</span> <span style=color:#719e07>(</span><span style=color:#dc322f>int</span> i <span style=color:#719e07>=</span> 0<span style=color:#719e07>;</span> i <span style=color:#719e07>&lt;</span> names<span style=color:#719e07>.</span>size<span style=color:#719e07>();</span> i <span style=color:#719e07>++)</span> <span style=color:#719e07>{</span>
            String name <span style=color:#719e07>=</span> names<span style=color:#719e07>.</span>get<span style=color:#719e07>(</span>i<span style=color:#719e07>);</span>
            <span style=color:#719e07>if</span> <span style=color:#719e07>(!</span> name<span style=color:#719e07>.</span>startsWith<span style=color:#719e07>(</span>Constants<span style=color:#719e07>.</span>REMOVE_VALUE_PREFIX<span style=color:#719e07>)</span>
                    <span style=color:#719e07>&amp;&amp;</span> <span style=color:#719e07>!</span> names<span style=color:#719e07>.</span>contains<span style=color:#719e07>(</span>Constants<span style=color:#719e07>.</span>REMOVE_VALUE_PREFIX <span style=color:#719e07>+</span> name<span style=color:#719e07>))</span> <span style=color:#719e07>{</span>
                           <span style=color:#719e07>if</span> <span style=color:#719e07>(</span>Constants<span style=color:#719e07>.</span>DEFAULT_KEY<span style=color:#719e07>.</span>equals<span style=color:#719e07>(</span>name<span style=color:#719e07>))</span> <span style=color:#719e07>{</span>
                    <span style=color:#719e07>if</span> <span style=color:#719e07>(</span>usrs<span style=color:#719e07>.</span>size<span style=color:#719e07>()</span> <span style=color:#719e07>&gt;</span> 0<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
                        exts<span style=color:#719e07>.</span>addAll<span style=color:#719e07>(</span>0<span style=color:#719e07>,</span> usrs<span style=color:#719e07>);</span>
                        usrs<span style=color:#719e07>.</span>clear<span style=color:#719e07>();</span>
                    <span style=color:#719e07>}</span>
                <span style=color:#719e07>}</span> <span style=color:#719e07>else</span> <span style=color:#719e07>{</span>
                    T ext <span style=color:#719e07>=</span> getExtension<span style=color:#719e07>(</span>name<span style=color:#719e07>);</span>
                    usrs<span style=color:#719e07>.</span>add<span style=color:#719e07>(</span>ext<span style=color:#719e07>);</span>
                <span style=color:#719e07>}</span>
            <span style=color:#719e07>}</span>
        <span style=color:#719e07>}</span>
        <span style=color:#719e07>if</span> <span style=color:#719e07>(</span>usrs<span style=color:#719e07>.</span>size<span style=color:#719e07>()</span> <span style=color:#719e07>&gt;</span> 0<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
            exts<span style=color:#719e07>.</span>addAll<span style=color:#719e07>(</span>usrs<span style=color:#719e07>);</span>
        <span style=color:#719e07>}</span>
        <span style=color:#719e07>return</span> exts<span style=color:#719e07>;</span>
    <span style=color:#719e07>}</span>
</code></pre></div><p>Through the above code we can see that, some of the Filters configured by the user are activated by default,
and some need to be activated by the configuration file. The loading order of all Filters is to process Dubbo&rsquo;s
default Filter first, and then to process the Filter defined by the user. With the &ldquo;-&rdquo; configuration, Dubbo&rsquo;s defualt Filter
can be replaced, with this configuration, the user can flexibly replace or modify the Filter&rsquo;s load order.</p><h4 id=built-in-filter-of-dubbo>Built-in Filter of Dubbo</h4><p>Dubbo has lots of built-in Filter. RpcContext, accesslog and other functions can be implemented by Dubbo.
Now let&rsquo;s see the ConsumerContextFilter which used by the Consumer side for context delivery:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>public</span> Result <span style=color:#268bd2>invoke</span><span style=color:#719e07>(</span>Invoker<span style=color:#719e07>&lt;?&gt;</span> invoker<span style=color:#719e07>,</span> Invocation invocation<span style=color:#719e07>)</span> <span style=color:#268bd2>throws</span> RpcException <span style=color:#719e07>{</span>
        RpcContext<span style=color:#719e07>.</span>getContext<span style=color:#719e07>()</span>
                <span style=color:#719e07>.</span>setInvoker<span style=color:#719e07>(</span>invoker<span style=color:#719e07>)</span>
                <span style=color:#719e07>.</span>setInvocation<span style=color:#719e07>(</span>invocation<span style=color:#719e07>)</span>
                <span style=color:#719e07>.</span>setLocalAddress<span style=color:#719e07>(</span>NetUtils<span style=color:#719e07>.</span>getLocalHost<span style=color:#719e07>(),</span> 0<span style=color:#719e07>)</span>
                <span style=color:#719e07>.</span>setRemoteAddress<span style=color:#719e07>(</span>invoker<span style=color:#719e07>.</span>getUrl<span style=color:#719e07>().</span>getHost<span style=color:#719e07>(),</span> 
                                  invoker<span style=color:#719e07>.</span>getUrl<span style=color:#719e07>().</span>getPort<span style=color:#719e07>());</span>
        <span style=color:#719e07>if</span> <span style=color:#719e07>(</span>invocation <span style=color:#719e07>instanceof</span> RpcInvocation<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
            <span style=color:#719e07>((</span>RpcInvocation<span style=color:#719e07>)</span>invocation<span style=color:#719e07>).</span>setInvoker<span style=color:#719e07>(</span>invoker<span style=color:#719e07>);</span>
        <span style=color:#719e07>}</span>
        <span style=color:#719e07>try</span> <span style=color:#719e07>{</span>
            <span style=color:#719e07>return</span> invoker<span style=color:#719e07>.</span>invoke<span style=color:#719e07>(</span>invocation<span style=color:#719e07>);</span>
        <span style=color:#719e07>}</span> <span style=color:#719e07>finally</span> <span style=color:#719e07>{</span>
            RpcContext<span style=color:#719e07>.</span>getContext<span style=color:#719e07>().</span>clearAttachments<span style=color:#719e07>();</span>
        <span style=color:#719e07>}</span>
    <span style=color:#719e07>}</span>
</code></pre></div><p>This Filter records the state information during call, and passes the attachments parameter set
by the client to the server through the invocation object, and these parameters will be cleared
after the call is completed, which is why the request status information can be recorded by times
and delivered.</p><h4 id=implement-a-dubbo-filter>Implement A Dubbo Filter</h4><p>Because of Dubbo&rsquo;s flexible design and good scalability, we can implement business logic
in the call chain by implementing our own Dubbo Filter, such as time-consuming statistics, monitor information statistics, etc.
Now, let&rsquo;s implement a simple Filter:</p><p>Maven project structure:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>src
 |-main
    |-java
        |-com
            |-xxx
                |-XxxFilter.java (impelement Filter interface)
    |-resources
        |-META-INF
            |-dubbo
                |-com.alibaba.dubbo.rpc.Filter (Plain text file with content：xxx=com.xxx.XxxFilter)
</code></pre></div><p>XxxFilter.java：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>XxxFilter</span> <span style=color:#268bd2>implements</span> Filter <span style=color:#719e07>{</span>
    <span style=color:#268bd2>public</span> Result <span style=color:#268bd2>invoke</span><span style=color:#719e07>(</span>Invoker<span style=color:#719e07>&lt;?&gt;</span> invoker<span style=color:#719e07>,</span> Invocation invocation<span style=color:#719e07>)</span> <span style=color:#268bd2>throws</span> RpcException <span style=color:#719e07>{</span>
        <span style=color:#586e75>// before filter ...
</span><span style=color:#586e75></span>        Result result <span style=color:#719e07>=</span> invoker<span style=color:#719e07>.</span>invoke<span style=color:#719e07>(</span>invocation<span style=color:#719e07>);</span>
        <span style=color:#586e75>// after filter ...
</span><span style=color:#586e75></span>        <span style=color:#719e07>return</span> result<span style=color:#719e07>;</span>
    <span style=color:#719e07>}</span>
<span style=color:#719e07>}</span>
</code></pre></div><p>META-INF/dubbo/com.alibaba.dubbo.rpc.Filter：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>xxx=com.xxx.XxxFilter
</code></pre></div><p>configure in xml as:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#586e75>&lt;!-- Consumer call process interception --&gt;</span>
<span style=color:#268bd2>&lt;dubbo:reference</span> filter=<span style=color:#2aa198>&#34;xxx&#34;</span> <span style=color:#268bd2>/&gt;</span>
<span style=color:#586e75>&lt;!-- Consumer call process default interception，intercept all reference --&gt;</span>
<span style=color:#268bd2>&lt;dubbo:consumer</span> filter=<span style=color:#2aa198>&#34;xxx&#34;</span><span style=color:#268bd2>/&gt;</span>
<span style=color:#586e75>&lt;!-- Provider call process interception --&gt;</span>
<span style=color:#268bd2>&lt;dubbo:service</span> filter=<span style=color:#2aa198>&#34;xxx&#34;</span> <span style=color:#268bd2>/&gt;</span>
<span style=color:#586e75>&lt;!-- Provider call process default interception，intercept all service --&gt;</span>
<span style=color:#268bd2>&lt;dubbo:provider</span> filter=<span style=color:#2aa198>&#34;xxx&#34;</span><span style=color:#268bd2>/&gt;</span>
</code></pre></div><p>or use annotation as:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>@Activate</span><span style=color:#719e07>(</span>group <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;consumer&#34;</span><span style=color:#719e07>)</span>
<span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>XxxFilter</span> <span style=color:#268bd2>implements</span> Filter <span style=color:#719e07>{</span>
    <span style=color:#586e75>// ...
</span><span style=color:#586e75></span><span style=color:#719e07>}</span>
</code></pre></div><p>Using xml configuration is more flexible and granular.</p><p>In before and after, you can implement your own business logic to give the filter a certain function.
Once written and configured, the filter is activated by the Dubbo and executed in the call chain.</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/blog/2018/06/23/the-second-dubbo-shanghai-meetup-has-been-held-successfully/ class="btn btn-primary"><span class=mr-1>←</span> Previous</a></li><a href=/blog/2018/07/12/tracking-with-pinpoint/ class="btn btn-primary">Next <span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Dubbo mailing list archive" aria-label="Dubbo mailing list archive"><a class=text-white target=_blank rel="noopener noreferrer" href=https://lists.apache.org/list.html?dev@dubbo.apache.org><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/ApacheDubbo><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/apache/dubbo><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Subscribe to mailing list" aria-label="Subscribe to mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=mailto://dev-subscribe@dubbo.apache.org><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2020 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation. All Rights Reserved</small></div></div></div></footer></div><script src=/js/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.b5fc1b29d2465835844254bd4d804738eaf24c0cec53009b4c6899989be55a47.js integrity="sha256-tfwbKdJGWDWEQlS9TYBHOOryTAzsUwCbTGiZmJvlWkc=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js></script><script>docsearch({apiKey:'38eff7758162fbf70f2b8484932e62ae',indexName:'apache_dubbo',inputSelector:'.td-search-input',debug:false,});</script></body></html>