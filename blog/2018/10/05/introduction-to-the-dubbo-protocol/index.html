<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.80.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Introduction to the Dubbo protocol | Apache Dubbo</title><meta property="og:title" content="Introduction to the Dubbo protocol"><meta property="og:description" content="This article introduces the design of the Dubbo protocol."><meta property="og:type" content="article"><meta property="og:url" content="/blog/2018/10/05/introduction-to-the-dubbo-protocol/"><meta property="article:published_time" content="2018-10-05T00:00:00+00:00"><meta property="article:modified_time" content="2021-01-22T23:58:51+08:00"><meta property="og:site_name" content="Apache Dubbo"><meta itemprop=name content="Introduction to the Dubbo protocol"><meta itemprop=description content="This article introduces the design of the Dubbo protocol."><meta itemprop=datePublished content="2018-10-05T00:00:00+00:00"><meta itemprop=dateModified content="2021-01-22T23:58:51+08:00"><meta itemprop=wordCount content="1569"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Introduction to the Dubbo protocol"><meta name=twitter:description content="This article introduces the design of the Dubbo protocol."><link rel=preload href=/scss/main.min.8b180b4f9c3e92478ac4794f7583d0b2a7c043e9717486d0407c2dfdf725043f.css as=style><link href=/scss/main.min.8b180b4f9c3e92478ac4794f7583d0b2a7c043e9717486d0407c2dfdf725043f.css rel=stylesheet integrity><script src=/js/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 321.39 78.54"><title id="title19">DUBBO LOGO</title><path class="cls-1" d="M68.46 50.38c0 14.06 11.39 22.11 25.45 22.11s25.45-8.05 25.45-22.11V7.25H68.46zm21.24-28h8.6V31H89.7zm0 22.25h8.6v8.6H89.7zM33.24 7.25H4.06v64H33.24c10.95.0 19.3-7.18 23.29-17.15a45.12 45.12.0 002.38-14.87A45.12 45.12.0 0056.53 24.4C52.84 14.62 44.19 7.25 33.24 7.25zm.43 14.63H30.34a3.44 3.44.0 00-3.44 3.44V53.23a3.44 3.44.0 003.44 3.44h3.33v4.63h-8.3a6.87 6.87.0 01-6.87-6.87V24.12a6.87 6.87.0 016.87-6.87h8.3zM285.51 6.06c-17.05.0-30.88 10.28-30.88 33.21s13.83 33.21 30.88 33.21 30.88-10.28 30.88-33.21S302.56 6.06 285.51 6.06zm7.59 48.36a6.87 6.87.0 01-6.87 6.87h-8.3V56.67h3.33a3.44 3.44.0 003.44-3.44V25.31a3.44 3.44.0 00-3.44-3.44h-3.33V17.25h8.3a6.87 6.87.0 016.87 6.87zm-53.4-17.56A17.39 17.39.0 00227.31 7.25H195.1v64h32.21a19.44 19.44.0 0012.38-34.44zM211.63 61.29h-6.08l18.68-44h6.08zM177 36.85A17.39 17.39.0 00164.65 7.25H132.43v64h32.21A19.44 19.44.0 00177 36.85zM149 61.29h-6.08l18.68-44h6.08z" style="fill:#fff;fill-opacity:1"/></svg></span><span class="text-uppercase font-weight-bold">Apache Dubbo</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/blog/><span class=active>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/blog/2018/10/05/dubbo-%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/>中文</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/blog/2018/10/05/dubbo-%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/>中文</a></div></div><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/blog/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Blog</a></li><ul><li class="collapse show" id=blog><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/blog/news/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Articles</a></li><ul><li class="collapse show" id=blognews><a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190826service-test href=/blog/2019/08/26/service-test/>Service test in dubbo admin</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190811tracing-dubbo-service-with-apache-skywalking href=/blog/2019/08/11/tracing-dubbo-service-with-apache-skywalking/>Use apache skywalking in dubbo</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190502dubbo-extensible-mechanism-source-code-analysis-part-2 href=/blog/2019/05/02/dubbo-extensible-mechanism-source-code-analysis-part-2/>Dubbo extensible mechanism - part 2</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190425dubbo-extensible-mechanism-source-code-analysis-part-1 href=/blog/2019/04/25/dubbo-extensible-mechanism-source-code-analysis-part-1/>Dubbo extensible mechanism - part 1</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190220implementation-background-and-practice-of-dubbo-client-asynchronous-interface href=/blog/2019/02/20/implementation-background-and-practice-of-dubbo-client-asynchronous-interface/>Dubbo Async Client</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190220implementation-background-and-practice-of-dubbo-server-asynchronous-interface href=/blog/2019/02/20/implementation-background-and-practice-of-dubbo-server-asynchronous-interface/>Dubbo Async Server</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20190117how-to-use-seata-to-ensure-consistency-between-dubbo-microservices href=/blog/2019/01/17/how-to-use-seata-to-ensure-consistency-between-dubbo-microservices/>Use Seata in Dubbo</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20181210the-fifth-dubbo-meetup-has-been-held-in-hangzhou href=/blog/2018/12/10/the-fifth-dubbo-meetup-has-been-held-in-hangzhou/>The fifth Dubbo meetup</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20181107dubbo-integrates-with-nacos-to-become-a-registry href=/blog/2018/11/07/dubbo-integrates-with-nacos-to-become-a-registry/>Use Dubbo with Nacos</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-blog20181005introduction-to-the-dubbo-protocol href=/blog/2018/10/05/introduction-to-the-dubbo-protocol/>Introduction to the Dubbo protocol</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180930integrate-dubbo-with-kubernetes href=/blog/2018/09/30/integrate-dubbo-with-kubernetes/>Integrate Dubbo with Kubernetes</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180902how-to-prepare-an-apache-release href=/blog/2018/09/02/how-to-prepare-an-apache-release/>How to prepare an Apache Release</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180902how-to-implement-a-fully-asynchronous-calls-chain-based-on-dubbo href=/blog/2018/09/02/how-to-implement-a-fully-asynchronous-calls-chain-based-on-dubbo/>New Async Call</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180826the-fourth-dubbo-meetup-has-been-held-in-chengdu href=/blog/2018/08/26/the-fourth-dubbo-meetup-has-been-held-in-chengdu/>The fourth Dubbo meetup</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814dubbo-basic-usage-dubbo-consumer-configuration href=/blog/2018/08/14/dubbo-basic-usage-dubbo-consumer-configuration/>Dubbo Consumer Configuration</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814dubbo-several-ways-about-synchronousasynchronous-invoke href=/blog/2018/08/14/dubbo-several-ways-about-synchronous/asynchronous-invoke/>Dubbo Invoke</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814dubbo-basic-usage-dubbo-provider-configuration href=/blog/2018/08/14/dubbo-basic-usage-dubbo-provider-configuration/>Dubbo Provider Configuration</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814manipulating-services-dynamically-via-qos href=/blog/2018/08/14/manipulating-services-dynamically-via-qos/>Dubbo QoS Introduction</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814source-code-analysis-of-spring-boot-dubbo-app-start-and-stop href=/blog/2018/08/14/source-code-analysis-of-spring-boot-dubbo-app-start-and-stop/>Dubbo start/stop in spring boot</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814implementation-of-cross-language-calls-by-dubbo2js href=/blog/2018/08/14/implementation-of-cross-language-calls-by-dubbo2.js/>dubbo2.js introduction</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180814generic-invoke-of-dubbo href=/blog/2018/08/14/generic-invoke-of-dubbo/>Generic invoke</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180810dubbos-load-balance href=/blog/2018/08/10/dubbos-load-balance/>Dubbo's Load Balance</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180807use-annotations-in-dubbo href=/blog/2018/08/07/use-annotations-in-dubbo/>Use Annotations In Dubbo</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180807using-zookeeper-in-dubbo href=/blog/2018/08/07/using-zookeeper-in-dubbo/>Using Zookeeper in Dubbo</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180807dubbo-101 href=/blog/2018/08/07/dubbo-101/>Your First Dubbo Demo</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180730the-third-dubbo-meetup-has-been-held-in-shenzhen href=/blog/2018/07/30/the-third-dubbo-meetup-has-been-held-in-shenzhen/>The third Dubbo meetup</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180727sentinel-the-flow-sentinel-of-dubbo-services href=/blog/2018/07/27/sentinel-the-flow-sentinel-of-dubbo-services/>Introduce sentinel</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180712tracking-with-pinpoint href=/blog/2018/07/12/tracking-with-pinpoint/>Tracking with Pinpoint</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180701your-first-dubbo-filter href=/blog/2018/07/01/your-first-dubbo-filter/>Your First Dubbo Filter</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180623the-second-dubbo-shanghai-meetup-has-been-held-successfully href=/blog/2018/06/23/the-second-dubbo-shanghai-meetup-has-been-held-successfully/>The second Dubbo meetup</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180512the-first-dubbo-meetup-has-been-held-in-beijing href=/blog/2018/05/12/the-first-dubbo-meetup-has-been-held-in-beijing/>The first Dubbo meetup</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180502the-apachecon-na-schedule-has-been-announced href=/blog/2018/05/02/the-apachecon-na-schedule-has-been-announced/>ApacheCon NA</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180425the-gsocgoogle-summer-of-code-2018 href=/blog/2018/04/25/the-gsocgoogle-summer-of-code-2018/>GSoC 2018</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-blog20180422dubbo-roadmap-is-announced-in-qcon-beijing-2018 href=/blog/2018/04/22/dubbo-roadmap-is-announced-in-qcon-beijing-2018/>QCon Beijing 2018</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/blog/releases/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Releases</a></li><ul><li class=collapse id=blogreleases><a class="td-sidebar-link td-sidebar-link__page" id=m-blog20200518past-releases href=/blog/2020/05/18/past-releases/>Past Releases</a></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/apache/dubbo-website/edit/master/content/en/blog/news/dubbo-protocol.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/apache/dubbo-website/new/master/content/en/blog/news/dubbo-protocol.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i>Create child page</a>
<a href="https://github.com/apache/dubbo-website/issues/new?title=Introduction%20to%20the%20Dubbo%20protocol" target=_blank><i class="fab fa-github fa-fw"></i>Create documentation issue</a>
<a href=https://github.com/apache/dubbo/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i>Create project issue</a></div><nav id=TableOfContents><ul><li><a href=#the-concept-of-the-protocol>The concept of the protocol</a><ul><li><a href=#what-is-the-protocol>What is the protocol</a></li><li><a href=#the-definition-of-codec>The definition of <code>Codec</code></a></li></ul></li><li><a href=#common-protocol-mode>Common protocol mode</a><ul><li><a href=#fixed-length-protocol>Fixed-length protocol</a></li><li><a href=#special-delimiter-protocol>Special delimiter protocol</a></li><li><a href=#variable-length-protocolprotocol-head--payload>Variable length protocol(protocol head + payload)</a></li></ul></li><li><a href=#the-dubbo-protocol>The Dubbo protocol</a><ul><li><a href=#overview-to-the-dubbo-protocol>Overview to the Dubbo protocol</a></li><li><a href=#dubbo-protocol-details>Dubbo protocol details</a></li></ul></li><li><a href=#advantages-and-disadvantages-about-the-dubbo-protocol>Advantages and disadvantages about the Dubbo protocol</a><ul><li><a href=#advantages>Advantages</a></li><li><a href=#to-be-improved>To be improved</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><a class="btn btn-lg -bg-orange td-rss-button d-none d-lg-block" href=/blog/news/index.xml target=_blank>RSS <i class="fa fa-rss ml-2"></i></a><div class=td-content><h1>Introduction to the Dubbo protocol</h1><div class=lead>This article introduces the design of the Dubbo protocol.</div><div class="td-byline mb-4"><time datetime=2018-10-05 class=text-muted>Friday, October 05, 2018</time></div><h2 id=the-concept-of-the-protocol>The concept of the protocol</h2><p>The protocol is the foundation of communication between two network entities, and data is transmitted from one entity to another in the form of a byte stream over the network. In the world of byte streams, this one-dimensional byte stream cannot be reshaped into two-dimensional or multi-dimensional data structures and domain objects without a protocol.</p><h3 id=what-is-the-protocol>What is the protocol</h3><p>The protocol is the semantics determined by both parties for the communication. For example, we design a protocol for string transmission, which allows the client to send a string and the server receives the corresponding string.</p><p>This protocol is quite simple, first 4-byte represent the total length of the message, followed by 1-byte represents the length of the charset, and then followed by the message payload, charset name and string body.</p><p>For example, Send a string <code>abc</code> encoded by <code>iso-8859-1</code> to the server end. After protocol trans-coding, the content is: <code>18 = 4 + 1 + 10 + 3|10|iso-8859-1|abc</code>, when the server receives these byte streams, it first reads 4-byte and converts it to int, in this case is 18, which is the length of message. Then continue to read the remaining 14 bytes, the remaining first byte read will be the length of the charset name, which is 10, the after 10-byte content is converted to a string, the content is <code>iso-8859-1</code>. Use this charset to construct the subsequent byte array into the string <code>new String(bytes, "iso-8859-1")</code>.</p><p>In the previous example of a custom string transfer protocol, we have already seen the role of protocols in data transmission. Without a protocol, the data exchange cannot be completed. The following is Wikipedia&rsquo;s definition of the communication protocol.</p><blockquote><p>In telecommunication, a communication protocol is a system of rules that allow two or more entities of a communications system to transmit information via any kind of variation of a physical quantity. The protocol defines the rules syntax, semantics and synchronization of communication and possible error recovery methods. Protocols may be implemented by hardware, software, or a combination of both.</p></blockquote><p>Communication protocols need to define syntax, semantics, and communication synchronization operations. The content described here is actually a formal description of the previous custom string transfer protocol.</p><h3 id=the-definition-of-codec>The definition of <code>Codec</code></h3><p><code>org.apache.dubbo.remoting.Codec2</code> define the <strong>Codec</strong>&rsquo;s I/O processing, so the main methods are <code>encode</code> and <code>decode</code>, as defined below:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>@SPI</span>
<span style=color:#268bd2>public</span> <span style=color:#268bd2>interface</span> <span style=color:#268bd2>Codec2</span> <span style=color:#719e07>{</span>

    <span style=color:#268bd2>@Adaptive</span><span style=color:#719e07>({</span>Constants<span style=color:#719e07>.</span>CODEC_KEY<span style=color:#719e07>})</span>
    <span style=color:#dc322f>void</span> <span style=color:#268bd2>encode</span><span style=color:#719e07>(</span>Channel channel<span style=color:#719e07>,</span> ChannelBuffer buffer<span style=color:#719e07>,</span> Object message<span style=color:#719e07>)</span> <span style=color:#268bd2>throws</span> IOException<span style=color:#719e07>;</span>

    <span style=color:#268bd2>@Adaptive</span><span style=color:#719e07>({</span>Constants<span style=color:#719e07>.</span>CODEC_KEY<span style=color:#719e07>})</span>
    Object <span style=color:#268bd2>decode</span><span style=color:#719e07>(</span>Channel channel<span style=color:#719e07>,</span> ChannelBuffer buffer<span style=color:#719e07>)</span> <span style=color:#268bd2>throws</span> IOException<span style=color:#719e07>;</span>


    <span style=color:#268bd2>enum</span> DecodeResult <span style=color:#719e07>{</span>
        NEED_MORE_INPUT<span style=color:#719e07>,</span> SKIP_SOME_INPUT
    <span style=color:#719e07>}</span>

<span style=color:#719e07>}</span>
</code></pre></div><p><code>Codec</code> works on a protocol, <code>encode</code> method means to encode the communication object to the <code>ByteBufferWrapper</code>, and <code>decode</code> method decodes the <code>ChannelBuffer</code> read from the network into <code>Object</code>, which is the communication object.</p><h2 id=common-protocol-mode>Common protocol mode</h2><p>Protocols in application layer have three general forms: fixed-length protocol, special delimiter protocol and protocol header + payload mode. The specific contents of these forms are described below.</p><p>When reading data from the network in the form of a byte stream, it is necessary to determine when a meaningful transmission content ends. Moreover, the transmission of data on the network, there are sticky packets and fragment packets problem. The solution to this problem is that the protocol can accurately identify, when the sticky packets or fragment packets occurs, it can handle it correctly.</p><h3 id=fixed-length-protocol>Fixed-length protocol</h3><p>The fixed-length protocol means that the length of the protocol content is fixed. For example, the protocol byte length is 50. When 50 bytes are read from the network, the decoding operation is performed. The fixed-length protocol is more efficient when reading or writing, because the size of the data cache is basically determined, just like an array. The defect is the lack of adaptability. Taking the RPC scene as an example, it is difficult to estimate the length.</p><blockquote><p>Refer to Netty&rsquo;s <code>FixedLengthFrameDecoder</code></p></blockquote><h3 id=special-delimiter-protocol>Special delimiter protocol</h3><p>Compared to fixed-length protocols, if we can define a special character as the end of each protocol unit, we can communicate in a variable length, so as to balance the data transmission and efficiency, such as the delimiter \n.</p><p>The problem with the special delimiter method is that it think about the process of protocol transmission in a simple way. For a protocol unit, it must be read all before it can be processed. In addition, it must be prevented that the data transmitted by the user cannot be the same as the delimiter, otherwise it will be disordered.</p><blockquote><p>Refer to Netty&rsquo;s <code>DelimiterBasedFrameDecoder</code></p></blockquote><h3 id=variable-length-protocolprotocol-head--payload>Variable length protocol(protocol head + payload)</h3><p>Generally, it is a custom protocol, which is composed of a fixed length and a variable content. The fixed length part needs to specify the length of the variable content part.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>+————————————————+
|fixed-length    |
+————————————————+
|variable content|
+————————————————+
</code></pre></div><blockquote><p>Refer to Netty&rsquo;s <code>LengthFieldBasedFrameDecoder</code></p></blockquote><p>The Dubbo protocol is actually a variable length protocol, which is covered in more detail in later chapters.</p><h2 id=the-dubbo-protocol>The Dubbo protocol</h2><h3 id=overview-to-the-dubbo-protocol>Overview to the Dubbo protocol</h3><p>The Dubbo framework defines a proprietary RPC protocol in which the specific content of the request and response protocols is presented using a table.</p><p><img src=/imgs/dev/dubbo_protocol_header.png alt=/dev-guide/images/dubbo_protocol_header.jpg></p><h3 id=dubbo-protocol-details>Dubbo protocol details</h3><ul><li><p>Magic - Magic High & Magic Low (16 bits)</p><p>Identify protocol version, Dubbo protocol: 0xdabb</p></li><li><p>Req/Res (1 bit)</p><p>Identify a request or response. request: 1; response: 0.</p></li><li><p>2 Way (1 bit)</p><p>Only useful when Req/Res is 1(request), identifying if you expect to return a value from the server. Set to 1 if a return value from the server is required.</p></li><li><p>Event (1 bit)</p><p>Identifies whether it is an event message, for example, a heartbeat event. Set to 1 if this is an event.</p></li><li><p>Serialization ID (5 bit)</p><p>Identifies the serialization type: for example, the value of fastjson is 6.</p></li><li><p>Status (8 bits)</p><p>Only useful when Req/Res is 0 (response), used to identify the status of the response</p><ul><li>20 - OK</li><li>30 - CLIENT_TIMEOUT</li><li>31 - SERVER_TIMEOUT</li><li>40 - BAD_REQUEST</li><li>50 - BAD_RESPONSE</li><li>60 - SERVICE_NOT_FOUND</li><li>70 - SERVICE_ERROR</li><li>80 - SERVER_ERROR</li><li>90 - CLIENT_ERROR</li><li>100 - SERVER_THREADPOOL_EXHAUSTED_ERROR</li></ul></li><li><p>Request ID (64 bits)</p><p>Identifies the only request, the type is long.</p></li><li><p>Data Length (32 bits)</p><p>The length of the serialized content (variable part), counted in bytes, the type is int.</p></li><li><p>Variable Part</p><p>After being serialized by a specific serialization type (identified by the serialization ID), each part is a byte [] or byte.</p><ul><li>If it is a request packet (Req/Res = 1), each part is:<ul><li>Dubbo version</li><li>Service name</li><li>Service version</li><li>Method name</li><li>Method parameter types</li><li>Method arguments</li><li>Attachments</li></ul></li><li>If it is a response packet (Req/Res = 0), each part is:<ul><li>Return value&rsquo;s type (byte), identifying the type of value returned from the server:<ul><li>Return null: RESPONSE_NULL_VALUE 2</li><li>Normal response value: RESPONSE_VALUE 1</li><li>Exception: RESPONSE_WITH_EXCEPTION 0</li></ul></li><li>Return value: response bytes returned from the server</li></ul></li></ul></li></ul><p><strong>Note:</strong> For the variable part, when uses json serialization in current version of Dubbo framework, an additional line break is added as a separator between each part of the content. Please add a new line break after each part of the variable part, such as:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Dubbo version bytes (line break)
Service name bytes  (line break)
...
</code></pre></div><h2 id=advantages-and-disadvantages-about-the-dubbo-protocol>Advantages and disadvantages about the Dubbo protocol</h2><h3 id=advantages>Advantages</h3><ul><li>The protocol is designed to be very compact. The data type can be represented by 1 bit will not be represented by a byte, such as a boolean type identifier.</li><li>The request header is the same as response header, and the specific content is assembled to the variable part through the serializer, and it is simple to implement.</li></ul><h3 id=to-be-improved>To be improved</h3><ul><li><p>Similar to the http request, the header can determine the resource to be accessed, and Dubbo needs to involve the specific serializer to resolve the service name, method, method signature, and these resource locators are string type or string array. It&rsquo;s easy to convert to bytes, so it can be assembled into the header. Similar to http2 header compression, resources called for rpc can also be negotiated with an int to identify, which improves performance. This is easier to implement if the resource locator is assembled on <code>header</code>.</p></li><li><p>Use req/res to determine if it is a request, then you can refine the protocol, remove some unwanted identifiers and add some specific identifiers. For example, <code>status</code>, <code>twoWay</code> can be strictly customized to remove redundant identifiers. There is also a timeout identifier that is transmitted as the <code>attachment</code> of the Dubbo. In theory, it should be placed in the header of the request protocol, because the timeout is essential in the network request. Referring to <code>attachment</code>, you can see from the implementation that there are some fields in <code>attachment</code> that are duplicated with existing fields in <code>content</code>, such as <code>path</code> and <code>version</code>, which increase the protocol size.</p></li><li><p>Dubbo will convert the service name <code>com.alibaba.middleware.hsf.guide.api.param.ModifyOrderPriceParam</code> to <code>Lcom/alibaba/middleware/hsf/guide/api/param/ModifyOrderPriceParam;</code>, which is theoretically unnecessary, simply append a <code>;</code> will be fine.</p></li><li><p>The Dubbo protocol does not reserve extension fields, and cannot add new identifiers. The scalability is not very good. For example, the only way to add the <code>response context</code> function is to change the protocol version, but this requires both the client and server versions to be upgraded. Very unfriendly in distributed scenarios.</p></li></ul><h2 id=conclusion>Conclusion</h2><p>This article mainly introduces the concept of the protocol and the commonly used protocol mode. Then it analyzes the Dubbo protocol in detail and also mentions some shortcomings. However, compared with its simplicity and ease of implementation, the above shortcomings are not enough to drive us to redesign a new version of the protocol, so we welcome suggestions and features for protocol optimization.</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/blog/2018/09/30/integrate-dubbo-with-kubernetes/ class="btn btn-primary"><span class=mr-1>←</span> Previous</a></li><a href=/blog/2018/11/07/dubbo-integrates-with-nacos-to-become-a-registry/ class="btn btn-primary">Next <span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Dubbo mailing list archive" aria-label="Dubbo mailing list archive"><a class=text-white target=_blank rel="noopener noreferrer" href=https://lists.apache.org/list.html?dev@dubbo.apache.org><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/ApacheDubbo><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/apache/dubbo><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Subscribe to mailing list" aria-label="Subscribe to mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=mailto://dev-subscribe@dubbo.apache.org><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation. All Rights Reserved</small></div></div></div></footer><div class="row pt-2 pb-2"><div class="container-fluid mx-sm-5"><div class=text-center id=my-footer><img style=float:left src=/imgs/apache_logo.png><ul><li><a href=http://www.apache.org>Foundation</a></li><li><a href=http://www.apache.org/licenses/>License</a></li><li><a href=https://www.apache.org/security/>Security</a></li><li><a href=http://www.apache.org/events/current-event>Events</a></li><li><a href=http://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li><li><a href=http://www.apache.org/foundation/thanks.html>Thanks</a></li></ul></div></div></div></div><script src=/js/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.b5fc1b29d2465835844254bd4d804738eaf24c0cec53009b4c6899989be55a47.js integrity="sha256-tfwbKdJGWDWEQlS9TYBHOOryTAzsUwCbTGiZmJvlWkc=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js></script><script>docsearch({apiKey:'38eff7758162fbf70f2b8484932e62ae',indexName:'apache_dubbo',inputSelector:'.td-search-input',debug:false,});</script></body></html>