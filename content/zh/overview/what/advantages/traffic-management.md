---
type: docs
title: "流量治理"
linkTitle: "流量治理"
weight: 40
---

Dubbo 丰富的流量管控规则可以控制服务间的流量走向和 API 调用，基于这些规则可以实现在运行态动态的调整服务行为如超时时间、重试次数、限流参数等，通过控制流量分布可以实现 A/B 测试、金丝雀发布、多版本按比例流量分配、条件匹配路由、黑白名单等，提高系统稳定性。

## Dubbo 的流量管控体系

Dubbo 提供了多种策略和实现，可以很好的管控流入、流出 Dubbo 集群的流量。从 Server 视角来看，部署 Dubbo 应用的实例是时刻在动态变化的，因此消费方 (Dubbo Consumer) 要能随时感知节点变化并将流量均匀的分布到每个实例上，Dubbo 的服务发现与负载均衡机制可以很好的解决这个问题；Dubbo 中有应用、服务和方法的概念，一个应用可以发布多个服务，一个服务包含多个可被调用的方法，从抽象的视角来看，一次 Dubbo 调用就是某个消费方应用发起了对某个提供方 (Dubbo Provider) 应用内的某个服务特定方法的调用，Dubbo 的流量管控规则可以基于应用、服务、方法、参数等粒度精准的控制流量走向。

Dubbo 服务发现保证调用方随时看到最新的提供方实例地址，服务发现机制依赖注册中心的协调，注册中心可以是 Zookeeper、Nacos 等独立集群，也可以是 Istio 等控制面组件。在消费端，Dubbo 提供了多种负载均衡策略，比如通过随机负载均衡策略能最大限度的做到流量在后端实例上的均匀分布，而一致性哈希负载均衡、基于权重的负载均衡等策略则能满足一些特定场景的流量调度需求。

从流量管控的视角，一次请求的目标是服务和方法，Dubbo 的流量管控就是根据请求的目标服务、方法以及请求体中的其他附加参数进行匹配的，符合匹配太条件的流量会被按照特定规则转发到一个地址子集。匹配条件最细支持到方法粒度，同时还能根据参数值进行流量转发。如果是基于 http 的 rpc 协议 (如 REST、gRPC、Triple 等)，则服务和方法的就统一转换为 http 的路径 (path)，此时 Dubbo 的流量规则就是基于 http path 和 headers 的流量分发。

## Dubbo 流量管控能解决哪些问题

> 增加流量分布图、从示例里摘几个。

以上介绍了几种 Dubbo 中支持的流量管控规则，我们可以依赖它们中的一种或多种，通过改变规则中的匹配条件，实现微服务场景中的多种服务治理能力，常见的包括以下一些：

* 灰度流量隔离
* 金丝雀发布
* A/B 测试
* 黑白名单
* 服务降级
* 修改服务行为，如重试、打开访问日志、限流参数等
* 超时时间调整
* 实例临时拉黑

可以在 [流量管理任务]() 中了解更多这部分的细节。
