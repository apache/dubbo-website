<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>How SPI Works - Dubbo 2.7.8</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "How SPI Works";
    var mkdocs_page_input_path = "dev/SPI.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Dubbo 2.7.8</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">User's Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">Preface</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user/preface/background/">Bakcground</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/preface/background/">Requirements</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/preface/architecture/">Architecture</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/preface/usage/">Usage</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../user/quick-start/">Quick Start</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/dependencies/">Dependencies</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/maturity/">Maturity</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Configuration</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user/configuration/xml/">XML Configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/configuration/api/">API Configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/configuration/annotation/">Annotation Configuration</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Demos</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/preflight-check/">Check on start</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/fault-tolerent-strategy/">Fault tolerance</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/loadbalance/">Load balance</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/thread-model/">Thread model</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/explicit-target/">Connecting certain provider straightly</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/subscribe-only/">Subscribe only</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/registry-only/">Register only</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/static-service/">Static service</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/multi-protocols/">Multi-protocols</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/multi-registry/">Multi-registries</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/service-group/">Grouping</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/multi-versions/">Versions</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/group-merger/">Group merger</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/parameter-validation/">Parameter validation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/result-cache/">Result cache</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/generic-reference/">Generic call</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/generic-service/">Generic implementation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/echo-service/">Echo service</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/context/">Context</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/attachment/">Attachment</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/async-call/">Async call</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/local-call/">Local call</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/callback-parameter/">Parameter callback</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/events-notify/">Event callback</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/local-stub/">Local stub</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/local-mock/">Local mock</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/delay-publish/">Delay publish</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/concurrency-control/">Concurrency limit</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/config-connection.md">Connection limit</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/lazy-connect/">Lazy connec</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/stickiness/">Stickness connection</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/token-authorization/">Token authorization</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/routing-rule/">Routing rule</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/config-rule/">Config rule</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/service-downgrade/">Service downgrade</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/graceful-shutdown/">Graceful shutdown</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/hostname-binding/">Host binding</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/logger-strategy/">Logger</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/accesslog/">Accesslog</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/service-container/">Container</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/distributed-transaction/">Transaction</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/dump/">Thread dump</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/netty4/">Netty4</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/serialization/">Kryo&FST serialization</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/simplify-registry-data.md">Simplified registry URL</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/demos/api.md">API reference</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Schema reference</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/xml/dubbo-service/">dubbo:service</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/xml/dubbo-reference/">dubbo:reference</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/xml/dubbo-protocol/">dubbo:protocol</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/xml/dubbo-registry/">dubbo:registry</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/xml/dubbo-monitor/">dubbo:monitor</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/xml/dubbo-application/">dubbo:application</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/xml/dubbo-module/">dubbo:module</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/xml/dubbo-provider/">dubbo:provider</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/xml/dubbo-consumer/">dubbo:consumer</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/xml/dubbo-method/">dubbo:method</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/xml/dubbo-argument/">dubbo:argument</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/xml/dubbo-parameter/">dubbo:parameter</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/xml/dubbo-config-center/">dubbo:config-center</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Protocol reference</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/protocol/dubbo/">dubbo://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/protocol/rmi/">rmi://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/protocol/hessian/">hessian://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/protocol/http/">http://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/protocol/thrift/">thrift://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/protocol/rest/">rest://</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Registry reference</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/registry/multicast/">Multicast</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/registry/zookeeper/">Zookeeper</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/registry/redis/">Redis</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/registry/simple/">Simple</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Metadata reference</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/metadata/metadata-redis.md">Redis</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user/references/registry/metadata-zookeeper.md">Zookeeper</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../user/references/telnet/">Telnet reference</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/references/maven/">Maven plugin reference</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/best-practice/">Best practice</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/recommend/">Recommendation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/capacity-plan/">Capacity plan</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/perf-test/">Benchmark</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/covergence.md">Code coverange</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developer's Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../build/">How to Build</a>
                </li>
                <li class="">
                    
    <a class="" href="../design/">Architecture</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">How SPI Works</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#spi-loading">SPI Loading</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#spi-config">SPI Config</a></li>
        
            <li><a class="toctree-l4" href="#spi-features">SPI Features</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../implementation/">Init, Process, Protocols</a>
                </li>
                <li class="">
                    
    <span class="caption-text">SPI Extensions</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../impls/protocol/">Protocol</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/filter/">Filter</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/invoker-listener/">Invoker Listener</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/exporter-listener/">Exporter Listener</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/cluster/">Cluster</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/router/">Router</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/load-balance/">Load Balance</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/merger/">Merge</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/registry/">Registry</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/monitor/">Monitor</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/extension-factory/">Extension Factory</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/proxy-factory/">Proxy Factory</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/compiler/">Compiler</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/dispatcher/">Dispatcher</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/threadpool/">Threadpool</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/serialize/">Serialize</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/remoting/">Remoting</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/exchanger/">Exchanger</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/networker/">Networker</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/telnet-handler/">Telnet Handler</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/status-checker/">Status Checker</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/container/">Container</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/page/">Page</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/cache/">Cache</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/validation/">Validation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../impls/logger-adapter/">Logger Adapter</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../contract/">Contract</a>
                </li>
                <li class="">
                    
    <a class="" href="../coding/">Coding</a>
                </li>
                <li class="">
                    
    <a class="" href="../release/">Release</a>
                </li>
                <li class="">
                    
    <a class="" href="../contribution/">Contribution</a>
                </li>
                <li class="">
                    
    <a class="" href="../checklist/">Checklist</a>
                </li>
                <li class="">
                    
    <a class="" href="../code-smell/">Code Smell</a>
                </li>
                <li class="">
                    
    <a class="" href="../TCK/">TCK</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Admin's Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../introduction/">Dubbo Admin Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../serviceSearch.md">Search & Details</a>
                </li>
                <li class="">
                    
    <a class="" href="../serviceGovernance.md">Governance</a>
                </li>
                <li class="">
                    
    <a class="" href="../serviceTest.md">Testing</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Dubbo 2.7.8</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Developer's Guide &raquo;</li>
        
      
    
    <li>How SPI Works</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/documentations/2.7/en-us/docs/dev/SPI.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="spi-loading">SPI Loading</h1>
<h2 id="spi-config">SPI Config</h2>
<h3 id="source">Source:</h3>
<p>Dubbo SPI is inherited from standard JDK SPI(Service Provider Interface) and makes it more powerful.</p>
<p>Dubbo fixed below issues of the standard JDK SPI:</p>
<ul>
<li>The standard JDK SPI will load and instantize all the implementations at once. It will be a waste of resources if one implementation is timecosted, but never be used.</li>
<li>We can't accquire the SPI name, if loading the SPI implementation is failed.For example: standard JDK ScriptEngine, get script type by invoking method getName(). RubyScriptEngine class will load failed if the depenency jar jruby.jar is missing, and the real error info will be lost. When user executes ruby scripts, the program throws exception that doesn't support ruby, but it is not the real cause.</li>
<li>Enhance the SPI functionality by supporting IoC and AOP, one SPI can be easily injected by another SPI simply using setter.</li>
</ul>
<h3 id="appointment">Appointment:</h3>
<p>In the jar file containing extension class [^1], places a config file <code>META-INF/dubbo/full interface name</code>, file content pattern: <code>SPI name=the fully qualified name for the extension class</code>, use new line seperator for multiple implementation.</p>
<h3 id="example">Example:</h3>
<p>To extend Dubbo Protocol, place a text file in the extension jar file: <code>META-INF/dubbo/org.apache.dubbo.rpc.Protocol</code>, content:</p>
<pre><code class="properties">xxx=com.alibaba.xxx.XxxProtocol
</code></pre>

<p>content of the implementation [^2]:</p>
<pre><code class="java">package com.alibaba.xxx;

import org.apache.dubbo.rpc.Protocol;

public class XxxProtocol implements Protocol { 
    // ...
}
</code></pre>

<h3 id="configuration-in-config-module">Configuration in config module</h3>
<p>In Dubbo config module, all SPI points have related attributes or labels, we can choose the specific SPI implementation by using its name. Like:</p>
<pre><code class="xml">&lt;dubbo:protocol name=&quot;xxx&quot; /&gt;
</code></pre>

<h2 id="spi-features">SPI Features</h2>
<h3 id="spi-auto-wrap">SPI Auto Wrap</h3>
<p>Auto wrap the SPI's Wrapper class. <code>ExtensionLoader</code> loads the SPI implementation, if the SPI has a copy instructor, it will be regarded as the SPI's Wrapper class.</p>
<p>Wrapper class content:</p>
<pre><code class="java">package com.alibaba.xxx;

import org.apache.dubbo.rpc.Protocol;

public class XxxProtocolWrapper implements Protocol {
    Protocol impl;

    public XxxProtocolWrapper(Protocol protocol) { impl = protocol; }

    //after interface method is executed, the method in extension will be executed
    public void refer() {
        //... some operation
        impl.refer();
        // ... some operation
    }

    // ...
}
</code></pre>

<p>Wrapper class also implements the same SPI interface, but Wrapper is not the real implementation. It is used for wrap the real implementation returned from the <code>ExtensionLoader</code>. The real returned instance by <code>ExtensionLoader</code> is the Wrapper class instance, Wrapper holder the real SPI implementation class.</p>
<p>There can be many Wrapper for one spi, simply add one if you need.</p>
<p>With Wrapper class, you will be able to move same logics into Wrapper for all SPIs. Newly added Wrapper class add external logics for all SPIs, looks like AOP, Wrapper acts as a proxy for SPI.</p>
<h3 id="spi-auto-load">SPI Auto Load</h3>
<p>when loading the SPI, Dubbo will auto load the depency SPI. When one SPI implementation contains attribute which is also an SPI of another type,<code>ExtensionLoader</code> will automatically load the depency SPI. <code>ExtensionLoader</code> knows all the members of the specific SPI by scanning the setter method of all implementation class.</p>
<p>Demo: two SPI <code>CarMaker</code>（car maker）、<code>WheelMaker</code> (wheel maker)</p>
<p>Intefaces look like:</p>
<pre><code class="java">public interface CarMaker {
    Car makeCar();
}

public interface WheelMaker {
    Wheel makeWheel();
}
</code></pre>

<p><code>CarMaker</code>'s implementation:</p>
<pre><code class="java">public class RaceCarMaker implements CarMaker {
    WheelMaker wheelMaker;

    public setWheelMaker(WheelMaker wheelMaker) {
        this.wheelMaker = wheelMaker;
    }

    public Car makeCar() {
        // ...
        Wheel wheel = wheelMaker.makeWheel();
        // ...
        return new RaceCar(wheel, ...);
    }
}
</code></pre>

<p>when <code>ExtensionLoader</code> loads <code>CarMaker</code>'s implementation <code>RaceCarMaker</code>, the method <code>setWheelMaker</code> needs paramType <code>WheelMaker</code> which is also a SPI, It will be automatically loaded.</p>
<p>This brings a new question:How <code>ExtensionLoader</code> determines which implementation to use when load the injected SPI. As for this demo, when existing multi <code>WheelMaker</code> implementation, which one should the <code>ExtensionLoader</code> chooses.</p>
<p>Good question, we will explain it in the following chapter: SPI Auto Adaptive.</p>
<h3 id="spi-auto-adaptive">SPI Auto Adaptive</h3>
<p>The depency SPI that <code>ExtensionLoader</code> injects is an instance of <code>Adaptive</code>, the real spi implementation is known until the adaptive instance is executed.</p>
<p>Dubbo use URL (containing Key-Value) to pass the configuration.</p>
<p>The SPI method invocation has the URL parameter（Or Entity that has URL attribute）</p>
<p>In this way depended SPI can get configuration from URL, after config all SPI key needed, configuration information will be passed from outer by URL. URL acts as a bus when passing the config information.</p>
<p>Demo: two SPI <code>CarMaker</code>、<code>WheelMaker</code></p>
<p>interface looks like:</p>
<pre><code class="java">public interface CarMaker {
    Car makeCar(URL url);
}

public interface WheelMaker {
    Wheel makeWheel(URL url);
}
</code></pre>

<p><code>CarMaker</code>'s implementation:</p>
<pre><code class="java">public class RaceCarMaker implements CarMaker {
    WheelMaker wheelMaker;

    public setWheelMaker(WheelMaker wheelMaker) {
        this.wheelMaker = wheelMaker;
    }

    public Car makeCar(URL url) {
        // ...
        Wheel wheel = wheelMaker.makeWheel(url);
        // ...
        return new RaceCar(wheel, ...);
    }
}
</code></pre>

<p>when execute the code above</p>
<pre><code class="java">// ...
Wheel wheel = wheelMaker.makeWheel(url);
// ...
</code></pre>

<p>, the injected <code>Adaptive</code> object determine which <code>WheelMaker</code>'s <code>makeWheel</code> method will be executed by predefined Key. Such as <code>wheel.type</code>, key <code>url.get("wheel.type")</code> will determine <code>WheelMake</code> implementation. The logic of<code>Adaptive</code> instance of fixed, getting the predefined Key of the URL, dynamically creating the real implementation and execute it.</p>
<p>For Dubbo, the SPI <code>Adaptive</code> implementation in <code>ExtensionLoader</code> is dynamically created when dubbo is loading the SPI. Get the Key from URL, the Key will be provided through <code>@Adaptive</code> annotation for the interface method definition.</p>
<p>Below is Dubbo Transporter SPI codes:</p>
<pre><code class="java">public interface Transporter {
    @Adaptive({&quot;server&quot;, &quot;transport&quot;})
    Server bind(URL url, ChannelHandler handler) throws RemotingException;

    @Adaptive({&quot;client&quot;, &quot;transport&quot;})
    Client connect(URL url, ChannelHandler handler) throws RemotingException;
}
</code></pre>

<p>for the method bind(), Adaptive will firstly search <code>server</code> key, if no Key were founded then will search <code>transport</code> key, to determine the implementation that the proxy represent for.</p>
<h3 id="spi-auto-activation">SPI Auto Activation</h3>
<p>As for Collections SPI, such as: <code>Filter</code>, <code>InvokerListener</code>, <code>ExportListener</code>, <code>TelnetHandler</code>, <code>StatusChecker</code> etc, multi implementations can be loaded at one time. User can simplify configuration by using auto activation, Like:</p>
<pre><code class="java">import org.apache.dubbo.common.extension.Activate;
import org.apache.dubbo.rpc.Filter;

@Activate // Active for any condition
public class XxxFilter implements Filter {
    // ...
}
</code></pre>

<p>Or:</p>
<pre><code class="java">import org.apache.dubbo.common.extension.Activate;
import org.apache.dubbo.rpc.Filter;

@Activate(&quot;xxx&quot;) // when configed xxx parameter and the parameter has a valid value,the SPI is activated, for example configed cache=&quot;lru&quot;, auto acitivate CacheFilter.
public class XxxFilter implements Filter {
    // ...
}
</code></pre>

<p>Or:</p>
<pre><code class="java">import org.apache.dubbo.common.extension.Activate;
import org.apache.dubbo.rpc.Filter;

@Activate(group = &quot;provider&quot;, value = &quot;xxx&quot;) // only activate for provider, group can be &quot;provider&quot; or &quot;consumer&quot;
public class XxxFilter implements Filter {
    // ...
}
</code></pre>

<p>[^1]: Note: The config file here is in you own jar file, not in dubbo release jar file, Dubbo will scan all jar files with the same filename in classpath and then merge them together
[^2]: Note: SPI will be loaded in singleton pattern(Please ensure thread safety), cached in <code>ExtensionLoader</code> </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../implementation/" class="btn btn-neutral float-right" title="Init, Process, Protocols">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../design/" class="btn btn-neutral" title="Architecture"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/apache/dubbo-website/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../design/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../implementation/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
