<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="routing-rule" />
	<meta name="description" content="routing-rule" />
	<!-- 网页标签标题 -->
	<title>routing-rule</title>
	<link rel="shortcut icon" href="/img/dubbo.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot="" data-reactid="1" data-react-checksum="1579548289"><header class="header-container header-container-normal" data-reactid="2"><div class="header-body" data-reactid="3"><a href="/en-us/index.html" data-reactid="4"><img class="logo" src="/img/dubbo_colorful.png" data-reactid="5"/></a><div class="search search-normal" data-reactid="6"><span class="icon-search" data-reactid="7"></span></div><span class="language-switch language-switch-normal" data-reactid="8">中</span><div class="header-menu" data-reactid="9"><img class="header-menu-toggle" src="/img/menu_gray.png" data-reactid="10"/><ul data-reactid="11"><li class="menu-item menu-item-normal" data-reactid="12"><a href="/en-us/index.html" data-reactid="13">HOME</a></li><li class="menu-item menu-item-normal menu-item-normal-active" data-reactid="14"><a href="/en-us/docs/user/quick-start.html" data-reactid="15">DOCS</a></li><li class="menu-item menu-item-normal" data-reactid="16"><a href="/en-us/blog/index.html" data-reactid="17">BLOG</a></li><li class="menu-item menu-item-normal" data-reactid="18"><a href="/en-us/community/index.html" data-reactid="19">COMMUNITY</a></li></ul></div></div></header><div class="bar" data-reactid="20"><div class="bar-body" data-reactid="21"><img src="/img/docs.png" class="front-img" data-reactid="22"/><span data-reactid="23">Documentation</span><img src="/img/docs.png" class="back-img" data-reactid="24"/></div></div><section class="content-section" data-reactid="25"><div class="sidemenu" data-reactid="26"><div class="sidemenu-toggle" data-reactid="27"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png" data-reactid="28"/></div><ul data-reactid="29"><li class="menu-item menu-item-level-1" data-reactid="30"><span data-reactid="31">User doc</span><ul data-reactid="32"><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="33"><span data-reactid="34"><!-- react-text: 35 -->Preface<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="36"/></span><ul data-reactid="37"><li class="menu-item menu-item-level-3" data-reactid="38"><a href="/en-us/docs/user/preface/background.html" target="_self" data-reactid="39">Background</a></li><li class="menu-item menu-item-level-3" data-reactid="40"><a href="/en-us/docs/user/preface/requirements.html" target="_self" data-reactid="41">Requirements</a></li><li class="menu-item menu-item-level-3" data-reactid="42"><a href="/en-us/docs/user/preface/architecture.html" target="_self" data-reactid="43">Architecture</a></li><li class="menu-item menu-item-level-3" data-reactid="44"><a href="/en-us/docs/user/preface/usage.html" target="_self" data-reactid="45">Usage</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="46"><a href="/en-us/docs/user/quick-start.html" target="_self" data-reactid="47">Quick start</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="48"><a href="/en-us/docs/user/dependencies.html" target="_self" data-reactid="49">Dependencies</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="50"><a href="/en-us/docs/user/maturity.html" target="_self" data-reactid="51">Maturality</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="52"><span data-reactid="53"><!-- react-text: 54 -->Configuration<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="55"/></span><ul data-reactid="56"><li class="menu-item menu-item-level-3" data-reactid="57"><a href="/en-us/docs/user/configuration/xml.html" target="_self" data-reactid="58">XML configuration</a></li><li class="menu-item menu-item-level-3" data-reactid="59"><a href="/en-us/docs/user/configuration/properties.html" target="_self" data-reactid="60">Properties configuration</a></li><li class="menu-item menu-item-level-3" data-reactid="61"><a href="/en-us/docs/user/configuration/api.html" target="_self" data-reactid="62">API configuration</a></li><li class="menu-item menu-item-level-3" data-reactid="63"><a href="/en-us/docs/user/configuration/annotation.html" target="_self" data-reactid="64">Annotation configuration</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="65"><span data-reactid="66"><!-- react-text: 67 -->Demos<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="68"/></span><ul data-reactid="69"><li class="menu-item menu-item-level-3" data-reactid="70"><a href="/en-us/docs/user/demos/preflight-check.html" target="_self" data-reactid="71">Start check</a></li><li class="menu-item menu-item-level-3" data-reactid="72"><a href="/en-us/docs/user/demos/fault-tolerent-strategy.html" target="_self" data-reactid="73">Fault-tolerent strategy</a></li><li class="menu-item menu-item-level-3" data-reactid="74"><a href="/en-us/docs/user/demos/loadbalance.html" target="_self" data-reactid="75">Load balance</a></li><li class="menu-item menu-item-level-3" data-reactid="76"><a href="/en-us/docs/user/demos/thread-model.html" target="_self" data-reactid="77">Thread model</a></li><li class="menu-item menu-item-level-3" data-reactid="78"><a href="/en-us/docs/user/demos/explicit-target.html" target="_self" data-reactid="79">Connecting certain provider straightly</a></li><li class="menu-item menu-item-level-3" data-reactid="80"><a href="/en-us/docs/user/demos/subscribe-only.html" target="_self" data-reactid="81">Subscribe only</a></li><li class="menu-item menu-item-level-3" data-reactid="82"><a href="/en-us/docs/user/demos/registry-only.html" target="_self" data-reactid="83">Registry only</a></li><li class="menu-item menu-item-level-3" data-reactid="84"><a href="/en-us/docs/user/demos/static-service.html" target="_self" data-reactid="85">Static service</a></li><li class="menu-item menu-item-level-3" data-reactid="86"><a href="/en-us/docs/user/demos/multi-protocols.html" target="_self" data-reactid="87">Multi-protocols</a></li><li class="menu-item menu-item-level-3" data-reactid="88"><a href="/en-us/docs/user/demos/multi-registry.html" target="_self" data-reactid="89">Multi-registries</a></li><li class="menu-item menu-item-level-3" data-reactid="90"><a href="/en-us/docs/user/demos/service-group.html" target="_self" data-reactid="91">Service group</a></li><li class="menu-item menu-item-level-3" data-reactid="92"><a href="/en-us/docs/user/demos/multi-versions.html" target="_self" data-reactid="93">Multi-versions</a></li><li class="menu-item menu-item-level-3" data-reactid="94"><a href="/en-us/docs/user/demos/group-merger.html" target="_self" data-reactid="95">Group merger</a></li><li class="menu-item menu-item-level-3" data-reactid="96"><a href="/en-us/docs/user/demos/parameter-validation.html" target="_self" data-reactid="97">Parameter validation</a></li><li class="menu-item menu-item-level-3" data-reactid="98"><a href="/en-us/docs/user/demos/result-cache.html" target="_self" data-reactid="99">Result cache</a></li><li class="menu-item menu-item-level-3" data-reactid="100"><a href="/en-us/docs/user/demos/generic-reference.html" target="_self" data-reactid="101">Generic reference</a></li><li class="menu-item menu-item-level-3" data-reactid="102"><a href="/en-us/docs/user/demos/generic-service.html" target="_self" data-reactid="103">Generic service</a></li><li class="menu-item menu-item-level-3" data-reactid="104"><a href="/en-us/docs/user/demos/echo-service.html" target="_self" data-reactid="105">Echo service</a></li><li class="menu-item menu-item-level-3" data-reactid="106"><a href="/en-us/docs/user/demos/context.html" target="_self" data-reactid="107">Context</a></li><li class="menu-item menu-item-level-3" data-reactid="108"><a href="/en-us/docs/user/demos/attachment.html" target="_self" data-reactid="109">Attachment</a></li><li class="menu-item menu-item-level-3" data-reactid="110"><a href="/en-us/docs/user/demos/async-call.html" target="_self" data-reactid="111">Asynchronous call</a></li><li class="menu-item menu-item-level-3" data-reactid="112"><a href="/en-us/docs/user/demos/local-call.html" target="_self" data-reactid="113">Local call</a></li><li class="menu-item menu-item-level-3" data-reactid="114"><a href="/en-us/docs/user/demos/callback-parameter.html" target="_self" data-reactid="115">Callback parameter</a></li><li class="menu-item menu-item-level-3" data-reactid="116"><a href="/en-us/docs/user/demos/events-notify.html" target="_self" data-reactid="117">Events notify</a></li><li class="menu-item menu-item-level-3" data-reactid="118"><a href="/en-us/docs/user/demos/local-stub.html" target="_self" data-reactid="119">Local stub</a></li><li class="menu-item menu-item-level-3" data-reactid="120"><a href="/en-us/docs/user/demos/local-mock.html" target="_self" data-reactid="121">Local mock</a></li><li class="menu-item menu-item-level-3" data-reactid="122"><a href="/en-us/docs/user/demos/delay-publish.html" target="_self" data-reactid="123">Delay publish</a></li><li class="menu-item menu-item-level-3" data-reactid="124"><a href="/en-us/docs/user/demos/concurrency-control.html" target="_self" data-reactid="125">Concurrency control</a></li><li class="menu-item menu-item-level-3" data-reactid="126"><a href="/en-us/docs/user/demos/config-connections.html" target="_self" data-reactid="127">Connections limitation</a></li><li class="menu-item menu-item-level-3" data-reactid="128"><a href="/en-us/docs/user/demos/lazy-connect.html" target="_self" data-reactid="129">Lazy connect</a></li><li class="menu-item menu-item-level-3" data-reactid="130"><a href="/en-us/docs/user/demos/stickiness.html" target="_self" data-reactid="131">Stickness connections</a></li><li class="menu-item menu-item-level-3" data-reactid="132"><a href="/en-us/docs/user/demos/token-authorization.html" target="_self" data-reactid="133">Token authorization</a></li><li class="menu-item menu-item-level-3" data-reactid="134"><a href="/en-us/docs/user/demos/routing-rule.html" target="_self" data-reactid="135">Routing rule</a></li><li class="menu-item menu-item-level-3" data-reactid="136"><a href="/en-us/docs/user/demos/config-rule.html" target="_self" data-reactid="137">Configuration rule</a></li><li class="menu-item menu-item-level-3" data-reactid="138"><a href="/en-us/docs/user/demos/service-downgrade.html" target="_self" data-reactid="139">Service downgrade</a></li><li class="menu-item menu-item-level-3" data-reactid="140"><a href="/en-us/docs/user/demos/graceful-shutdown.html" target="_self" data-reactid="141">Graceful shutdown</a></li><li class="menu-item menu-item-level-3" data-reactid="142"><a href="/en-us/docs/user/demos/hostname-binding.html" target="_self" data-reactid="143">Hostname binding</a></li><li class="menu-item menu-item-level-3" data-reactid="144"><a href="/en-us/docs/user/demos/logger-strategy.html" target="_self" data-reactid="145">Logger strategy</a></li><li class="menu-item menu-item-level-3" data-reactid="146"><a href="/en-us/docs/user/demos/accesslog.html" target="_self" data-reactid="147">Accesslog</a></li><li class="menu-item menu-item-level-3" data-reactid="148"><a href="/en-us/docs/user/demos/service-container.html" target="_self" data-reactid="149">Service container</a></li><li class="menu-item menu-item-level-3" data-reactid="150"><a href="/en-us/docs/user/demos/reference-config-cache.html" target="_self" data-reactid="151">Reference config cache</a></li><li class="menu-item menu-item-level-3" data-reactid="152"><a href="/en-us/docs/user/demos/distributed-transaction.html" target="_self" data-reactid="153">Distributed transaction</a></li><li class="menu-item menu-item-level-3" data-reactid="154"><a href="/en-us/docs/user/demos/dump.html" target="_self" data-reactid="155">Automatic thread dump</a></li><li class="menu-item menu-item-level-3" data-reactid="156"><a href="/en-us/docs/user/demos/netty4.html" target="_self" data-reactid="157">Netty4</a></li><li class="menu-item menu-item-level-3" data-reactid="158"><a href="/en-us/docs/user/demos/serialization.html" target="_self" data-reactid="159">Serialization with FST and Kyro</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="160"><a href="/en-us/docs/user/references/api.html" target="_self" data-reactid="161">API configuration reference</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="162"><span data-reactid="163"><!-- react-text: 164 -->Schema configuration reference<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="165"/></span><ul data-reactid="166"><li class="menu-item menu-item-level-3" data-reactid="167"><a href="/en-us/docs/user/references/xml/introduction.html" target="_self" data-reactid="168">Introduction</a></li><li class="menu-item menu-item-level-3" data-reactid="169"><a href="/en-us/docs/user/references/xml/dubbo-service.html" target="_self" data-reactid="170">dubbo:service</a></li><li class="menu-item menu-item-level-3" data-reactid="171"><a href="/en-us/docs/user/references/xml/dubbo-reference.html" target="_self" data-reactid="172">dubbo:reference</a></li><li class="menu-item menu-item-level-3" data-reactid="173"><a href="/en-us/docs/user/references/xml/dubbo-protocol.html" target="_self" data-reactid="174">dubbo:protocol</a></li><li class="menu-item menu-item-level-3" data-reactid="175"><a href="/en-us/docs/user/references/xml/dubbo-registry.html" target="_self" data-reactid="176">dubbo:registry</a></li><li class="menu-item menu-item-level-3" data-reactid="177"><a href="/en-us/docs/user/references/xml/dubbo-monitor.html" target="_self" data-reactid="178">dubbo:monitor</a></li><li class="menu-item menu-item-level-3" data-reactid="179"><a href="/en-us/docs/user/references/xml/dubbo-application.html" target="_self" data-reactid="180">dubbo:application</a></li><li class="menu-item menu-item-level-3" data-reactid="181"><a href="/en-us/docs/user/references/xml/dubbo-module.html" target="_self" data-reactid="182">dubbo:module</a></li><li class="menu-item menu-item-level-3" data-reactid="183"><a href="/en-us/docs/user/references/xml/dubbo-provider.html" target="_self" data-reactid="184">dubbo:provider</a></li><li class="menu-item menu-item-level-3" data-reactid="185"><a href="/en-us/docs/user/references/xml/dubbo-consumer.html" target="_self" data-reactid="186">dubbo:consumer</a></li><li class="menu-item menu-item-level-3" data-reactid="187"><a href="/en-us/docs/user/references/xml/dubbo-method.html" target="_self" data-reactid="188">dubbo:method</a></li><li class="menu-item menu-item-level-3" data-reactid="189"><a href="/en-us/docs/user/references/xml/dubbo-argument.html" target="_self" data-reactid="190">dubbo:argument</a></li><li class="menu-item menu-item-level-3" data-reactid="191"><a href="/en-us/docs/user/references/xml/dubbo-parameter.html" target="_self" data-reactid="192">dubbo:parameter</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="193"><span data-reactid="194"><!-- react-text: 195 -->Protocol configuration reference<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="196"/></span><ul data-reactid="197"><li class="menu-item menu-item-level-3" data-reactid="198"><a href="/en-us/docs/user/references/protocol/introduction.html" target="_self" data-reactid="199">Introduction</a></li><li class="menu-item menu-item-level-3" data-reactid="200"><a href="/en-us/docs/user/references/protocol/dubbo.html" target="_self" data-reactid="201">dubbo://</a></li><li class="menu-item menu-item-level-3" data-reactid="202"><a href="/en-us/docs/user/references/protocol/rmi.html" target="_self" data-reactid="203">rmi://</a></li><li class="menu-item menu-item-level-3" data-reactid="204"><a href="/en-us/docs/user/references/protocol/hessian.html" target="_self" data-reactid="205">hessian://</a></li><li class="menu-item menu-item-level-3" data-reactid="206"><a href="/en-us/docs/user/references/protocol/http.html" target="_self" data-reactid="207">http://</a></li><li class="menu-item menu-item-level-3" data-reactid="208"><a href="/en-us/docs/user/references/protocol/webservice.html" target="_self" data-reactid="209">webservice://</a></li><li class="menu-item menu-item-level-3" data-reactid="210"><a href="/en-us/docs/user/references/protocol/thrift.html" target="_self" data-reactid="211">thrift://</a></li><li class="menu-item menu-item-level-3" data-reactid="212"><a href="/en-us/docs/user/references/protocol/memcached.html" target="_self" data-reactid="213">memcached://</a></li><li class="menu-item menu-item-level-3" data-reactid="214"><a href="/en-us/docs/user/references/protocol/redis.html" target="_self" data-reactid="215">redis://</a></li><li class="menu-item menu-item-level-3" data-reactid="216"><a href="/en-us/docs/user/references/protocol/rest.html" target="_self" data-reactid="217">rest://</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="218"><span data-reactid="219"><!-- react-text: 220 -->Registry configuration reference<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="221"/></span><ul data-reactid="222"><li class="menu-item menu-item-level-3" data-reactid="223"><a href="/en-us/docs/user/references/registry/introduction.html" target="_self" data-reactid="224">Introduction</a></li><li class="menu-item menu-item-level-3" data-reactid="225"><a href="/en-us/docs/user/references/registry/multicast.html" target="_self" data-reactid="226">Multicast registry</a></li><li class="menu-item menu-item-level-3" data-reactid="227"><a href="/en-us/docs/user/references/registry/zookeeper.html" target="_self" data-reactid="228">Zookeeper registry</a></li><li class="menu-item menu-item-level-3" data-reactid="229"><a href="/en-us/docs/user/references/registry/redis.html" target="_self" data-reactid="230">Redis registry</a></li><li class="menu-item menu-item-level-3" data-reactid="231"><a href="/en-us/docs/user/references/registry/simple.html" target="_self" data-reactid="232">Simple registry</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="233"><a href="/en-us/docs/user/references/telnet.html" target="_self" data-reactid="234">Telnet command</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="235"><a href="/en-us/docs/user/references/maven.html" target="_self" data-reactid="236">Maven plugin</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="237"><a href="/en-us/docs/user/best-practice.html" target="_self" data-reactid="238">Best practice</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="239"><a href="/en-us/docs/user/recommend.html" target="_self" data-reactid="240">Recommended usage</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="241"><a href="/en-us/docs/user/capacity-plan.html" target="_self" data-reactid="242">Capacity plan</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="243"><a href="/en-us/docs/user/perf-test.html" target="_self" data-reactid="244">Performance testing reports</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="245"><a href="/en-us/docs/user/coveragence.html" target="_self" data-reactid="246">Test coverage report</a></li></ul></li><li class="menu-item menu-item-level-1" data-reactid="247"><span data-reactid="248">Developer guide</span><ul data-reactid="249"><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="250"><a href="/en-us/docs/dev/build.html" target="_self" data-reactid="251">How To Build</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="252"><a href="/en-us/docs/dev/design.html" target="_self" data-reactid="253">Architecture</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="254"><a href="/en-us/docs/dev/SPI.html" target="_self" data-reactid="255">How SPI Works</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="256"><a href="/en-us/docs/dev/implementation.html" target="_self" data-reactid="257">Init, Process, Protocols</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="258"><span data-reactid="259"><!-- react-text: 260 -->SPI Extensions<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="261"/></span><ul data-reactid="262"><li class="menu-item menu-item-level-3" data-reactid="263"><a href="/en-us/docs/dev/impls/protocol.html" target="_self" data-reactid="264">Protocol</a></li><li class="menu-item menu-item-level-3" data-reactid="265"><a href="/en-us/docs/dev/impls/filter.html" target="_self" data-reactid="266">Filter</a></li><li class="menu-item menu-item-level-3" data-reactid="267"><a href="/en-us/docs/dev/impls/invoker-listener.html" target="_self" data-reactid="268">InvokerListener</a></li><li class="menu-item menu-item-level-3" data-reactid="269"><a href="/en-us/docs/dev/impls/exporter-listener.html" target="_self" data-reactid="270">ExporterListener</a></li><li class="menu-item menu-item-level-3" data-reactid="271"><a href="/en-us/docs/dev/impls/cluster.html" target="_self" data-reactid="272">Cluster</a></li><li class="menu-item menu-item-level-3" data-reactid="273"><a href="/en-us/docs/dev/impls/router.html" target="_self" data-reactid="274">Router</a></li><li class="menu-item menu-item-level-3" data-reactid="275"><a href="/en-us/docs/dev/impls/load-balance.html" target="_self" data-reactid="276">LoadBalance</a></li><li class="menu-item menu-item-level-3" data-reactid="277"><a href="/en-us/docs/dev/impls/merger.html" target="_self" data-reactid="278">Merger</a></li><li class="menu-item menu-item-level-3" data-reactid="279"><a href="/en-us/docs/dev/impls/registry.html" target="_self" data-reactid="280">Registry</a></li><li class="menu-item menu-item-level-3" data-reactid="281"><a href="/en-us/docs/dev/impls/monitor.html" target="_self" data-reactid="282">Monitor</a></li><li class="menu-item menu-item-level-3" data-reactid="283"><a href="/en-us/docs/dev/impls/extension-factory.html" target="_self" data-reactid="284">ExtensionFactory</a></li><li class="menu-item menu-item-level-3" data-reactid="285"><a href="/en-us/docs/dev/impls/proxy-factory.html" target="_self" data-reactid="286">ProxyFactory</a></li><li class="menu-item menu-item-level-3" data-reactid="287"><a href="/en-us/docs/dev/impls/compiler.html" target="_self" data-reactid="288">Compiler</a></li><li class="menu-item menu-item-level-3" data-reactid="289"><a href="/en-us/docs/dev/impls/dispatcher.html" target="_self" data-reactid="290">Dispatcher</a></li><li class="menu-item menu-item-level-3" data-reactid="291"><a href="/en-us/docs/dev/impls/threadpool.html" target="_self" data-reactid="292">Threadpool</a></li><li class="menu-item menu-item-level-3" data-reactid="293"><a href="/en-us/docs/dev/impls/serialize.html" target="_self" data-reactid="294">Serialization</a></li><li class="menu-item menu-item-level-3" data-reactid="295"><a href="/en-us/docs/dev/impls/remoting.html" target="_self" data-reactid="296">Remoting</a></li><li class="menu-item menu-item-level-3" data-reactid="297"><a href="/en-us/docs/dev/impls/exchanger.html" target="_self" data-reactid="298">Exchanger</a></li><li class="menu-item menu-item-level-3" data-reactid="299"><a href="/en-us/docs/dev/impls/networker.html" target="_self" data-reactid="300">Networker</a></li><li class="menu-item menu-item-level-3" data-reactid="301"><a href="/en-us/docs/dev/impls/telnet-handler.html" target="_self" data-reactid="302">TelnetHandler</a></li><li class="menu-item menu-item-level-3" data-reactid="303"><a href="/en-us/docs/dev/impls/status-checker.html" target="_self" data-reactid="304">StatusChecker</a></li><li class="menu-item menu-item-level-3" data-reactid="305"><a href="/en-us/docs/dev/impls/container.html" target="_self" data-reactid="306">Container</a></li><li class="menu-item menu-item-level-3" data-reactid="307"><a href="/en-us/docs/dev/impls/page.html" target="_self" data-reactid="308">PageHandler</a></li><li class="menu-item menu-item-level-3" data-reactid="309"><a href="/en-us/docs/dev/impls/cache.html" target="_self" data-reactid="310">Cache</a></li><li class="menu-item menu-item-level-3" data-reactid="311"><a href="/en-us/docs/dev/impls/validation.html" target="_self" data-reactid="312">Validation</a></li><li class="menu-item menu-item-level-3" data-reactid="313"><a href="/en-us/docs/dev/impls/logger-adapter.html" target="_self" data-reactid="314">LoggerAdapter</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="315"><a href="/en-us/docs/dev/contract.html" target="_self" data-reactid="316">Contract</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="317"><a href="/en-us/docs/dev/coding.html" target="_self" data-reactid="318">Code Style</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="319"><a href="/en-us/docs/dev/release.html" target="_self" data-reactid="320">Versions</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="321"><a href="/en-us/docs/dev/contribution.html" target="_self" data-reactid="322">Contribution</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="323"><a href="/en-us/docs/dev/checklist.html" target="_self" data-reactid="324">Checklist</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="325"><a href="/en-us/docs/dev/code-smell.html" target="_self" data-reactid="326">Code Smell</a></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="327"><a href="/en-us/docs/dev/TCK.html" target="_self" data-reactid="328">TCK</a></li></ul></li><li class="menu-item menu-item-level-1" data-reactid="329"><span data-reactid="330">Admin guide</span><ul data-reactid="331"><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="332"><span data-reactid="333"><!-- react-text: 334 -->Installation<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="335"/></span><ul data-reactid="336"><li class="menu-item menu-item-level-3" data-reactid="337"><a href="/en-us/docs/admin/install/provider-demo.html" target="_self" data-reactid="338">Install provider demo</a></li><li class="menu-item menu-item-level-3" data-reactid="339"><a href="/en-us/docs/admin/install/consumer-demo.html" target="_self" data-reactid="340">Install consumer demo</a></li><li class="menu-item menu-item-level-3" data-reactid="341"><a href="/en-us/docs/admin/install/zookeeper.html" target="_self" data-reactid="342">Install Zookeeper configuration center</a></li><li class="menu-item menu-item-level-3" data-reactid="343"><a href="/en-us/docs/admin/install/redis.html" target="_self" data-reactid="344">Install Redis configuration center</a></li><li class="menu-item menu-item-level-3" data-reactid="345"><a href="/en-us/docs/admin/install/simple-registry-center.html" target="_self" data-reactid="346">Install Simple configuration center</a></li><li class="menu-item menu-item-level-3" data-reactid="347"><a href="/en-us/docs/admin/install/simple-monitor-center.html" target="_self" data-reactid="348">Install Simple monitor center</a></li><li class="menu-item menu-item-level-3" data-reactid="349"><a href="/en-us/docs/admin/install/admin-console.html" target="_self" data-reactid="350">Install admin console</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="351"><span data-reactid="352"><!-- react-text: 353 -->Operation manual<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="354"/></span><ul data-reactid="355"><li class="menu-item menu-item-level-3" data-reactid="356"><a href="/en-us/docs/admin/ops/dubbo-ops.html" target="_self" data-reactid="357">Admin console operation guide</a></li><li class="menu-item menu-item-level-3" data-reactid="358"><a href="/en-us/docs/admin/ops/pinpoint.html" target="_self" data-reactid="359">Tracking with Pinpoint</a></li><li class="menu-item menu-item-level-3" data-reactid="360"><a href="/en-us/docs/admin/ops/skywalking.html" target="_self" data-reactid="361">Tracking with Skywalking</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body" data-reactid="362"><h1>Routing Rules</h1>
<p>The routing rules <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> determine the target server of one service call. It has two kinds of routing rules: conditional routing rules and script routing rules. It also support extension<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>.</p>
<h2>Write Routing Rules</h2>
<p>Writing routing rules to the registry is usually done by the monitoring center or the console page.</p>
<pre><code class="language-java">RegistryFactory registryFactory = ExtensionLoader.getExtensionLoader(RegistryFactory.class).getAdaptiveExtension();
Registry registry = registryFactory.getRegistry(URL.valueOf(<span class="hljs-string">"zookeeper://10.20.153.10:2181"</span>));
registry.register(URL.valueOf(<span class="hljs-string">"condition://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule="</span> + URL.encode(<span class="hljs-string">"host = 10.20.153.10 =&gt; host = 10.20.153.11"</span>)));
</code></pre>
<p>其中：</p>
<ul>
<li><code>condition://</code> It indicates the type of routing rules, supports routing rules and script routing rules, and can be extended. <strong>Required</strong>。</li>
<li><code>0.0.0.0</code> It indicates that all IP addresses are valid. If you want to take effect for only one IP address, fill in the IP address. <strong>Required</strong>。</li>
<li><code>com.foo.BarService</code> It indicates that the specified service is effective. <strong>Required</strong>。</li>
<li><code>group=foo</code> It indicates that the specified service in specified group is effective. When absent, the specified service which dosen't configure group is effective.</li>
<li><code>version=1.0</code>It indicates that the specified service in specified version is effective. When absent, the specified service which dosen't configure version is effective.</li>
<li><code>category=routers</code> It indicates that the data is a dynamic configuration type. <strong>Required</strong>。</li>
<li><code>dynamic=false</code> It indicates that it is persistent data. When the registrant exits, the data is still stored in the registry. <strong>Required</strong>。</li>
<li><code>enabled=true</code> It indicates whether this routing rules is effective. Option, and default effective.</li>
<li><code>force=false</code> It indicates whether it is forced to be executed when the routing result is null. If it is not enforced, the route will be automatically invalidated. Option, and default <code>false</code>.</li>
<li><code>runtime=false</code> It indicates whether to execute routing rules at every call. If not, the result is only pre-executed and cached when the provider's address list changes.  It will get routing result from cache when the service is invoked. If you use parameter routing, you must to configure it as <code>true</code>. Be careful that the configuration will affect the performance. Option, and default <code>false</code>.</li>
<li><code>priority=1</code> The priority of the routing rules. it is used for sorting, the greater the priority, the more front execution. Option, and default <code>0</code>。</li>
<li><code>rule=URL.encode(&quot;host = 10.20.153.10 =&gt; host = 10.20.153.11&quot;)</code> It indicates the content of routing rule，<strong>Required</strong>。</li>
</ul>
<h2>Conditional routing rules</h2>
<p>Routing rules based on conditional expressions, such as：<code>host = 10.20.153.10 =&gt; host = 10.20.153.11</code></p>
<h3>Rules：</h3>
<ul>
<li>The previous of <code>=&gt;</code> is matched condition for consumer. All parameters compare with URL of consumers. When the consumer meet the condition, it will continue to execute the behind filter rules for consumer.</li>
<li>After the <code>=&gt;</code> aims to filter the provider address list.  All the parameters are compared against the provider's URL, and consumer get only the filtered address list at finally.</li>
<li>If the previous condition for consumer is empty, it means all consumers can matched. such as : <code>=&gt; host != 10.20.153.11</code></li>
<li>If the filter condition for provider is empty, it means it is forbidden to visit. such as :<code>host = 10.20.153.10 =&gt;</code></li>
</ul>
<h3>Expressions：</h3>
<p>Parameter Support：</p>
<ul>
<li>Service call information, such as: method, argument etc. Parameter routing is currently not supported</li>
<li>URL field (On URL own), such as: protocol, host, port etc.</li>
<li>All parameters on the URL. such as: application, organization etc.</li>
</ul>
<p>Condition Support：</p>
<ul>
<li>Equal sign <code>=</code> indicates match. such as: <code>host = 10.20.153.10</code></li>
<li>Not equal sign <code>!=</code> indicates &quot;does not match&quot;. such as: <code>host != 10.20.153.10</code>.</li>
</ul>
<p>Value Support：</p>
<ul>
<li>Separate multiple values with a comma <code>,</code> .  Such as：<code>host != 10.20.153.10,10.20.153.11</code></li>
<li>End with  <code>*</code> to indicate wildcard.  Such as： <code>host != 10.20.*</code></li>
<li>Start with <code>$</code> to indicate reference to consumer parameters. Such as: <code>host = $host</code></li>
</ul>
<h3>Samples</h3>
<ol start="0">
<li>
<p>Exclude pre-release machine：</p>
<pre><code>=&gt; host != 172.22.3.91
</code></pre>
</li>
<li>
<p>Whitelist <sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>：</p>
<pre><code>host != 10.20.153.10,10.20.153.11 =&gt;
</code></pre>
</li>
<li>
<p>Blacklist：</p>
<pre><code>host = 10.20.153.10,10.20.153.11 =&gt;
</code></pre>
</li>
<li>
<p>Service boarding application only expose part of the machine to prevent the entire cluster hanging up:</p>
<pre><code>=&gt; host = 172.22.3.1*,172.22.3.2*
</code></pre>
</li>
<li>
<p>Additional machines for important applications：</p>
<pre><code>application != kylin =&gt; host != 172.22.3.95,172.22.3.96
</code></pre>
</li>
<li>
<p>Read and write separation：</p>
<pre><code>method = find*,list*,get*,is* =&gt; host = 172.22.3.94,172.22.3.95,172.22.3.96
method != find*,list*,get*,is* =&gt; host = 172.22.3.97,172.22.3.98
</code></pre>
</li>
<li>
<p>Separation of Front and Background Application：</p>
<pre><code>application = bops =&gt; host = 172.22.3.91,172.22.3.92,172.22.3.93
application != bops =&gt; host = 172.22.3.94,172.22.3.95,172.22.3.96
</code></pre>
</li>
<li>
<p>Isolate different network segments：</p>
<pre><code>host != 172.22.3.* =&gt; host != 172.22.3.*
</code></pre>
</li>
<li>
<p>Providers and consumers deployed in the same cluster, the machine only visit the local service：</p>
<pre><code>=&gt; host = $host
</code></pre>
</li>
</ol>
<h2>Script routing rules</h2>
<p>Script routing rules <sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup> support all scripts of JDK script engine. such as: javascript, jruby, groovy, etc. Configure the script type by <code>type=javascript</code>, the default is javascript.</p>
<pre><code>&quot;script://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule=&quot; + URL.encode(&quot;(function route(invokers) { ... } (invokers))&quot;)
</code></pre>
<p>Routing rules that base on script engine is as follow：</p>
<pre><code class="language-javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">route</span>(<span class="hljs-params">invokers</span>) </span>{
    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> java.util.ArrayList(invokers.size());
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; invokers.size(); i ++) {
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"10.20.153.10"</span>.equals(invokers.get(i).getUrl().getHost())) {
            result.add(invokers.get(i));
        }
    }
    <span class="hljs-keyword">return</span> result;
} (invokers)); <span class="hljs-comment">// Indicates that the method is executed immediately</span>
</code></pre>
<h2>Tag routing rules</h2>
<p>Tag routing rules <sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup> , when the application configures the <code>TagRouter</code> , a tagged dubbo invocation can intelligently route to the service provider which has the corresponding tag.</p>
<h3>Provider</h3>
<ol>
<li>configure TagRouter for the application</li>
</ol>
<pre><code class="language-Java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ApplicationConfig <span class="hljs-title">applicationConfig</span><span class="hljs-params">()</span> </span>{
    ApplicationConfig applicationConfig = <span class="hljs-keyword">new</span> ApplicationConfig();
    applicationConfig.setName(<span class="hljs-string">"provider-book"</span>);
    applicationConfig.setQosEnable(<span class="hljs-keyword">false</span>);
    <span class="hljs-comment">// instruct tag router</span>
    Map&lt;String,String&gt; parameters = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    parameters.put(Constants.ROUTER_KEY, <span class="hljs-string">"tag"</span>);
    applicationConfig.setParameters(parameters);
    <span class="hljs-keyword">return</span> applicationConfig;
}
</code></pre>
<ol start="2">
<li>configure specfic tag for the provider</li>
</ol>
<pre><code class="language-java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ProviderConfig <span class="hljs-title">providerConfig</span><span class="hljs-params">()</span></span>{
	ProviderConfig providerConfig = <span class="hljs-keyword">new</span> ProviderConfig();
	providerConfig.setTag(<span class="hljs-string">"red"</span>);
	<span class="hljs-keyword">return</span> providerConfig;
}
</code></pre>
<p>The application which configures no tag will be considered as the default application, and these default apps will be treated as downgrades when the invocation fails to match the provider.</p>
<h3>Consumer</h3>
<pre><code class="language-Java">RpcContext.getContext().setAttachment(Constants.REQUEST_TAG_KEY,<span class="hljs-string">"red"</span>);
</code></pre>
<p>The scope of the <code>request.tag</code> is for each invocation, using the attachment to pass the request tag. Note that the value stored in the attachment will be passed continuously in a complete remote invocation, thanks to this feature, we only need to set the tag at the beginning of a invocation.</p>
<blockquote>
<p>Currently, only <strong>hardcoding</strong> is supported to set requestTag. Note that RpcContext is thread-bound, elegantly using the TagRouter feature, it is recommended to set the request tag via a servlet filter (in the web environment) or a custom dubbo SPI filter.</p>
</blockquote>
<h3>Rules:</h3>
<ol>
<li>
<p><code>request.tag=red</code> will firstlt choose the provider which configures as <code>tag=red</code>. If there is no service corresponding to the request tag in the cluster, it will downgrade to <code>tag=null</code> provider, seen as default provider。</p>
</li>
<li>
<p>when <code>request.tag=null</code>, only <code>tag=null</code>  provider will be matched. Even if there are services available in the cluster, the tags do not match, they cannot be called. This is different from rule 1. Tagged invocation can be downgraded to untagged services, but invocations that do not carry tags/carry other types of tags can never be accessed other tag services.</p>
</li>
</ol>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>Support since <code>2.2.0</code> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p>Routing Rules Extension Point: <a href="http://dubbo.apache.org/books/dubbo-dev-book-en/impls/router.html">Route Extension</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn3" class="footnote-item"><p>Note: A service can only have one whitelist rule, otherwise the two rules will be filtered out. <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn4" class="footnote-item"><p>Note: Scripts have no sandbox constraints, can execute arbitrary code, and poses a backdoor risk. <a href="#fnref4" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn5" class="footnote-item"><p>Support since <code>2.7.0</code> <a href="#fnref5" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>
</div></section><footer class="footer-container" data-reactid="363"><div class="footer-body" data-reactid="364"><img src="/img/dubbo_gray.png" data-reactid="365"/><img class="apache" src="/img/apache_logo.png" data-reactid="366"/><div class="cols-container" data-reactid="367"><div class="col col-12" data-reactid="368"><h3 data-reactid="369">Disclaimer</h3><p data-reactid="370">Apache Dubbo is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p></div><div class="col col-4" data-reactid="371"><dl data-reactid="372"><dt data-reactid="373">ASF</dt><dd data-reactid="374"><a href="http://www.apache.org" data-reactid="375">Foundation</a></dd><dd data-reactid="376"><a href="http://www.apache.org/licenses/" data-reactid="377">License</a></dd><dd data-reactid="378"><a href="http://www.apache.org/events/current-event" data-reactid="379">Events</a></dd><dd data-reactid="380"><a href="http://www.apache.org/foundation/sponsorship.html" data-reactid="381">Sponsorship</a></dd><dd data-reactid="382"><a href="http://www.apache.org/foundation/thanks.html" data-reactid="383">Thanks</a></dd></dl></div><div class="col col-4" data-reactid="384"><dl data-reactid="385"><dt data-reactid="386">Documentation</dt><dd data-reactid="387"><a href="/en-us/docs/user/quick-start.html" target="_self" data-reactid="388">Quick start</a></dd><dd data-reactid="389"><a href="/en-us/docs/dev/build.html" target="_self" data-reactid="390">Developer guide</a></dd><dd data-reactid="391"><a href="/en-us/docs/admin/ops/dubbo-ops.html" target="_self" data-reactid="392">Admin manual</a></dd></dl></div><div class="col col-4" data-reactid="393"><dl data-reactid="394"><dt data-reactid="395">Resources</dt><dd data-reactid="396"><a href="/en-us/blog/index.html" target="_self" data-reactid="397">Blog</a></dd><dd data-reactid="398"><a href="/en-us/community/index.html" target="_self" data-reactid="399">Community</a></dd></dl></div></div><div class="copyright" data-reactid="400"><span data-reactid="401">Copyright © 2018 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
  <script src="/build/documentation.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112489517-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-112489517-1');
	</script>
</body>
</html>