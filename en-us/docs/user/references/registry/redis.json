{
  "filename": "redis.md",
  "__html": "<h1>Redis Registry Server</h1>\n<p>It is a registry server implementation <sup class=\"footnote-ref\"><a href=\"#fn1\" id=\"fnref1\">[1]</a></sup> based on redis <sup class=\"footnote-ref\"><a href=\"#fn2\" id=\"fnref2\">[2]</a></sup>.</p>\n<p><img src=\"../../sources/images/dubbo-redis-registry.jpg\" alt=\"/user-guide/images/dubbo-redis-registry.jpg\"></p>\n<p>Use key/map structure in redis to save the registration info:</p>\n<ul>\n<li>Main key for service name and type</li>\n<li>Key in the map is URL address</li>\n<li>Value in the map is the expiration time. Monitor center uses it to track and remove dirty data <sup class=\"footnote-ref\"><a href=\"#fn3\" id=\"fnref3\">[3]</a></sup></li>\n</ul>\n<p>Publish/Subscribe events in redis is leveraged for data change notification:</p>\n<ul>\n<li>Distinguish event type with event's value: <code>register</code>, <code>unregister</code>, <code>subscribe</code>, <code>unsubscribe</code>.</li>\n<li>Regular subscriber subscribes the particular key presenting service provider, then will receive <code>register</code> and <code>unregister</code> events fired from the specified service.</li>\n<li>Monitor center subscribes <code>/dubbo/*</code> via <code>psubscribe</code>, then will receive all change notifications from all services.</li>\n</ul>\n<p>Procedure:</p>\n<ol start=\"0\">\n<li>When service provider boots up, it adds its address under <code>Key:/dubbo/com.foo.BarService/providers</code>.</li>\n<li>Then service provider sends <code>register</code> event to <code>Channel:/dubbo/com.foo.BarService/providers</code></li>\n<li>When service consumer boots up, it subscribe events <code>register</code> and <code>unregister</code> from <code>Channel:/dubbo/com.foo.BarService/providers</code></li>\n<li>Then service consumer add its address under <code>Key:/dubbo/com.foo.BarService/providers</code></li>\n<li>When service consumer receives events <code>register</code> and <code>unregister</code>, it will fetch provider's addresses from <code>Key:/dubbo/com.foo.BarService/providers</code></li>\n<li>When monitor center boots up, it subscribes events <code>register</code>, <code>unregister</code>, <code>subscribe</code>, and <code>unsubsribe</code>.</li>\n<li>After monitor center receives <code>register</code> and <code>unregister</code>, it fetches provider's addresses from <code>Key:/dubbo/com.foo.BarService/providers</code></li>\n<li>After monitor center receives <code>subscribe</code> and <code>unsubscribe</code>, it fetches consumer's addresses from <code>Key:/dubbo/com.foo.BarService/consumers</code></li>\n</ol>\n<h2>Configuration</h2>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"redis://10.20.153.10:6379\"</span> /&gt;</span>\n</code></pre>\n<p>Or</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"redis://10.20.153.10:6379?backup=10.20.153.11:6379,10.20.153.12:6379\"</span> /&gt;</span>\n</code></pre>\n<p>Or</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">protocol</span>=<span class=\"hljs-string\">\"redis\"</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"10.20.153.10:6379\"</span> /&gt;</span>\n</code></pre>\n<p>Or</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">protocol</span>=<span class=\"hljs-string\">\"redis\"</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"10.20.153.10:6379,10.20.153.11:6379,10.20.153.12:6379\"</span> /&gt;</span>\n</code></pre>\n<h2>Options</h2>\n<ul>\n<li>Config key's prefix in redis via <code>&lt;dubbo:registry group=&quot;dubbo&quot; /&gt;</code>, the default value is <code>dubbo</code>.</li>\n<li>Config redis cluster strategy via <code>&lt;dubbo:registry cluster=&quot;replicate&quot; /&gt;</code>, the default value is <code>failover</code>:\n<ul>\n<li><code>failover</code>: when read/write error happens, try another instance, require the cluster to support data replication.</li>\n<li><code>replicate</code>: client writes to all nodes of the cluster, but only peeks a random node for read. The cluster doesn't need to take care of data replication, but may require more nodes and higher performance for each node, compared to option 1.</li>\n</ul>\n</li>\n</ul>\n<h2>Declaration of Reliability</h2>\n<p>A home-brewed service registry server is used in Alibaba instead of redis server. Redis based registry center does not have long-run practice within Alibaba, therefore we cannot guarantee its reliability. This registry server implementation is provided for dubbo community, and its reliability relies on redis itself largely.</p>\n<h2>Installation</h2>\n<p>Pls. refer to <a href=\"http://dubbo.apache.org/books/dubbo-admin-book/install/redis.html\">redis install manual</a> for how to install a redis based registry server. To set it up, specify <code>dubbo.registry.addrss</code> to <code>redis://127.0.0.1:6379</code> in <code>conf/dubbo.properties</code> for both provider and consumer (you can refer to <a href=\"../../preface/usage.md\">quick start</a>) after install a redis server.</p>\n<hr class=\"footnotes-sep\">\n<section class=\"footnotes\">\n<ol class=\"footnotes-list\">\n<li id=\"fn1\" class=\"footnote-item\"><p>Support since <code>2.1.0</code> <a href=\"#fnref1\" class=\"footnote-backref\">↩︎</a></p>\n</li>\n<li id=\"fn2\" class=\"footnote-item\"><p><a href=\"http://redis.io\">Redis</a> is a high performance KV cache server <a href=\"#fnref2\" class=\"footnote-backref\">↩︎</a></p>\n</li>\n<li id=\"fn3\" class=\"footnote-item\"><p>Heartbeat mechanism is used to detect the dirty data in redis. It requires time among servers must be sync in advanced, otherwise expiration check may inaccurate, plus, heartbeats may add extra pressure on servers. <a href=\"#fnref3\" class=\"footnote-backref\">↩︎</a></p>\n</li>\n</ol>\n</section>\n"
}