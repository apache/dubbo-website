{
  "filename": "zookeeper.md",
  "__html": "<h1>Zookeeper Registry Server</h1>\n<p><a href=\"http://zookeeper.apache.org\">Zookeeper</a> is the child project of apache hadoop. Since it offers tree-like directory service and supports change notification, it's suitable to use it as dubbo's registry server. It's a field-proven product, therefore it's recommended to use it in the production environment. <sup class=\"footnote-ref\"><a href=\"#fn1\" id=\"fnref1\">[1]</a></sup></p>\n<p><img src=\"../../sources/images/zookeeper.jpg\" alt=\"/user-guide/images/zookeeper.jpg\"></p>\n<p>Description on registration procedure:</p>\n<ul>\n<li>When service provider boots up: write service URL address under directory <code>/dubbo/com.foo.BarService/providers</code></li>\n<li>When service consumer boots up: subscribe to <code>/dubbo/com.foo.BarService/providers</code> for provider's URL addresses. At the same time, write consumer's URL address under <code>/dubbo/com.foo.BarService/providers</code>.</li>\n<li>When monitor center boots up: subscribe to <code>/dubbo/com.foo.BarService</code> for the URL addresses from all providers and consumers.</li>\n</ul>\n<p>The following abilities are supported:</p>\n<ul>\n<li>When provider stops by accident, registry server can remove its info automatically.</li>\n<li>When registry server reboots, all registration data and subscription requests can be recovered automatically.</li>\n<li>When session is expired, all registration data and subscription requests can be recovered automatically.</li>\n<li>When <code>&lt;dubbo:registry check=&quot;false&quot; /&gt;</code> is configured, failed requests for subscription and registration will be recorded and kept retrying in the background.</li>\n<li>Configure <code>&lt;dubbo:registry username=&quot;admin&quot; password=&quot;1234&quot; /&gt;</code> for zookeeper login.</li>\n<li>Configure <code>&lt;dubbo:registry group=&quot;dubbo&quot; /&gt;</code> for dubbo's root node on zookeeper. Default root node will be used if it's not specified.</li>\n<li>Support to use wildcard <code>*</code> in <code>&lt;dubbo:reference group=&quot;*&quot; version=&quot;*&quot; /&gt;</code> in order to subscribe all groups and all versions for the services to be referenced.</li>\n</ul>\n<h2>How to Use</h2>\n<p>Add zookeeper client dependency in both provider and consumer:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.zookeeper<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>zookeeper<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.3.3<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<p>Or <a href=\"http://repo1.maven.org/maven2/org/apache/zookeeper/zookeeper\">download</a> directly from apache.</p>\n<p>Dubbo supports two zookeeper clients: zkclient and curator:</p>\n<h3>Use zkclient</h3>\n<p>Since <code>2.2.0</code> dubbo uses zkclient by default, in order to improve the robustness. <a href=\"https://github.com/sgroschupf/zkclient\">zkclient</a> is a zookeeper client implementation open-sourced by Datameer.</p>\n<p>Default configuration:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">...</span> <span class=\"hljs-attr\">client</span>=<span class=\"hljs-string\">\"zkclient\"</span> /&gt;</span>\n</code></pre>\n<p>Or:</p>\n<pre><code class=\"language-sh\">dubbo.registry.client=zkclient\n</code></pre>\n<p>Or:</p>\n<pre><code class=\"language-sh\">zookeeper://10.20.153.10:2181?client=zkclient\n</code></pre>\n<p>In order to use it, need to explicitly declare the following maven dependency or <a href=\"http://repo1.maven.org/maven2/com/github/sgroschupf/zkclient\">download its client</a>.</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.github.sgroschupf<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>zkclient<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>0.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<h3>Use curator</h3>\n<p>Since <code>2.3.0</code> dubbo also supports curator but explicit configuration is required. <a href=\"https://github.com/Netflix/curator\">Curator</a> is the zookeeper client open-sourced by Netflix.</p>\n<p>In order to switch to curator, use the configuration below:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">...</span> <span class=\"hljs-attr\">client</span>=<span class=\"hljs-string\">\"curator\"</span> /&gt;</span>\n</code></pre>\n<p>Or:</p>\n<pre><code class=\"language-sh\">dubbo.registry.client=curator\n</code></pre>\n<p>Or:</p>\n<pre><code class=\"language-sh\">zookeeper://10.20.153.10:2181?client=curator\n</code></pre>\n<p>Also need to explicitly add maven dependency or directly <a href=\"http://repo1.maven.org/maven2/com/netflix/curator/curator-framework\">download</a> the jar:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.netflix.curator<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>curator-framework<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.1.10<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<p>Zookeeper single node configuration:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"zookeeper://10.20.153.10:2181\"</span> /&gt;</span>\n</code></pre>\n<p>Or:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">protocol</span>=<span class=\"hljs-string\">\"zookeeper\"</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"10.20.153.10:2181\"</span> /&gt;</span>\n</code></pre>\n<p>Zookeeper cluster configuration：</p>\n<pre><code class=\"language-xml\">\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"zookeeper://10.20.153.10:2181?backup=10.20.153.11:2181,10.20.153.12:2181\"</span> /&gt;</span>\n</code></pre>\n<p>Or:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">protocol</span>=<span class=\"hljs-string\">\"zookeeper\"</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"10.20.153.10:2181,10.20.153.11:2181,10.20.153.12:2181\"</span> /&gt;</span>\n</code></pre>\n<p>Configure single zookeeper to serve as multiple registry servers:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"chinaRegistry\"</span> <span class=\"hljs-attr\">protocol</span>=<span class=\"hljs-string\">\"zookeeper\"</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"10.20.153.10:2181\"</span> <span class=\"hljs-attr\">group</span>=<span class=\"hljs-string\">\"china\"</span> /&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:registry</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"intlRegistry\"</span> <span class=\"hljs-attr\">protocol</span>=<span class=\"hljs-string\">\"zookeeper\"</span> <span class=\"hljs-attr\">address</span>=<span class=\"hljs-string\">\"10.20.153.10:2181\"</span> <span class=\"hljs-attr\">group</span>=<span class=\"hljs-string\">\"intl\"</span> /&gt;</span>\n</code></pre>\n<h2>Zookeeper Installation</h2>\n<p>Pls. refer to <a href=\"http://dubbo.apache.org/books/dubbo-admin-book/install/zookeeper.html\">zookeeper install manual</a> for how to install zookeeper based registry server. To set it up, specify <code>dubbo.registry.address</code> to <code>zookeeper://127.0.0.1:2181</code> in <code>conf/dubbo.properties</code> for both provider and consumer (you can refer to <a href=\"../../preface/usage.md\">quick start</a>) after install a zookeeper server.</p>\n<h2>Declaration of Reliability</h2>\n<p>A home-brewed service registry server is used in Alibaba instead of zookeeper server. Zookeeper based registry center does not have long-run practice within Alibaba, therefore we cannot guarantee its reliability. Zookeeper registry server is provided for dubbo community, and its reliability relies on zookeeper itself largely.</p>\n<h2>Declaration of Compatibility</h2>\n<p>The original designed data structure for zookeeper in <code>2.0.8</code> has the limitation that data type cannot extended, it's redesigned in <code>2.0.9</code>. But at the same time incompatibility is introduced, thereby <code>2.0.9</code> is required for all service providers and service consumers.</p>\n<p>Since <code>2.2.0</code> zkclient is used by default, therefore its dependency is needed.</p>\n<p>Since <code>2.3.0</code> curator is supported as alternative option.</p>\n<hr class=\"footnotes-sep\">\n<section class=\"footnotes\">\n<ol class=\"footnotes-list\">\n<li id=\"fn1\" class=\"footnote-item\"><p>Suggest to use <code>2.3.3</code> or above for zookeeper registry client <a href=\"#fnref1\" class=\"footnote-backref\">↩︎</a></p>\n</li>\n</ol>\n</section>\n"
}