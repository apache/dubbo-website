{
  "filename": "filter.md",
  "__html": "<h1>调用拦截扩展</h1>\n<h2>扩展说明</h2>\n<p>服务提供方和服务消费方调用过程拦截，Dubbo 本身的大多功能均基于此扩展点实现，每次远程方法执行，该拦截都会被执行，请注意对性能的影响。</p>\n<p>约定：</p>\n<ul>\n<li>用户自定义 filter 默认在内置 filter 之后。</li>\n<li>特殊值 <code>default</code>，表示缺省扩展点插入的位置。比如：<code>filter=&quot;xxx,default,yyy&quot;</code>，表示 <code>xxx</code> 在缺省 filter 之前，<code>yyy</code> 在缺省 filter 之后。</li>\n<li>特殊符号 <code>-</code>，表示剔除。比如：<code>filter=&quot;-foo1&quot;</code>，剔除添加缺省扩展点 <code>foo1</code>。比如：<code>filter=&quot;-default&quot;</code>，剔除添加所有缺省扩展点。</li>\n<li>provider 和 service 同时配置的 filter 时，累加所有 filter，而不是覆盖。比如：<code>&lt;dubbo:provider filter=&quot;xxx,yyy&quot;/&gt;</code> 和 <code>&lt;dubbo:service filter=&quot;aaa,bbb&quot; /&gt;</code>，则 <code>xxx</code>,<code>yyy</code>,<code>aaa</code>,<code>bbb</code> 均会生效。如果要覆盖，需配置：<code>&lt;dubbo:service filter=&quot;-xxx,-yyy,aaa,bbb&quot; /&gt;</code></li>\n</ul>\n<h2>扩展接口</h2>\n<p><code>com.alibaba.dubbo.rpc.Filter</code></p>\n<h2>扩展配置</h2>\n<pre><code class=\"language-xml\"><span class=\"hljs-comment\">&lt;!-- 消费方调用过程拦截 --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:reference</span> <span class=\"hljs-attr\">filter</span>=<span class=\"hljs-string\">\"xxx,yyy\"</span> /&gt;</span>\n<span class=\"hljs-comment\">&lt;!-- 消费方调用过程缺省拦截器，将拦截所有reference --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:consumer</span> <span class=\"hljs-attr\">filter</span>=<span class=\"hljs-string\">\"xxx,yyy\"</span>/&gt;</span>\n<span class=\"hljs-comment\">&lt;!-- 提供方调用过程拦截 --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:service</span> <span class=\"hljs-attr\">filter</span>=<span class=\"hljs-string\">\"xxx,yyy\"</span> /&gt;</span>\n<span class=\"hljs-comment\">&lt;!-- 提供方调用过程缺省拦截器，将拦截所有service --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:provider</span> <span class=\"hljs-attr\">filter</span>=<span class=\"hljs-string\">\"xxx,yyy\"</span>/&gt;</span>\n</code></pre>\n<h2>已知扩展</h2>\n<ul>\n<li><code>com.alibaba.dubbo.rpc.filter.EchoFilter</code></li>\n<li><code>com.alibaba.dubbo.rpc.filter.GenericFilter</code></li>\n<li><code>com.alibaba.dubbo.rpc.filter.GenericImplFilter</code></li>\n<li><code>com.alibaba.dubbo.rpc.filter.TokenFilter</code></li>\n<li><code>com.alibaba.dubbo.rpc.filter.AccessLogFilter</code></li>\n<li><code>com.alibaba.dubbo.rpc.filter.CountFilter</code></li>\n<li><code>com.alibaba.dubbo.rpc.filter.ActiveLimitFilter</code></li>\n<li><code>com.alibaba.dubbo.rpc.filter.ClassLoaderFilter</code></li>\n<li><code>com.alibaba.dubbo.rpc.filter.ContextFilter</code></li>\n<li><code>com.alibaba.dubbo.rpc.filter.ConsumerContextFilter</code></li>\n<li><code>com.alibaba.dubbo.rpc.filter.ExceptionFilter</code></li>\n<li><code>com.alibaba.dubbo.rpc.filter.ExecuteLimitFilter</code></li>\n<li><code>com.alibaba.dubbo.rpc.filter.DeprecatedFilter</code></li>\n</ul>\n<h2>扩展示例</h2>\n<p>Maven 项目结构：</p>\n<pre><code>src\n |-main\n    |-java\n        |-com\n            |-xxx\n                |-XxxFilter.java (实现Filter接口)\n    |-resources\n        |-META-INF\n            |-dubbo\n                |-com.alibaba.dubbo.rpc.Filter (纯文本文件，内容为：xxx=com.xxx.XxxFilter)\n</code></pre>\n<p>XxxFilter.java：</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">package</span> com.xxx;\n \n<span class=\"hljs-keyword\">import</span> com.alibaba.dubbo.rpc.Filter;\n<span class=\"hljs-keyword\">import</span> com.alibaba.dubbo.rpc.Invoker;\n<span class=\"hljs-keyword\">import</span> com.alibaba.dubbo.rpc.Invocation;\n<span class=\"hljs-keyword\">import</span> com.alibaba.dubbo.rpc.Result;\n<span class=\"hljs-keyword\">import</span> com.alibaba.dubbo.rpc.RpcException;\n \n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">XxxFilter</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">Filter</span> </span>{\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Result <span class=\"hljs-title\">invoke</span><span class=\"hljs-params\">(Invoker&lt;?&gt; invoker, Invocation invocation)</span> <span class=\"hljs-keyword\">throws</span> RpcException </span>{\n        <span class=\"hljs-comment\">// before filter ...</span>\n        Result result = invoker.invoke(invocation);\n        <span class=\"hljs-comment\">// after filter ...</span>\n        <span class=\"hljs-keyword\">return</span> result;\n    }\n}\n</code></pre>\n<p>META-INF/dubbo/com.alibaba.dubbo.rpc.Filter：</p>\n<pre><code class=\"language-properties\">xxx=com.xxx.XxxFilter\n</code></pre>\n"
}