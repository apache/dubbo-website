{
  "filename": "config-rule.md",
  "__html": "<h1>配置规则</h1>\n<p>查看<a href=\"./config-rule-deprecated.md\">老版本配置规则</a>。</p>\n<p>覆盖规则是Dubbo设计的在无需重启应用的情况下，动态调整RPC调用行为的一种能力。2.7.0版本开始，支持从<strong>服务</strong>和<strong>应用</strong>两个粒度来调整动态配置。</p>\n<h2>概览</h2>\n<p>请在<a href=\"http://47.91.207.147/#/governance/config\">服务治理控制台</a>查看或修改覆盖规则。</p>\n<ul>\n<li>\n<p>应用粒度</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-comment\"># 将应用demo（key:demo）在20880端口上提供（side:provider）的所有服务（scope:application）的权重修改为1000（weight:1000）。</span>\n<span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">configVersion:</span> <span class=\"hljs-string\">v2.7</span>\n<span class=\"hljs-attr\">scope:</span> <span class=\"hljs-string\">application</span>\n<span class=\"hljs-attr\">key:</span> <span class=\"hljs-string\">demo</span>\n<span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-attr\">configs:</span>\n<span class=\"hljs-attr\">- addresses:</span> <span class=\"hljs-string\">[\"0.0.0.0:20880\"]</span>\n<span class=\"hljs-attr\">  side:</span> <span class=\"hljs-string\">provider</span>\n<span class=\"hljs-attr\">  parameters:</span>\n<span class=\"hljs-attr\">    weight:</span> <span class=\"hljs-number\">1000</span>\n<span class=\"hljs-string\">...</span>\n</code></pre>\n</li>\n<li>\n<p>服务粒度</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-comment\"># 所有消费（side:consumer）DemoService服务（key:org.apache.dubbo.samples.governance.api.DemoService）的应用实例（addresses:[0.0.0.0]），超时时间修改为6000ms</span>\n<span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">configVersion:</span> <span class=\"hljs-string\">v2.7</span>\n<span class=\"hljs-attr\">scope:</span> <span class=\"hljs-string\">service</span>\n<span class=\"hljs-attr\">key:</span> <span class=\"hljs-string\">org.apache.dubbo.samples.governance.api.DemoService</span>\n<span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-attr\">configs:</span>\n<span class=\"hljs-attr\">- addresses:</span> <span class=\"hljs-string\">[0.0.0.0]</span>\n<span class=\"hljs-attr\">  side:</span> <span class=\"hljs-string\">consumer</span>\n<span class=\"hljs-attr\">  parameters:</span>\n<span class=\"hljs-attr\">    timeout:</span> <span class=\"hljs-number\">6000</span>\n<span class=\"hljs-string\">...</span>\n\n</code></pre>\n</li>\n</ul>\n<h2>规则详解</h2>\n<h4>配置模板</h4>\n<pre><code class=\"language-yaml\"><span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">configVersion:</span> <span class=\"hljs-string\">v2.7</span>\n<span class=\"hljs-attr\">scope:</span> <span class=\"hljs-string\">application/service</span>\n<span class=\"hljs-attr\">key:</span> <span class=\"hljs-string\">app-name/group+service+version</span>\n<span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-attr\">configs:</span>\n<span class=\"hljs-attr\">- addresses:</span> <span class=\"hljs-string\">[\"0.0.0.0\"]</span>\n<span class=\"hljs-attr\">  providerAddresses:</span> <span class=\"hljs-string\">[\"1.1.1.1:20880\",</span> <span class=\"hljs-string\">\"2.2.2.2:20881\"</span><span class=\"hljs-string\">]</span>\n<span class=\"hljs-attr\">  side:</span> <span class=\"hljs-string\">consumer</span>\n  <span class=\"hljs-string\">applications/services:</span> <span class=\"hljs-string\">[]</span>\n<span class=\"hljs-attr\">  parameters:</span>\n<span class=\"hljs-attr\">    timeout:</span> <span class=\"hljs-number\">1000</span>\n<span class=\"hljs-attr\">    cluster:</span> <span class=\"hljs-string\">failfase</span>\n<span class=\"hljs-attr\">    loadbalance:</span> <span class=\"hljs-string\">random</span>\n<span class=\"hljs-attr\">- addresses:</span> <span class=\"hljs-string\">[\"0.0.0.0:20880\"]</span>\n<span class=\"hljs-attr\">  side:</span> <span class=\"hljs-string\">provider</span>\n  <span class=\"hljs-string\">applications/services:</span> <span class=\"hljs-string\">[]</span>\n<span class=\"hljs-attr\">  parameters:</span>\n<span class=\"hljs-attr\">    threadpool:</span> <span class=\"hljs-string\">fixed</span>\n<span class=\"hljs-attr\">    threads:</span> <span class=\"hljs-number\">200</span>\n<span class=\"hljs-attr\">    iothreads:</span> <span class=\"hljs-number\">4</span>\n<span class=\"hljs-attr\">    dispatcher:</span> <span class=\"hljs-string\">all</span>\n<span class=\"hljs-attr\">    weight:</span> <span class=\"hljs-number\">200</span>\n<span class=\"hljs-string\">...</span>\n</code></pre>\n<p>其中：</p>\n<ul>\n<li><code>configVersion</code>表示dubbo的版本</li>\n<li><code>scope</code>表示配置作用范围，分别是应用（application）或服务（service）粒度。<strong>必填</strong>。</li>\n<li><code>key</code> 指定规则体作用在哪个服务或应用。<strong>必填</strong>。\n<ul>\n<li>scope=service时，key取值为[{group}:]{service}[:{version}]的组合</li>\n</ul>\n</li>\n<li>scope=application时，key取值为application名称</li>\n<li><code>enabled=true</code> 覆盖规则是否生效，可不填，缺省生效。</li>\n<li><code>configs</code> 定义具体的覆盖规则内容，可以指定n（n&gt;=1）个规则体。<strong>必填</strong>。\n<ul>\n<li>side，</li>\n<li>applications</li>\n<li>services</li>\n<li>parameters</li>\n<li>addresses</li>\n<li>providerAddresses</li>\n</ul>\n</li>\n</ul>\n<br/>\n**对于绝大多数配置场景，只需要理清楚以下问题基本就知道配置该怎么写了：**\n<ol>\n<li>\n<p>要修改整个应用的配置还是某个服务的配置。</p>\n<ul>\n<li>应用：<code>scope: application, key: app-name</code>（还可使用<code>services</code>指定某几个服务）。</li>\n<li>服务：<code>scope: service, key:group+service+version</code>。</li>\n</ul>\n</li>\n<li>\n<p>修改是作用到消费者端还是提供者端。</p>\n<ul>\n<li>消费者：<code>side: consumer</code> ，作用到消费端时（你还可以进一步使用<code>providerAddress</code>, <code>applications</code>选定特定的提供者示例或应用）。</li>\n<li>提供者：<code>side: provider</code>。</li>\n</ul>\n</li>\n<li>\n<p>配置是否只对某几个特定实例生效。</p>\n<ul>\n<li>所有实例：<code>addresses: [&quot;0.0.0.0&quot;]</code>或<code>addresses: [&quot;0.0.0.0:*&quot;]</code>具体由side值决定。</li>\n<li>指定实例：<code>addersses[实例地址列表]</code>。</li>\n</ul>\n</li>\n<li>\n<p>要修改的属性是哪个。</p>\n</li>\n</ol>\n<h4>示例</h4>\n<ol>\n<li>\n<p>禁用提供者：(通常用于临时踢除某台提供者机器，相似的，禁止消费者访问请使用路由规则)</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">configVersion:</span> <span class=\"hljs-string\">v2.7</span>\n<span class=\"hljs-attr\">scope:</span> <span class=\"hljs-string\">application</span>\n<span class=\"hljs-attr\">key:</span> <span class=\"hljs-string\">demo-provider</span>\n<span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-attr\">configs:</span>\n<span class=\"hljs-attr\">- addresses:</span> <span class=\"hljs-string\">[\"10.20.153.10:20880\"]</span>\n<span class=\"hljs-attr\">  side:</span> <span class=\"hljs-string\">provider</span>\n<span class=\"hljs-attr\">  parameters:</span>\n<span class=\"hljs-attr\">    disabled:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-string\">...</span>\n</code></pre>\n</li>\n<li>\n<p>调整权重：(通常用于容量评估，缺省权重为 200)</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">configVersion:</span> <span class=\"hljs-string\">v2.7</span>\n<span class=\"hljs-attr\">scope:</span> <span class=\"hljs-string\">application</span>\n<span class=\"hljs-attr\">key:</span> <span class=\"hljs-string\">demo-provider</span>\n<span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-attr\">configs:</span>\n<span class=\"hljs-attr\">- addresses:</span> <span class=\"hljs-string\">[\"10.20.153.10:20880\"]</span>\n<span class=\"hljs-attr\">  side:</span> <span class=\"hljs-string\">provider</span>\n<span class=\"hljs-attr\">  parameters:</span>\n<span class=\"hljs-attr\">    weight:</span> <span class=\"hljs-number\">200</span>\n<span class=\"hljs-string\">...</span>\n</code></pre>\n</li>\n<li>\n<p>调整负载均衡策略：(缺省负载均衡策略为 random)</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">configVersion:</span> <span class=\"hljs-string\">v2.7</span>\n<span class=\"hljs-attr\">scope:</span> <span class=\"hljs-string\">application</span>\n<span class=\"hljs-attr\">key:</span> <span class=\"hljs-string\">demo-consumer</span>\n<span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-attr\">configs:</span>\n<span class=\"hljs-attr\">- side:</span> <span class=\"hljs-string\">consumer</span>\n<span class=\"hljs-attr\">  parameters:</span>\n<span class=\"hljs-attr\">    loadbalance:</span> <span class=\"hljs-string\">random</span>\n<span class=\"hljs-string\">...</span>\n</code></pre>\n</li>\n<li>\n<p>服务降级：(通常用于临时屏蔽某个出错的非关键服务)</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-meta\">---</span>\n<span class=\"hljs-attr\">configVersion:</span> <span class=\"hljs-string\">v2.7</span>\n<span class=\"hljs-attr\">scope:</span> <span class=\"hljs-string\">service</span>\n<span class=\"hljs-attr\">key:</span> <span class=\"hljs-string\">org.apache.dubbo.samples.governance.api.DemoService</span>\n<span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-attr\">configs:</span>\n<span class=\"hljs-attr\">- side:</span> <span class=\"hljs-string\">consumer</span>\n<span class=\"hljs-attr\"> parameters:</span>\n<span class=\"hljs-attr\">   force:</span> <span class=\"hljs-string\">return</span> <span class=\"hljs-literal\">null</span>\n<span class=\"hljs-string\">...</span>\n</code></pre>\n</li>\n</ol>\n",
  "link": "/zh-cn/docs/user/demos/config-rule.html",
  "meta": {}
}