{
  "filename": "rmi.md",
  "__html": "<h1>rmi://</h1>\n<p>RMI 协议采用 JDK 标准的 <code>java.rmi.*</code> 实现，采用阻塞式短连接和 JDK 标准序列化方式。</p>\n<p>注意：如果正在使用 RMI 提供服务给外部访问 <sup class=\"footnote-ref\"><a href=\"#fn1\" id=\"fnref1\">[1]</a></sup>，同时应用里依赖了老的 common-collections 包 <sup class=\"footnote-ref\"><a href=\"#fn2\" id=\"fnref2\">[2]</a></sup> 的情况下，存在反序列化安全风险 <sup class=\"footnote-ref\"><a href=\"#fn3\" id=\"fnref3\">[3]</a></sup>。</p>\n<h2>特性</h2>\n<ul>\n<li>连接个数：多连接</li>\n<li>连接方式：短连接</li>\n<li>传输协议：TCP</li>\n<li>传输方式：同步传输</li>\n<li>序列化：Java 标准二进制序列化</li>\n<li>适用范围：传入传出参数数据包大小混合，消费者与提供者个数差不多，可传文件。</li>\n<li>适用场景：常规远程服务方法调用，与原生RMI服务互操作</li>\n</ul>\n<h2>约束</h2>\n<ul>\n<li>参数及返回值需实现 <code>Serializable</code> 接口</li>\n<li>dubbo 配置中的超时时间对 RMI 无效，需使用 java 启动参数设置：<code>-Dsun.rmi.transport.tcp.responseTimeout=3000</code>，参见下面的 RMI 配置</li>\n</ul>\n<h2>dubbo.properties 配置</h2>\n<pre><code class=\"language-properties\">dubbo.service.protocol=rmi\n</code></pre>\n<h2>RMI配置</h2>\n<pre><code class=\"language-sh\">java -Dsun.rmi.transport.tcp.responseTimeout=3000\n</code></pre>\n<p>更多 RMI 优化参数请查看 <a href=\"http://download.oracle.com/docs/cd/E17409_01/javase/6/docs/technotes/guides/rmi/sunrmiproperties.html\">JDK 文档</a></p>\n<h2>接口</h2>\n<p>如果服务接口继承了 <code>java.rmi.Remote</code> 接口，可以和原生 RMI 互操作，即：</p>\n<ul>\n<li>提供者用 Dubbo 的 RMI 协议暴露服务，消费者直接用标准 RMI 接口调用，</li>\n<li>或者提供方用标准 RMI 暴露服务，消费方用 Dubbo 的 RMI 协议调用。</li>\n</ul>\n<p>如果服务接口没有继承 <code>java.rmi.Remote</code> 接口：</p>\n<ul>\n<li>缺省 Dubbo 将自动生成一个 <code>com.xxx.XxxService$Remote</code> 的接口，并继承 <code>java.rmi.Remote</code> 接口，并以此接口暴露服务，</li>\n<li>但如果设置了 <code>&lt;dubbo:protocol name=&quot;rmi&quot; codec=&quot;spring&quot; /&gt;</code>，将不生成 <code>$Remote</code> 接口，而使用 Spring 的 <code>RmiInvocationHandler</code> 接口暴露服务，和 Spring 兼容。</li>\n</ul>\n<h2>配置</h2>\n<p>定义 RMI 协议：</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:protocol</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"rmi\"</span> <span class=\"hljs-attr\">port</span>=<span class=\"hljs-string\">\"1099\"</span> /&gt;</span>\n</code></pre>\n<p>设置默认协议：</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:provider</span> <span class=\"hljs-attr\">protocol</span>=<span class=\"hljs-string\">\"rmi\"</span> /&gt;</span>\n</code></pre>\n<p>设置服务协议：</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:service</span> <span class=\"hljs-attr\">protocol</span>=<span class=\"hljs-string\">\"rmi\"</span> /&gt;</span>\n</code></pre>\n<p>多端口：</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:protocol</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"rmi1\"</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"rmi\"</span> <span class=\"hljs-attr\">port</span>=<span class=\"hljs-string\">\"1099\"</span> /&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:protocol</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"rmi2\"</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"rmi\"</span> <span class=\"hljs-attr\">port</span>=<span class=\"hljs-string\">\"2099\"</span> /&gt;</span>\n \n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:service</span> <span class=\"hljs-attr\">protocol</span>=<span class=\"hljs-string\">\"rmi1\"</span> /&gt;</span>\n</code></pre>\n<p>Spring 兼容性：</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:protocol</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"rmi\"</span> <span class=\"hljs-attr\">codec</span>=<span class=\"hljs-string\">\"spring\"</span> /&gt;</span>\n</code></pre>\n<hr class=\"footnotes-sep\">\n<section class=\"footnotes\">\n<ol class=\"footnotes-list\">\n<li id=\"fn1\" class=\"footnote-item\"><p>公司内网环境应该不会有攻击风险 <a href=\"#fnref1\" class=\"footnote-backref\">↩︎</a></p>\n</li>\n<li id=\"fn2\" class=\"footnote-item\"><p>dubbo 不会依赖这个包，请排查自己的应用有没有使用 <a href=\"#fnref2\" class=\"footnote-backref\">↩︎</a></p>\n</li>\n<li id=\"fn3\" class=\"footnote-item\"><p>请检查应用：将 commons-collections3 请升级到 <a href=\"https://commons.apache.org/proper/commons-collections/release_3_2_2.html\">3.2.2</a>；将 commons-collections4 请升级到 <a href=\"https://commons.apache.org/proper/commons-collections/release_4_1.html\">4.1</a>。新版本的 commons-collections 解决了该问题 <a href=\"#fnref3\" class=\"footnote-backref\">↩︎</a></p>\n</li>\n</ol>\n</section>\n"
}