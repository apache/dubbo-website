<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>序列化 on Apache Dubbo</title><link>https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/serialization/</link><description>Recent content in 序列化 on Apache Dubbo</description><generator>Hugo</generator><language>zh-cn</language><atom:link href="https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/serialization/index.xml" rel="self" type="application/rss+xml"/><item><title>Dubbo 序列化机制介绍</title><link>https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/serialization/serialization/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/serialization/serialization/</guid><description>&lt;h2 id="支持的协议列表"&gt;支持的协议列表&lt;/h2&gt;
&lt;p&gt;以下是 Dubbo 框架支持的序列化协议列表，根据 &lt;code&gt;triple&lt;/code&gt;、&lt;code&gt;dubbo&lt;/code&gt; RPC 通信协议进行分类。&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;&lt;span style="display:inline-block;width:100px"&gt;RPC协议&lt;/span&gt;&lt;/th&gt;
 &lt;th&gt;&lt;span style="display:inline-block;width:100px"&gt;编程模式&lt;/span&gt;&lt;/th&gt;
 &lt;th&gt;&lt;span style="display:inline-block;width:100px"&gt;序列化协议&lt;/span&gt;&lt;/th&gt;
 &lt;th&gt;&lt;span style="display:inline-block;width:200px"&gt;配置方式&lt;/span&gt;&lt;/th&gt;
 &lt;th&gt;JDK版本&lt;/th&gt;
 &lt;th&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;strong&gt;triple&lt;/strong&gt;&lt;/td&gt;
 &lt;td&gt;IDL&lt;/td&gt;
 &lt;td&gt;protobuf、&lt;br/&gt;protobuf-json&lt;/td&gt;
 &lt;td&gt;默认值&lt;/td&gt;
 &lt;td&gt;8, 17, 21&lt;/td&gt;
 &lt;td&gt;使用 IDL 时的默认序列化方式，client 也可以选择 protobuf-json 序列化通信，无需额外配置&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;/td&gt;
 &lt;td&gt;Java接口&lt;/td&gt;
 &lt;td&gt;protobuf-wrapper&lt;/td&gt;
 &lt;td&gt;serialization=&amp;ldquo;hessian&amp;rdquo;&lt;/td&gt;
 &lt;td&gt;8, 17, 21&lt;/td&gt;
 &lt;td&gt;这种模式下采用的是两次序列化模式，即数据先被 hessian 序列化，再由 protobuf 序列化。&lt;br/&gt;&lt;br/&gt;为了支持与 IDL 同等的调用模型，易用性较好但性能略有下降&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;strong&gt;dubbo&lt;/strong&gt;&lt;/td&gt;
 &lt;td&gt;Java接口&lt;/td&gt;
 &lt;td&gt;hessian&lt;/td&gt;
 &lt;td&gt;默认值，serialization=&amp;ldquo;hessian&amp;rdquo;&lt;/td&gt;
 &lt;td&gt;8, 17, 21&lt;/td&gt;
 &lt;td&gt;dubbo 协议默认序列化方式，具备兼容性好、高性能、跨语言的优势(java、go、c/c++、php、python、.net)&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;/td&gt;
 &lt;td&gt;Java接口&lt;/td&gt;
 &lt;td&gt;protostuff&lt;/td&gt;
 &lt;td&gt;serialization=&amp;ldquo;protostuff&amp;rdquo;&lt;/td&gt;
 &lt;td&gt;8&lt;/td&gt;
 &lt;td&gt;A java serialization library with built-in support for forward-backward compatibility (schema evolution) and validation.&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;/td&gt;
 &lt;td&gt;Java接口&lt;/td&gt;
 &lt;td&gt;gson&lt;/td&gt;
 &lt;td&gt;serialization=&amp;ldquo;gson&amp;rdquo;&lt;/td&gt;
 &lt;td&gt;8, 17, 21&lt;/td&gt;
 &lt;td&gt;谷歌推出的一款 json 序列化库&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;/td&gt;
 &lt;td&gt;Java接口&lt;/td&gt;
 &lt;td&gt;avro&lt;/td&gt;
 &lt;td&gt;serialization=&amp;ldquo;avro&amp;rdquo;&lt;/td&gt;
 &lt;td&gt;8, 17, 21&lt;/td&gt;
 &lt;td&gt;一款 Java 高性能序列化库&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;/td&gt;
 &lt;td&gt;Java接口&lt;/td&gt;
 &lt;td&gt;msgpack&lt;/td&gt;
 &lt;td&gt;serialization=&amp;ldquo;msgpack&amp;rdquo;&lt;/td&gt;
 &lt;td&gt;8, 17, 21&lt;/td&gt;
 &lt;td&gt;具备兼容性好，提供多语言（Java、C/C++、Python等）实现等优势&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;/td&gt;
 &lt;td&gt;Java接口&lt;/td&gt;
 &lt;td&gt;kryo&lt;/td&gt;
 &lt;td&gt;serialization=&amp;ldquo;kryo&amp;rdquo;&lt;/td&gt;
 &lt;td&gt;8, 17, 21&lt;/td&gt;
 &lt;td&gt;Kryo是一种非常成熟的序列化实现，已经在Twitter、Groupon、Yahoo以及多个著名开源项目（如Hive、Storm）中广泛的使用。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;/td&gt;
 &lt;td&gt;Java接口&lt;/td&gt;
 &lt;td&gt;fastjson2&lt;/td&gt;
 &lt;td&gt;serialization=&amp;ldquo;fastjson2&amp;rdquo;&lt;/td&gt;
 &lt;td&gt;8, 17, 21&lt;/td&gt;
 &lt;td&gt;fastjson&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;/td&gt;
 &lt;td&gt;Java接口&lt;/td&gt;
 &lt;td&gt;更多扩展&lt;/td&gt;
 &lt;td&gt;&lt;/td&gt;
 &lt;td&gt;&lt;/td&gt;
 &lt;td&gt;&lt;a href="https://github.com/apache/dubbo-spi-extensions/tree/master/dubbo-serialization-extensions"&gt;dubbo-spi-extensions&lt;/a&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id="性能对比报告"&gt;性能对比报告&lt;/h2&gt;
&lt;p&gt;序列化对于远程调用的响应速度、吞吐量、网络带宽消耗等起着至关重要的作用，是我们提升分布式系统性能的最关键因素之一。&lt;/p&gt;</description></item><item><title>序列化协议升级</title><link>https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/serialization/serialization-upgrade/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/serialization/serialization-upgrade/</guid><description>&lt;p&gt;在 &lt;code&gt;3.1.0&lt;/code&gt; 版本中，Dubbo 默认支持的序列化协议新增对 Fastjson2 的支持。部分用户可能会考虑在现有的系统中对序列化协议进行升级，但服务端和客户端版本的差异可能导致客户端并不支持服务端的序列化协议。&lt;/p&gt;
&lt;p&gt;在 &lt;code&gt;3.2.0&lt;/code&gt; 版本中, Dubbo 的服务端引入新的配置 &lt;code&gt;prefer-serialization&lt;/code&gt;，该特性可以完美解决服务端序列化升级过程中可能带来的风险。&lt;/p&gt;
&lt;h3 id="最佳实践"&gt;最佳实践&lt;/h3&gt;
&lt;p&gt;序列化协议升级，需要分两步走：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;首先需要推动服务端的序列化协议升级，同时在服务端的暴露配置中需要添加 &lt;code&gt;prefer-serialization&lt;/code&gt; 配置。&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;比如：升级前的序列化协议是 hessian2，升级之后的序列化协议是 Fastjson2 那么在服务端的暴露配置中就应该添加如下所示的配置。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;dubbo.provider.prefer-serialization=fastjson2,hessian2
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;dubbo.provider.serialization=hessian2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;其次，客户端需要升级至和服务端相同版本&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="实现原理"&gt;实现原理&lt;/h3&gt;
&lt;p&gt;dubbo 客户端序列化协议是根据服务端的注册配置来选择的（即服务端的&lt;code&gt;serialization&lt;/code&gt;配置）。在请求阶段 dubbo 会把客户端的序列化协议组装到请求头上，服务端在进行反序列化时会根据请求头来确定反序列化协议。所以，如果服务端和客户端的版本不一致就可能会出现客户端序列化不了的情况。&lt;/p&gt;
&lt;p&gt;为了解决这个情况，&lt;code&gt;3.2.0&lt;/code&gt; 在客户端序列化的时候会优先使用 &lt;code&gt;prefer-serialization&lt;/code&gt; 配置的协议，如果不支持 &lt;code&gt;prefer-serialization&lt;/code&gt; 相关的协议，才会使用 &lt;code&gt;serialization&lt;/code&gt; 配置的协议。（可以把 &lt;code&gt;serialization&lt;/code&gt; 理解为一个兜底的配置）&lt;/p&gt;</description></item></channel></rss>