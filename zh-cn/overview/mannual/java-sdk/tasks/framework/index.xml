<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Apache Dubbo â€“ Dubbo ä½œä¸ºè½»é‡ RPC æ¡†æ¶è§£å†³ç»„ä»¶é€šä¿¡é—®é¢˜</title><link>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/</link><description>Recent content in Dubbo ä½œä¸ºè½»é‡ RPC æ¡†æ¶è§£å†³ç»„ä»¶é€šä¿¡é—®é¢˜ on Apache Dubbo</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><atom:link href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/index.xml" rel="self" type="application/rss+xml"/><item><title>Overview: ä½¿ç”¨è½»é‡çš„ Java SDK å¼€å‘ RPC Server å’Œ Client</title><link>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/lightweight-rpc/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/lightweight-rpc/</guid><description>
&lt;p>æœ¬ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨è½»é‡ Dubbo SDK å¼€å‘ RPC Server ä¸ Clientï¼Œç¤ºä¾‹ä½¿ç”¨ Java Interface æ–¹å¼å®šä¹‰ã€å‘å¸ƒå’Œè®¿é—® RPC æœåŠ¡ï¼Œåº•å±‚ä½¿ç”¨ Triple åè®®é€šä¿¡ã€‚æœ¬ç¤ºä¾‹å®Œæ•´ä»£ç è¯·å‚è§ &lt;a href="https://github.com/apache/dubbo-samples/tree/master/1-basic/dubbo-samples-api" target="_blank">dubbo-samples&lt;/a>ã€‚&lt;/p>
&lt;p>åŸºäº Dubbo å®šä¹‰çš„ Triple åè®®ï¼Œä½ å¯ä»¥è½»æ¾ç¼–å†™æµè§ˆå™¨ã€gRPC å…¼å®¹çš„ RPC æœåŠ¡ï¼Œå¹¶è®©è¿™äº›æœåŠ¡åŒæ—¶è¿è¡Œåœ¨ HTTP/1 å’Œ HTTP/2 ä¸Šã€‚Dubbo Java SDK æ”¯æŒä½¿ç”¨ IDL æˆ–ç¼–ç¨‹è¯­è¨€ç‰¹æœ‰çš„æ–¹å¼å®šä¹‰æœåŠ¡ï¼Œå¹¶æä¾›ä¸€å¥—è½»é‡çš„ API æ¥å‘å¸ƒæˆ–è°ƒç”¨è¿™äº›æœåŠ¡ã€‚&lt;/p>
&lt;h2 id="maven-ä¾èµ–">Maven ä¾èµ–&lt;/h2>
&lt;p>åœ¨åŸºäº Dubbo RPC ç¼–ç ä¹‹å‰ï¼Œæ‚¨åªéœ€è¦åœ¨é¡¹ç›®æ·»åŠ ä¸€ä¸ªéå¸¸è½»é‡çš„ &lt;code>dubbo&lt;/code>ä¾èµ–åŒ…å³å¯ï¼Œä»¥ Maven ä¸ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;groupId&amp;gt;&lt;/span>org.apache.dubbo&lt;span style="color:#268bd2">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;artifactId&amp;gt;&lt;/span>dubbo&lt;span style="color:#268bd2">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;version&amp;gt;&lt;/span>3.3.0-beta.1&lt;span style="color:#268bd2">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">&amp;lt;!-- ä¸ºäº†é¿å… Netty ä¾èµ–å†²çªï¼Œæ‚¨ä¹Ÿå¯ä»¥æ˜¯é€‰æ‹©ä½¿ç”¨ dubbo-shaded ç‰ˆæœ¬ï¼--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">&amp;lt;!--
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">&amp;lt;dependency&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> &amp;lt;groupId&amp;gt;org.apache.dubbo&amp;lt;/groupId&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> &amp;lt;artifactId&amp;gt;dubbo-shaded&amp;lt;/artifactId&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> &amp;lt;version&amp;gt;3.3.0-beta.1&amp;lt;/version&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">&amp;lt;/dependency&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å®šä¹‰æœåŠ¡">å®šä¹‰æœåŠ¡&lt;/h2>
&lt;p>å®šä¹‰ä¸€ä¸ªåä¸º &lt;code>DemoService&lt;/code>çš„æ ‡å‡† Java æ¥å£ä½œä¸º Dubbo æœåŠ¡ï¼ˆDubbo è¿˜æ”¯æŒ&lt;a href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/quick-start/idl/">åŸºäº IDL çš„æœåŠ¡å®šä¹‰æ¨¡å¼&lt;/a>ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">DemoService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®ç° &lt;code>DemoService&lt;/code> æ¥å£å¹¶ç¼–å†™ä¸šåŠ¡é€»è¾‘ä»£ç ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">DemoServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> DemoService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#2aa198">&amp;#34;Hello &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name &lt;span style="color:#719e07">+&lt;/span> &lt;span style="color:#2aa198">&amp;#34;, response from provider.&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ³¨å†ŒæœåŠ¡å¹¶å¯åŠ¨-server">æ³¨å†ŒæœåŠ¡å¹¶å¯åŠ¨ Server&lt;/h2>
&lt;p>å¯åŠ¨ server å¹¶åœ¨æŒ‡å®šç«¯å£ç›‘å¬ RPC è¯·æ±‚ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å‘ server æ³¨å†Œäº†ä»¥ä¸‹ä¿¡æ¯ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>Triple&lt;/code> ä½œä¸ºé€šä¿¡ RPC åè®®ä¸å¹¶ç›‘å¬ç«¯å£ &lt;code>50051&lt;/code>&lt;/li>
&lt;li>æ³¨å†Œ Dubbo æœåŠ¡åˆ° &lt;code>DemoService&lt;/code> server&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">Application&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">static&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">main&lt;/span>(String&lt;span style="color:#719e07">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DubboBootstrap.getInstance()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .protocol(&lt;span style="color:#719e07">new&lt;/span> ProtocolConfig(CommonConstants.TRIPLE, 50051))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .service(ServiceBuilder.newBuilder().ref(&lt;span style="color:#719e07">new&lt;/span> DemoServiceImpl()).build())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .start()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .await();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="è®¿é—®æœåŠ¡">è®¿é—®æœåŠ¡&lt;/h2>
&lt;p>æœ€ç®€å•æ–¹å¼æ˜¯ä½¿ç”¨ HTTP/1.1 POST è¯·æ±‚è®¿é—®æœåŠ¡ï¼Œå‚æ•°åˆ™ä»¥æ ‡å‡† JSON æ ¼å¼ä½œä¸º HTTP è´Ÿè½½ä¼ é€’ã€‚å¦‚ä¸‹æ˜¯ä½¿ç”¨ cURL å‘½ä»¤çš„è®¿é—®ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>curl &lt;span style="color:#cb4b16">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#cb4b16">&lt;/span> --header &lt;span style="color:#2aa198">&amp;#34;Content-Type: application/json&amp;#34;&lt;/span> &lt;span style="color:#cb4b16">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#cb4b16">&lt;/span> --data &lt;span style="color:#2aa198">&amp;#39;[&amp;#34;Dubbo&amp;#34;]&amp;#39;&lt;/span> &lt;span style="color:#cb4b16">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#cb4b16">&lt;/span> http://localhost:50051/org.apache.dubbo.demo.DemoService/sayHello
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>å‚æ•°å¿…é¡»ä»¥æ•°ç»„æ ¼å¼è¿›è¡Œä¼ é€’ï¼Œå¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼Œåˆ™æ ¼å¼ç±»ä¼¼ &lt;code>[&amp;quot;param1&amp;quot;, {&amp;quot;param2-field&amp;quot;: &amp;quot;param2-value&amp;quot;}, ...]&lt;/code>ï¼Œå…·ä½“è¯·å‚è§ triple åè®®è§„èŒƒã€‚&lt;/p>
&lt;/blockquote>
&lt;p>æ¥ä¸‹æ¥ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ Dubbo client è¯·æ±‚æœåŠ¡ï¼ŒæŒ‡å®š server åœ°å€å³å¯å‘èµ· RPC è°ƒç”¨ï¼Œå…¶æ ¼å¼ä¸º &lt;code>protocol://ip:host&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">Application&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">static&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">main&lt;/span>(String&lt;span style="color:#719e07">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DemoService demoService &lt;span style="color:#719e07">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ReferenceBuilder.newBuilder()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .interfaceClass(DemoService.class)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .url(&lt;span style="color:#2aa198">&amp;#34;tri://localhost:50051&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .build()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .get();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String message &lt;span style="color:#719e07">=&lt;/span> demoService.sayHello(&lt;span style="color:#2aa198">&amp;#34;dubbo&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(message);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­å–œæ‚¨ï¼Œ ä»¥ä¸Šå³æ˜¯ Dubbo Java RPC é€šä¿¡çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼ ğŸ‰&lt;/p>
&lt;h2 id="æ›´å¤šå†…å®¹">æ›´å¤šå†…å®¹&lt;/h2>
&lt;ul>
&lt;li>Triple åè®®å®Œå…¨å…¼å®¹ gRPCï¼Œæ‚¨å¯ä»¥å‚è€ƒè¿™é‡Œäº†è§£å¦‚ä½• &lt;a href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/quick-start/idl/">ä½¿ç”¨ IDL ç¼–å†™ gRPC å…¼å®¹çš„æœåŠ¡&lt;/a>ï¼Œæˆ–è€… &lt;a href="">ä½¿ç”¨å…¶ä»–é€šä¿¡åè®®&lt;/a>&lt;/li>
&lt;li>ä½œä¸º RPC æ¡†æ¶ï¼ŒDubbo æ”¯æŒå¼‚æ­¥è°ƒç”¨ã€è¿æ¥ç®¡ç†ã€contextä¸Šä¸‹æ–‡ç­‰ï¼Œè¯·å‚è€ƒ &lt;a href="">RPC æ¡†æ¶æ ¸å¿ƒåŠŸèƒ½&lt;/a>&lt;/li>
&lt;li>æ‚¨å¯ä»¥ç»§ç»­ &lt;a href="">ä½¿ç”¨ API ä¸ºåº”ç”¨æ·»åŠ æ›´å¤šå¾®æœåŠ¡æ²»ç†èƒ½åŠ›&lt;/a>ï¼Œä½†æˆ‘ä»¬æ›´æ¨è¿›æ‚¨ä½¿ç”¨ &lt;a href="../../microservice/develop/">Dubbo Spring Boot å¼€å‘å¾®æœåŠ¡åº”ç”¨&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Overview: æ¶ˆè´¹ç«¯çº¿ç¨‹æ¨¡å‹ï¼Œæä¾›è€…ç«¯çº¿ç¨‹æ¨¡å‹</title><link>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/threading-model/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/threading-model/</guid><description>
&lt;h2 id="åŠŸèƒ½è¯´æ˜">åŠŸèƒ½è¯´æ˜&lt;/h2>
&lt;p>2.7.5 ç‰ˆæœ¬å¯¹æ•´ä¸ªè°ƒç”¨é“¾è·¯åšäº†å…¨é¢çš„ä¼˜åŒ–ï¼Œæ ¹æ®å‹æµ‹ç»“æœæ˜¾ç¤ºï¼Œæ€»ä½“ QPS æ€§èƒ½æå‡å°†è¿‘ 30%ï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†è°ƒç”¨è¿‡ç¨‹ä¸­çš„å†…å­˜åˆ†é…å¼€é”€ã€‚å…¶ä¸­ä¸€ä¸ªå€¼å¾—æåŠçš„è®¾è®¡ç‚¹æ˜¯ 2.7.5 å¼•å…¥äº† Servicerepository çš„æ¦‚å¿µï¼Œåœ¨æœåŠ¡æ³¨å†Œé˜¶æ®µæå‰ç”Ÿæˆ ServiceDescriptor å’Œ MethodDescriptorï¼Œä»¥å‡å°‘ RPC è°ƒç”¨é˜¶æ®µè®¡ç®— Service åŸä¿¡æ¯å¸¦æ¥çš„èµ„æºæ¶ˆè€—ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>å¹¶å‘è¯·æ±‚ï¼Œè´Ÿè½½å‡è¡¡ï¼Œè¿æ¥ç®¡ç†ï¼Œè¶…æ—¶å¤„ç†ï¼Œå®¹é”™ç­‰ã€‚&lt;/p>
&lt;h2 id="å®ç°æ–¹å¼">å®ç°æ–¹å¼&lt;/h2>
&lt;h3 id="æ¶ˆè´¹ç«¯çº¿ç¨‹æ± æ¨¡å‹ä¼˜åŒ–">æ¶ˆè´¹ç«¯çº¿ç¨‹æ± æ¨¡å‹ä¼˜åŒ–&lt;/h3>
&lt;p>å¯¹ 2.7.5 ç‰ˆæœ¬ä¹‹å‰çš„ Dubbo åº”ç”¨ï¼Œå°¤å…¶æ˜¯ä¸€äº›æ¶ˆè´¹ç«¯åº”ç”¨ï¼Œå½“é¢ä¸´éœ€è¦æ¶ˆè´¹å¤§é‡æœåŠ¡ä¸”å¹¶å‘æ•°æ¯”è¾ƒå¤§çš„å¤§æµé‡åœºæ™¯æ—¶ï¼ˆå…¸å‹å¦‚ç½‘å…³ç±»åœºæ™¯ï¼‰ï¼Œç»å¸¸ä¼šå‡ºç°æ¶ˆè´¹ç«¯çº¿ç¨‹æ•°åˆ†é…è¿‡å¤šçš„é—®é¢˜ï¼Œå…·ä½“é—®é¢˜è®¨è®ºå¯å‚è§ &lt;a href="https://github.com/apache/dubbo/issues/2013">Need a limited Threadpool in consumer side #2013&lt;/a>&lt;/p>
&lt;p>æ”¹è¿›åçš„æ¶ˆè´¹ç«¯çº¿ç¨‹æ± æ¨¡å‹ï¼Œé€šè¿‡å¤ç”¨ä¸šåŠ¡ç«¯è¢«é˜»å¡çš„çº¿ç¨‹ï¼Œå¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚&lt;/p>
&lt;h3 id="è€çš„çº¿ç¨‹æ± æ¨¡å‹">è€çš„çº¿ç¨‹æ± æ¨¡å‹&lt;/h3>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/user/consumer-threadpool0.png" alt="æ¶ˆè´¹ç«¯çº¿ç¨‹æ± .png">&lt;/p>
&lt;p>æˆ‘ä»¬é‡ç‚¹å…³æ³¨ Consumer éƒ¨åˆ†ï¼š&lt;/p>
&lt;ol>
&lt;li>ä¸šåŠ¡çº¿ç¨‹å‘å‡ºè¯·æ±‚ï¼Œæ‹¿åˆ°ä¸€ä¸ª Future å®ä¾‹ã€‚&lt;/li>
&lt;li>ä¸šåŠ¡çº¿ç¨‹ç´§æ¥ç€è°ƒç”¨ future.get é˜»å¡ç­‰å¾…ä¸šåŠ¡ç»“æœè¿”å›ã€‚&lt;/li>
&lt;li>å½“ä¸šåŠ¡æ•°æ®è¿”å›åï¼Œäº¤ç”±ç‹¬ç«‹çš„ Consumer ç«¯çº¿ç¨‹æ± è¿›è¡Œååºåˆ—åŒ–ç­‰å¤„ç†ï¼Œå¹¶è°ƒç”¨ future.set å°†ååºåˆ—åŒ–åçš„ä¸šåŠ¡ç»“æœç½®å›ã€‚&lt;/li>
&lt;li>ä¸šåŠ¡çº¿ç¨‹æ‹¿åˆ°ç»“æœç›´æ¥è¿”å›&lt;/li>
&lt;/ol>
&lt;h3 id="275-ç‰ˆæœ¬å¼•å…¥çš„çº¿ç¨‹æ± æ¨¡å‹">2.7.5 ç‰ˆæœ¬å¼•å…¥çš„çº¿ç¨‹æ± æ¨¡å‹&lt;/h3>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/user/consumer-threadpool1.png" alt="æ¶ˆè´¹ç«¯çº¿ç¨‹æ± æ–°.png">&lt;/p>
&lt;ol>
&lt;li>ä¸šåŠ¡çº¿ç¨‹å‘å‡ºè¯·æ±‚ï¼Œæ‹¿åˆ°ä¸€ä¸ª Future å®ä¾‹ã€‚&lt;/li>
&lt;li>åœ¨è°ƒç”¨ future.get() ä¹‹å‰ï¼Œå…ˆè°ƒç”¨ ThreadlessExecutor.wait()ï¼Œwait ä¼šä½¿ä¸šåŠ¡çº¿ç¨‹åœ¨ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ä¸Šç­‰å¾…ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­è¢«åŠ å…¥å…ƒç´ ã€‚&lt;/li>
&lt;li>å½“ä¸šåŠ¡æ•°æ®è¿”å›åï¼Œç”Ÿæˆä¸€ä¸ª Runnable Task å¹¶æ”¾å…¥ ThreadlessExecutor é˜Ÿåˆ—&lt;/li>
&lt;li>ä¸šåŠ¡çº¿ç¨‹å°† Task å–å‡ºå¹¶åœ¨æœ¬çº¿ç¨‹ä¸­æ‰§è¡Œï¼šååºåˆ—åŒ–ä¸šåŠ¡æ•°æ®å¹¶ set åˆ° Futureã€‚&lt;/li>
&lt;li>ä¸šåŠ¡çº¿ç¨‹æ‹¿åˆ°ç»“æœç›´æ¥è¿”å›&lt;/li>
&lt;/ol>
&lt;p>è¿™æ ·ï¼Œç›¸æ¯”äºè€çš„çº¿ç¨‹æ± æ¨¡å‹ï¼Œç”±ä¸šåŠ¡çº¿ç¨‹è‡ªå·±è´Ÿè´£ç›‘æµ‹å¹¶è§£æè¿”å›ç»“æœï¼Œå…å»äº†é¢å¤–çš„æ¶ˆè´¹ç«¯çº¿ç¨‹æ± å¼€é”€ã€‚&lt;/p>
&lt;p>å…³äºæ€§èƒ½ä¼˜åŒ–ï¼Œåœ¨æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­å°†ä¼šæŒç»­æ¨è¿›ï¼Œä¸»è¦ä»ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢å…¥æ‰‹ï¼š&lt;/p>
&lt;ol>
&lt;li>RPC è°ƒç”¨é“¾è·¯ã€‚ç›®å‰èƒ½çœ‹åˆ°çš„ç‚¹åŒ…æ‹¬ï¼šè¿›ä¸€æ­¥å‡å°‘æ‰§è¡Œé“¾è·¯çš„å†…å­˜åˆ†é…ã€åœ¨ä¿è¯åè®®å…¼å®¹æ€§çš„å‰æä¸‹æé«˜åè®®ä¼ è¾“æ•ˆç‡ã€æé«˜ Filterã€Router ç­‰è®¡ç®—æ•ˆç‡ã€‚&lt;/li>
&lt;li>æœåŠ¡æ²»ç†é“¾è·¯ã€‚è¿›ä¸€æ­¥å‡å°‘åœ°å€æ¨é€ã€æœåŠ¡æ²»ç†è§„åˆ™æ¨é€ç­‰é€ æˆçš„å†…å­˜ã€cpu èµ„æºæ¶ˆè€—ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="provider-æ¨¡å‹åŠŸèƒ½è¯´æ˜">Provider æ¨¡å‹åŠŸèƒ½è¯´æ˜&lt;/h2>
&lt;p>Dubboåè®®çš„å’ŒTripleåè®®ç›®å‰çš„çº¿ç¨‹æ¨¡å‹è¿˜å¹¶æ²¡æœ‰å¯¹é½ï¼Œä¸‹é¢åˆ†å¼€ä»‹ç»Tripleåè®®å’ŒDubboåè®®çš„çº¿ç¨‹æ¨¡å‹ã€‚&lt;/p>
&lt;h3 id="dubboåè®®providerç«¯çº¿ç¨‹æ¨¡å‹">Dubboåè®®â€”Providerç«¯çº¿ç¨‹æ¨¡å‹&lt;/h3>
&lt;p>ä»‹ç»Dubboåè®®çš„Providerç«¯çº¿ç¨‹æ¨¡å‹ä¹‹å‰ï¼Œå…ˆä»‹ç»Dubboå¯¹channelä¸Šçš„æ“ä½œæŠ½è±¡æˆäº†äº”ç§è¡Œä¸ºï¼š&lt;/p>
&lt;ul>
&lt;li>å»ºç«‹è¿æ¥ï¼šconnectedï¼Œä¸»è¦æ˜¯çš„èŒè´£æ˜¯åœ¨channelè®°å½•readã€writeçš„æ—¶é—´ï¼Œä»¥åŠå¤„ç†å»ºç«‹è¿æ¥åçš„å›è°ƒé€»è¾‘ï¼Œæ¯”å¦‚dubboæ”¯æŒåœ¨æ–­å¼€åè‡ªå®šä¹‰å›è°ƒçš„hookï¼ˆonconnectï¼‰ï¼Œå³åœ¨è¯¥æ“ä½œä¸­æ‰§è¡Œã€‚&lt;/li>
&lt;li>æ–­å¼€è¿æ¥ï¼šdisconnectedï¼Œä¸»è¦æ˜¯çš„èŒè´£æ˜¯åœ¨channelç§»é™¤readã€writeçš„æ—¶é—´ï¼Œä»¥åŠå¤„ç†ç«¯å¼€è¿æ¥åçš„å›è°ƒé€»è¾‘ï¼Œæ¯”å¦‚dubboæ”¯æŒåœ¨æ–­å¼€åè‡ªå®šä¹‰å›è°ƒçš„hookï¼ˆondisconnectï¼‰ï¼Œå³åœ¨è¯¥æ“ä½œä¸­æ‰§è¡Œã€‚&lt;/li>
&lt;li>å‘é€æ¶ˆæ¯ï¼šsentï¼ŒåŒ…æ‹¬å‘é€è¯·æ±‚å’Œå‘é€å“åº”ã€‚è®°å½•writeçš„æ—¶é—´ã€‚&lt;/li>
&lt;li>æ¥æ”¶æ¶ˆæ¯ï¼šreceivedï¼ŒåŒ…æ‹¬æ¥æ”¶è¯·æ±‚å’Œæ¥æ”¶å“åº”ã€‚è®°å½•readçš„æ—¶é—´ã€‚&lt;/li>
&lt;li>å¼‚å¸¸æ•è·ï¼šcaughtï¼Œç”¨äºå¤„ç†åœ¨channelä¸Šå‘ç”Ÿçš„å„ç±»å¼‚å¸¸ã€‚&lt;/li>
&lt;/ul>
&lt;p>Dubboæ¡†æ¶çš„çº¿ç¨‹æ¨¡å‹ä¸ä»¥ä¸Šè¿™äº”ç§è¡Œä¸ºæ¯æ¯ç›¸å…³ï¼ŒDubboåè®®Providerçº¿ç¨‹æ¨¡å‹å¯ä»¥åˆ†ä¸ºäº”ç±»ï¼Œä¹Ÿå°±æ˜¯AllDispatcherã€DirectDispatcherã€MessageOnlyDispatcherã€ExecutionDispatcherã€ConnectionOrderedDispatcherã€‚&lt;/p>
&lt;h3 id="tripleåè®®providerç«¯çº¿ç¨‹æ¨¡å‹">Tripleåè®®â€”Providerç«¯çº¿ç¨‹æ¨¡å‹&lt;/h3>
&lt;p>ä¸‹å›¾ä¸ºTripleåè®® Providerç«¯çš„çº¿ç¨‹æ¨¡å‹&lt;/p>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/v3/feature/performance/threading-model/triple-provider.png" alt="triple-provider">&lt;/p>
&lt;p>Tripleåè®®Providerçº¿ç¨‹æ¨¡å‹ç›®å‰è¿˜æ¯”è¾ƒç®€å•ï¼Œç›®å‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œéƒ½åœ¨Dubboçº¿ç¨‹ä¸Šå·¥ä½œï¼Œè€ŒIOçº¿ç¨‹å¹¶æ²¡æœ‰æ‰¿è½½è¿™äº›å·¥ä½œã€‚&lt;/p>
&lt;h3 id="all-dispatcher">All Dispatcher&lt;/h3>
&lt;p>ä¸‹å›¾æ˜¯All Dispatcherçš„çº¿ç¨‹æ¨¡å‹è¯´æ˜å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/v3/feature/performance/threading-model/dubbo-provider-alldispatcher.png" alt="dubbo-provider-alldispatcher">&lt;/p>
&lt;ul>
&lt;li>åœ¨IOçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œæœ‰ï¼š
&lt;ol>
&lt;li>sentæ“ä½œåœ¨IOçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚&lt;/li>
&lt;li>åºåˆ—åŒ–å“åº”åœ¨IOçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>åœ¨Dubboçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œæœ‰ï¼š
&lt;ol>
&lt;li>receivedã€connectedã€disconnectedã€caughtéƒ½æ˜¯åœ¨Dubboçº¿ç¨‹ä¸Šæ‰§è¡Œçš„ã€‚&lt;/li>
&lt;li>ååºåˆ—åŒ–è¯·æ±‚çš„è¡Œä¸ºåœ¨Dubboä¸­åšçš„ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;h3 id="direct-dispatcher">Direct Dispatcher&lt;/h3>
&lt;p>ä¸‹å›¾æ˜¯Direct Dispatcherçš„çº¿ç¨‹æ¨¡å‹è¯´æ˜å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/v3/feature/performance/threading-model/dubbo-provider-directDispatcher.png" alt="dubbo-provider-directDispatcher">&lt;/p>
&lt;ul>
&lt;li>åœ¨IOçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œæœ‰ï¼š
&lt;ol>
&lt;li>receivedã€connectedã€disconnectedã€caughtã€sentæ“ä½œåœ¨IOçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚&lt;/li>
&lt;li>ååºåˆ—åŒ–è¯·æ±‚å’Œåºåˆ—åŒ–å“åº”åœ¨IOçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;ol>
&lt;li>å¹¶æ²¡æœ‰åœ¨Dubboçº¿ç¨‹æ“ä½œçš„è¡Œä¸ºã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;h3 id="execution-dispatcher">Execution Dispatcher&lt;/h3>
&lt;p>ä¸‹å›¾æ˜¯Execution Dispatcherçš„çº¿ç¨‹æ¨¡å‹è¯´æ˜å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/v3/feature/performance/threading-model/dubbo-provider-executionDispatcher.png" alt="dubbo-provider-ExecutionDispatcher">&lt;/p>
&lt;ul>
&lt;li>åœ¨IOçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œæœ‰ï¼š
&lt;ol>
&lt;li>sentã€connectedã€disconnectedã€caughtæ“ä½œåœ¨IOçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚&lt;/li>
&lt;li>åºåˆ—åŒ–å“åº”åœ¨IOçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>åœ¨Dubboçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œæœ‰ï¼š
&lt;ol>
&lt;li>receivedéƒ½æ˜¯åœ¨Dubboçº¿ç¨‹ä¸Šæ‰§è¡Œçš„ã€‚&lt;/li>
&lt;li>ååºåˆ—åŒ–è¯·æ±‚çš„è¡Œä¸ºåœ¨Dubboä¸­åšçš„ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;h3 id="message-only-dispatcher">Message Only Dispatcher&lt;/h3>
&lt;p>åœ¨Providerç«¯ï¼ŒMessage Only Dispatcherå’ŒExecution Dispatcherçš„çº¿ç¨‹æ¨¡å‹æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥ä¸‹å›¾å’ŒExecution Dispatcherçš„å›¾ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨Consumerç«¯ã€‚è§ä¸‹æ–¹Consumerç«¯çš„çº¿ç¨‹æ¨¡å‹ã€‚&lt;/p>
&lt;p>ä¸‹å›¾æ˜¯Message Only Dispatcherçš„çº¿ç¨‹æ¨¡å‹è¯´æ˜å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/v3/feature/performance/threading-model/dubbo-provider-executionDispatcher.png" alt="dubbo-provider-ExecutionDispatcher">&lt;/p>
&lt;ul>
&lt;li>åœ¨IOçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œæœ‰ï¼š
&lt;ol>
&lt;li>sentã€connectedã€disconnectedã€caughtæ“ä½œåœ¨IOçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚&lt;/li>
&lt;li>åºåˆ—åŒ–å“åº”åœ¨IOçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>åœ¨Dubboçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œæœ‰ï¼š
&lt;ol>
&lt;li>receivedéƒ½æ˜¯åœ¨Dubboçº¿ç¨‹ä¸Šæ‰§è¡Œçš„ã€‚&lt;/li>
&lt;li>ååºåˆ—åŒ–è¯·æ±‚çš„è¡Œä¸ºåœ¨Dubboä¸­åšçš„ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;h3 id="connection-ordered-dispatcher">Connection Ordered Dispatcher&lt;/h3>
&lt;p>ä¸‹å›¾æ˜¯Connection Ordered Dispatcherçš„çº¿ç¨‹æ¨¡å‹è¯´æ˜å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/v3/feature/performance/threading-model/dubbbo-provider-connectionOrderedDispatcher.png" alt="dubbbo-provider-connectionOrderedDispatcher">&lt;/p>
&lt;ul>
&lt;li>åœ¨IOçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œæœ‰ï¼š
&lt;ol>
&lt;li>sentæ“ä½œåœ¨IOçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚&lt;/li>
&lt;li>åºåˆ—åŒ–å“åº”åœ¨IOçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>åœ¨Dubboçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œæœ‰ï¼š
&lt;ol>
&lt;li>receivedã€connectedã€disconnectedã€caughtéƒ½æ˜¯åœ¨Dubboçº¿ç¨‹ä¸Šæ‰§è¡Œçš„ã€‚ä½†æ˜¯connectedå’Œdisconnectedä¸¤ä¸ªè¡Œä¸ºæ˜¯ä¸å…¶ä»–ä¸¤ä¸ªè¡Œä¸ºé€šè¿‡çº¿ç¨‹æ± éš”ç¦»å¼€çš„ã€‚å¹¶ä¸”åœ¨Dubbo connected thread poolä¸­æä¾›äº†é“¾æ¥é™åˆ¶ã€å‘Šè­¦ç¯èƒ½åŠ›ã€‚&lt;/li>
&lt;li>ååºåˆ—åŒ–è¯·æ±‚çš„è¡Œä¸ºåœ¨Dubboä¸­åšçš„ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;h2 id="ä½¿ç”¨åœºæ™¯-1">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>å¼‚æ­¥å¤„ç†ï¼Œè¿æ¥ç®¡ç†ï¼Œèµ„æºç®¡ç†ï¼Œè´Ÿè½½å‡è¡¡ï¼Œå®¹é”™ç­‰ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>çº¿ç¨‹æ¨¡å‹&lt;/th>
&lt;th>é…ç½®&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>All Dispatcher&lt;/td>
&lt;td>all&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Direct Dispatcher&lt;/td>
&lt;td>direct&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Execution Dispatcher&lt;/td>
&lt;td>execution&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Message Only Dispatcher&lt;/td>
&lt;td>message&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Connection Ordered Dispatcher&lt;/td>
&lt;td>connection&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="çº¿ç¨‹æ¨¡å‹ç¤ºä¾‹">çº¿ç¨‹æ¨¡å‹ç¤ºä¾‹&lt;/h3>
&lt;p>æ‹¿yamlçš„é…ç½®æ–¹å¼ä¸¾ä¾‹ï¼šåœ¨protocolä¸‹é…ç½®dispatcher: allï¼Œå³å¯æŠŠdubboåè®®çš„çº¿ç¨‹æ¨¡å‹è°ƒæ•´ä¸ºAll Dispatcher&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">dubbo&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">application&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">name&lt;/span>: dubbo-springboot-demo-provider
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">protocol&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">name&lt;/span>: dubbo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">port&lt;/span>: -&lt;span style="color:#2aa198">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">dispatcher&lt;/span>: all
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">registry&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">id&lt;/span>: zk-registry
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">address&lt;/span>: zookeeper://127.0.0.1:2181
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">config-center&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">address&lt;/span>: zookeeper://127.0.0.1:2181
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">metadata-report&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">address&lt;/span>: zookeeper://127.0.0.1:2181
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç‰¹æ€§è¯´æ˜">ç‰¹æ€§è¯´æ˜&lt;/h2>
&lt;p>ä¸€ç§æ–°çš„çº¿ç¨‹æ± ç®¡ç†æ–¹å¼ï¼Œä½¿å¾—æä¾›è€…åº”ç”¨å†…å„ä¸ªæœåŠ¡çš„çº¿ç¨‹æ± éš”ç¦»å¼€æ¥ï¼Œäº’ç›¸ç‹¬ç«‹ï¼ŒæŸä¸ªæœåŠ¡çš„çº¿ç¨‹æ± èµ„æºè€—å°½ä¸ä¼šå½±å“å…¶ä»–æ­£å¸¸æœåŠ¡ã€‚æ”¯æŒçº¿ç¨‹æ± å¯é…ç½®åŒ–ï¼Œç”±ç”¨æˆ·æ‰‹åŠ¨æŒ‡å®šã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨åœºæ™¯-2">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>ä½¿ç”¨çº¿ç¨‹æ± éš”ç¦»æ¥ç¡®ä¿ Dubbo ç”¨äºè°ƒç”¨è¿œç¨‹æ–¹æ³•çš„çº¿ç¨‹ä¸å¾®æœåŠ¡ç”¨äºæ‰§è¡Œå…¶ä»»åŠ¡çš„çº¿ç¨‹æ˜¯åˆ†å¼€çš„ã€‚å¯ä»¥é€šè¿‡é˜²æ­¢çº¿ç¨‹é˜»å¡æˆ–ç›¸äº’ç«äº‰æ¥å¸®åŠ©æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨æ–¹å¼-1">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;p>ç›®å‰å¯ä»¥ä»¥ APIã€XMLã€Annotation çš„æ–¹å¼è¿›è¡Œé…ç½®&lt;/p>
&lt;p>&lt;strong>é…ç½®å‚æ•°&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;code>ApplicationConfig&lt;/code> æ–°å¢ &lt;code>String executor-management-mode&lt;/code> å‚æ•°ï¼Œé…ç½®å€¼ä¸º &lt;code>default&lt;/code> å’Œ &lt;code>isolation&lt;/code> ï¼Œé»˜è®¤ä¸º &lt;code>default&lt;/code>ã€‚
&lt;ul>
&lt;li>&lt;code>executor-management-mode = default&lt;/code> ä½¿ç”¨åŸæœ‰ &lt;strong>ä»¥åè®®ç«¯å£ä¸ºç²’åº¦ã€æœåŠ¡é—´å…±äº«&lt;/strong> çš„çº¿ç¨‹æ± ç®¡ç†æ–¹å¼&lt;/li>
&lt;li>&lt;code>executor-management-mode = isolation&lt;/code> ä½¿ç”¨æ–°å¢çš„ &lt;strong>ä»¥æœåŠ¡ä¸‰å…ƒç»„ä¸ºç²’åº¦ã€æœåŠ¡é—´éš”ç¦»&lt;/strong> çš„çº¿ç¨‹æ± ç®¡ç†æ–¹å¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>ServiceConfig&lt;/code> æ–°å¢ &lt;code>Executor executor&lt;/code> å‚æ•°ï¼Œ&lt;strong>ç”¨ä»¥æœåŠ¡é—´éš”ç¦»çš„çº¿ç¨‹æ± &lt;/strong>ï¼Œå¯ä»¥ç”±ç”¨æˆ·é…ç½®åŒ–ã€æä¾›è‡ªå·±æƒ³è¦çš„çº¿ç¨‹æ± ï¼Œè‹¥æ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä¼šæ ¹æ®åè®®é…ç½®(&lt;code>ProtocolConfig&lt;/code>)ä¿¡æ¯æ„å»ºé»˜è®¤çš„çº¿ç¨‹æ± ç”¨ä»¥æœåŠ¡éš”ç¦»ã€‚&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>&lt;code>ServiceConfig&lt;/code> æ–°å¢ &lt;code>Executor executor&lt;/code> é…ç½®å‚æ•°åªæœ‰æŒ‡å®š&lt;code>executor-management-mode = isolation&lt;/code> æ‰ç”Ÿæ•ˆã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="api">API&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">test&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// provider app&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DubboBootstrap providerBootstrap &lt;span style="color:#719e07">=&lt;/span> DubboBootstrap.newInstance();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ServiceConfig serviceConfig1 &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ServiceConfig();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serviceConfig1.setInterface(DemoService.class);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serviceConfig1.setRef(&lt;span style="color:#719e07">new&lt;/span> DemoServiceImpl());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serviceConfig1.setVersion(version1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// set executor1 for serviceConfig1, max threads is 10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> NamedThreadFactory threadFactory1 &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> NamedThreadFactory(&lt;span style="color:#2aa198">&amp;#34;DemoService-executor&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ExecutorService executor1 &lt;span style="color:#719e07">=&lt;/span> Executors.newFixedThreadPool(10, threadFactory1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serviceConfig1.setExecutor(executor1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ServiceConfig serviceConfig2 &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ServiceConfig();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serviceConfig2.setInterface(HelloService.class);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serviceConfig2.setRef(&lt;span style="color:#719e07">new&lt;/span> HelloServiceImpl());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serviceConfig2.setVersion(version2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// set executor2 for serviceConfig2, max threads is 100&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> NamedThreadFactory threadFactory2 &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> NamedThreadFactory(&lt;span style="color:#2aa198">&amp;#34;HelloService-executor&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ExecutorService executor2 &lt;span style="color:#719e07">=&lt;/span> Executors.newFixedThreadPool(100, threadFactory2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serviceConfig2.setExecutor(executor2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ServiceConfig serviceConfig3 &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ServiceConfig();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serviceConfig3.setInterface(HelloService.class);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serviceConfig3.setRef(&lt;span style="color:#719e07">new&lt;/span> HelloServiceImpl());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serviceConfig3.setVersion(version3);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// Because executor is not set for serviceConfig3, the default executor of serviceConfig3 is built using&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// the threadpool parameter of the protocolConfig ( FixedThreadpool , max threads is 200)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> serviceConfig3.setExecutor(&lt;span style="color:#cb4b16">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// It takes effect only if [executor-management-mode=isolation] is configured&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ApplicationConfig applicationConfig &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ApplicationConfig(&lt;span style="color:#2aa198">&amp;#34;provider-app&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> applicationConfig.setExecutorManagementMode(&lt;span style="color:#2aa198">&amp;#34;isolation&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> providerBootstrap
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .application(applicationConfig)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .registry(registryConfig)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// export with tri and dubbo protocol&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .protocol(&lt;span style="color:#719e07">new&lt;/span> ProtocolConfig(&lt;span style="color:#2aa198">&amp;#34;tri&amp;#34;&lt;/span>, 20001))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .protocol(&lt;span style="color:#719e07">new&lt;/span> ProtocolConfig(&lt;span style="color:#2aa198">&amp;#34;dubbo&amp;#34;&lt;/span>, 20002))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .service(serviceConfig1)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .service(serviceConfig2)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .service(serviceConfig3);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> providerBootstrap.start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="xml">XML&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;beans&lt;/span> xmlns:xsi=&lt;span style="color:#2aa198">&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xmlns:dubbo=&lt;span style="color:#2aa198">&amp;#34;http://dubbo.apache.org/schema/dubbo&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xmlns=&lt;span style="color:#2aa198">&amp;#34;http://www.springframework.org/schema/beans&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xsi:schemaLocation=&lt;span style="color:#2aa198">&amp;#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#2aa198"> http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd&amp;#34;&lt;/span>&lt;span style="color:#268bd2">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">&amp;lt;!-- NOTE: we need config executor-management-mode=&amp;#34;isolation&amp;#34; --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:application&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;demo-provider&amp;#34;&lt;/span> executor-management-mode=&lt;span style="color:#2aa198">&amp;#34;isolation&amp;#34;&lt;/span>&lt;span style="color:#268bd2">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;/dubbo:application&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:config-center&lt;/span> address=&lt;span style="color:#2aa198">&amp;#34;zookeeper://127.0.0.1:2181&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:metadata-report&lt;/span> address=&lt;span style="color:#2aa198">&amp;#34;zookeeper://127.0.0.1:2181&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:registry&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;registry1&amp;#34;&lt;/span> address=&lt;span style="color:#2aa198">&amp;#34;zookeeper://127.0.0.1:2181?registry-type=service&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:protocol&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;dubbo&amp;#34;&lt;/span> port=&lt;span style="color:#2aa198">&amp;#34;-1&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:protocol&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;tri&amp;#34;&lt;/span> port=&lt;span style="color:#2aa198">&amp;#34;-1&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">&amp;lt;!-- expose three service with dubbo and tri protocol--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;bean&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;demoServiceV1&amp;#34;&lt;/span> class=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.config.spring.impl.DemoServiceImpl&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;bean&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;helloServiceV2&amp;#34;&lt;/span> class=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.config.spring.impl.HelloServiceImpl&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;bean&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;helloServiceV3&amp;#34;&lt;/span> class=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.config.spring.impl.HelloServiceImpl&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">&amp;lt;!-- customized thread pool --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;bean&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;executor-demo-service&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> class=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.config.spring.isolation.spring.support.DemoServiceExecutor&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;bean&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;executor-hello-service&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> class=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.config.spring.isolation.spring.support.HelloServiceExecutor&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">&amp;lt;!-- this service use [executor=&amp;#34;executor-demo-service&amp;#34;] as isolated thread pool--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> executor=&lt;span style="color:#2aa198">&amp;#34;executor-demo-service&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.config.spring.api.DemoService&amp;#34;&lt;/span> version=&lt;span style="color:#2aa198">&amp;#34;1.0.0&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;Group1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> timeout=&lt;span style="color:#2aa198">&amp;#34;3000&amp;#34;&lt;/span> ref=&lt;span style="color:#2aa198">&amp;#34;demoServiceV1&amp;#34;&lt;/span> registry=&lt;span style="color:#2aa198">&amp;#34;registry1&amp;#34;&lt;/span> protocol=&lt;span style="color:#2aa198">&amp;#34;dubbo,tri&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">&amp;lt;!-- this service use [executor=&amp;#34;executor-hello-service&amp;#34;] as isolated thread pool--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> executor=&lt;span style="color:#2aa198">&amp;#34;executor-hello-service&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.config.spring.api.HelloService&amp;#34;&lt;/span> version=&lt;span style="color:#2aa198">&amp;#34;2.0.0&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;Group2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> timeout=&lt;span style="color:#2aa198">&amp;#34;5000&amp;#34;&lt;/span> ref=&lt;span style="color:#2aa198">&amp;#34;helloServiceV2&amp;#34;&lt;/span> registry=&lt;span style="color:#2aa198">&amp;#34;registry1&amp;#34;&lt;/span> protocol=&lt;span style="color:#2aa198">&amp;#34;dubbo,tri&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">&amp;lt;!-- not set executor for this service, the default executor built using threadpool parameter of the protocolConfig --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.config.spring.api.HelloService&amp;#34;&lt;/span> version=&lt;span style="color:#2aa198">&amp;#34;3.0.0&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;Group3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> timeout=&lt;span style="color:#2aa198">&amp;#34;5000&amp;#34;&lt;/span> ref=&lt;span style="color:#2aa198">&amp;#34;helloServiceV3&amp;#34;&lt;/span> registry=&lt;span style="color:#2aa198">&amp;#34;registry1&amp;#34;&lt;/span> protocol=&lt;span style="color:#2aa198">&amp;#34;dubbo,tri&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;/beans&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="annotation">Annotation&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@Configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@EnableDubbo&lt;/span>(scanBasePackages &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.config.spring.isolation.spring.annotation.provider&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">ProviderConfiguration&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> RegistryConfig &lt;span style="color:#268bd2">registryConfig&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RegistryConfig registryConfig &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> RegistryConfig();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> registryConfig.setAddress(&lt;span style="color:#2aa198">&amp;#34;zookeeper://127.0.0.1:2181&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> registryConfig;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// NOTE: we need config executor-management-mode=&amp;#34;isolation&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> ApplicationConfig &lt;span style="color:#268bd2">applicationConfig&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ApplicationConfig applicationConfig &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ApplicationConfig(&lt;span style="color:#2aa198">&amp;#34;provider-app&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> applicationConfig.setExecutorManagementMode(&lt;span style="color:#2aa198">&amp;#34;isolation&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> applicationConfig;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// expose services with dubbo protocol&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> ProtocolConfig &lt;span style="color:#268bd2">dubbo&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ProtocolConfig protocolConfig &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ProtocolConfig(&lt;span style="color:#2aa198">&amp;#34;dubbo&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> protocolConfig;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// expose services with tri protocol&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> ProtocolConfig &lt;span style="color:#268bd2">tri&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ProtocolConfig protocolConfig &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ProtocolConfig(&lt;span style="color:#2aa198">&amp;#34;tri&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> protocolConfig;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// customized thread pool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Bean&lt;/span>(&lt;span style="color:#2aa198">&amp;#34;executor-demo-service&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> Executor &lt;span style="color:#268bd2">demoServiceExecutor&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#719e07">new&lt;/span> DemoServiceExecutor();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// customized thread pool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Bean&lt;/span>(&lt;span style="color:#2aa198">&amp;#34;executor-hello-service&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> Executor &lt;span style="color:#268bd2">helloServiceExecutor&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#719e07">new&lt;/span> HelloServiceExecutor();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// customized thread pool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">DemoServiceExecutor&lt;/span> &lt;span style="color:#268bd2">extends&lt;/span> ThreadPoolExecutor {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">DemoServiceExecutor&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">super&lt;/span>(10, 10, 60, TimeUnit.SECONDS, &lt;span style="color:#719e07">new&lt;/span> LinkedBlockingDeque&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> NamedThreadFactory(&lt;span style="color:#2aa198">&amp;#34;DemoServiceExecutor&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// customized thread pool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">HelloServiceExecutor&lt;/span> &lt;span style="color:#268bd2">extends&lt;/span> ThreadPoolExecutor {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">HelloServiceExecutor&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">super&lt;/span>(100, 100, 60, TimeUnit.SECONDS, &lt;span style="color:#719e07">new&lt;/span> LinkedBlockingDeque&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> NamedThreadFactory(&lt;span style="color:#2aa198">&amp;#34;HelloServiceExecutor&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// &amp;#34;executor-hello-service&amp;#34; is beanName&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboService&lt;/span>(executor &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;executor-demo-service&amp;#34;&lt;/span>, version &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;1.0.0&amp;#34;&lt;/span>, group &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;Group1&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">DemoServiceImplV1&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> DemoService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayName&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#2aa198">&amp;#34;server name&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> Box &lt;span style="color:#268bd2">getBox&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// not set executor for this service, the default executor built using threadpool parameter of the protocolConfig&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboService&lt;/span>(version &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;3.0.0&amp;#34;&lt;/span>, group &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;Group3&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">HelloServiceImplV2&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> HelloService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">private&lt;/span> &lt;span style="color:#268bd2">static&lt;/span> &lt;span style="color:#268bd2">final&lt;/span> Logger logger &lt;span style="color:#719e07">=&lt;/span> LoggerFactory.getLogger(HelloServiceImplV2.class);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#2aa198">&amp;#34;server hello&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboService&lt;/span>(executor &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;executor-hello-service&amp;#34;&lt;/span>, version &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;2.0.0&amp;#34;&lt;/span>, group &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;Group2&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">HelloServiceImplV3&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> HelloService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">private&lt;/span> &lt;span style="color:#268bd2">static&lt;/span> &lt;span style="color:#268bd2">final&lt;/span> Logger logger &lt;span style="color:#719e07">=&lt;/span> LoggerFactory.getLogger(HelloServiceImplV3.class);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#2aa198">&amp;#34;server hello&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="åŠŸèƒ½è¯´æ˜-1">åŠŸèƒ½è¯´æ˜&lt;/h2>
&lt;p>dubbo é€šè¿‡ Jstack è‡ªåŠ¨å¯¼å‡ºçº¿ç¨‹å †æ ˆæ¥ä¿ç•™ç°åœºï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜ã€‚&lt;/p>
&lt;p>é»˜è®¤ç­–ç•¥&lt;/p>
&lt;ul>
&lt;li>å¯¼å‡ºè·¯å¾„: user.homeæ ‡è¯†çš„ç”¨æˆ·ä¸»ç›®å½•&lt;/li>
&lt;li>å¯¼å‡ºé—´éš”: æœ€çŸ­é—´éš”å…è®¸æ¯éš”10åˆ†é’Ÿå¯¼å‡ºä¸€æ¬¡&lt;/li>
&lt;li>å¯¼å‡ºå¼€å…³: é»˜è®¤æ‰“å¼€&lt;/li>
&lt;/ul>
&lt;h2 id="ä½¿ç”¨åœºæ™¯-3">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>å½“ä¸šåŠ¡çº¿ç¨‹æ± æ»¡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“çº¿ç¨‹éƒ½åœ¨ç­‰å¾…å“ªäº›èµ„æºã€æ¡ä»¶ï¼Œä»¥æ‰¾åˆ°ç³»ç»Ÿçš„ç“¶é¢ˆç‚¹æˆ–å¼‚å¸¸ç‚¹ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨æ–¹å¼-2">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;h3 id="å¯¼å‡ºå¼€å…³æ§åˆ¶">å¯¼å‡ºå¼€å…³æ§åˆ¶&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-properties" data-lang="properties">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"># dubbo.properties&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dubbo.application.dump.enable&lt;span style="color:#719e07">=&lt;/span>&lt;span style="color:#2aa198">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:application&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;demo-provider&amp;#34;&lt;/span> dump-enable=&lt;span style="color:#2aa198">&amp;#34;false&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">dubbo&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">application&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">name&lt;/span>: dubbo-springboot-demo-provider
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">dump-enable&lt;/span>: &lt;span style="color:#cb4b16">false&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æŒ‡å®šå¯¼å‡ºè·¯å¾„">æŒ‡å®šå¯¼å‡ºè·¯å¾„&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-properties" data-lang="properties">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"># dubbo.properties&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dubbo.application.dump.directory&lt;span style="color:#719e07">=&lt;/span>&lt;span style="color:#2aa198">/tmp&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:application&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;demo-provider&amp;#34;&lt;/span> dump-directory=&lt;span style="color:#2aa198">&amp;#34;/tmp&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">dubbo&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">application&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">name&lt;/span>: dubbo-springboot-demo-provider
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">dump-directory&lt;/span>: /tmp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Overview: å¼‚æ­¥è°ƒç”¨</title><link>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/filter/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/filter/</guid><description>
&lt;p>æ–‡æ¡£å®Œæ•´çš„ç¤ºä¾‹åœ°å€è¯·å‚è§&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-async/dubbo-samples-async-simple-boot">æœåŠ¡è°ƒç”¨å¼‚æ­¥&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-async/dubbo-samples-async-provider">æœåŠ¡æ‰§è¡Œå¼‚æ­¥&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-async/dubbo-samples-async-original-future">å®šä¹‰ CompletableFuture æ–¹æ³•ç­¾åçš„æœåŠ¡&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="å¼‚æ­¥è°ƒç”¨">å¼‚æ­¥è°ƒç”¨&lt;/h2>
&lt;p>Dubboå¼‚æ­¥è°ƒç”¨åˆ†ä¸ºProviderç«¯å¼‚æ­¥è°ƒç”¨å’ŒConsumerç«¯å¼‚æ­¥è°ƒç”¨ã€‚
Providerç«¯å¼‚æ­¥æ‰§è¡Œå°†é˜»å¡çš„ä¸šåŠ¡ä»Dubboå†…éƒ¨çº¿ç¨‹æ± åˆ‡æ¢åˆ°ä¸šåŠ¡è‡ªå®šä¹‰çº¿ç¨‹ï¼Œ
é¿å…Dubboçº¿ç¨‹æ± çš„è¿‡åº¦å ç”¨ï¼Œæœ‰åŠ©äºé¿å…ä¸åŒæœåŠ¡é—´çš„äº’ç›¸å½±å“ã€‚å¼‚æ­¥æ‰§è¡Œæ— å¼‚äºèŠ‚çœèµ„æºæˆ–æå‡RPCå“åº”æ€§èƒ½ã€‚&lt;/p>
&lt;p>&lt;em>&lt;font color='#FF7D00' size=4 > æ³¨æ„ &lt;/font>&lt;/em>&lt;/p>
&lt;blockquote>
&lt;p>Provider ç«¯å¼‚æ­¥æ‰§è¡Œå’Œ Consumer ç«¯å¼‚æ­¥è°ƒç”¨æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä½ å¯ä»¥ä»»æ„æ­£äº¤ç»„åˆä¸¤ç«¯é…ç½®&lt;/p>
&lt;ul>
&lt;li>ConsumeråŒæ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>ConsumeråŒæ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;ul>
&lt;li>å¯¹äºProviderç«¯æ¥è¯´ï¼Œå¦‚æœæ¥å£æ¯”è¾ƒè€—æ—¶ï¼Œé¿å…dubboçº¿ç¨‹è¢«é˜»å¡ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥å°†çº¿ç¨‹åˆ‡æ¢åˆ°ä¸šåŠ¡çº¿ç¨‹ã€‚&lt;/li>
&lt;li>å¯¹äºConsumerç«¯æ¥è¯´ï¼Œè°ƒç”¨Dubboæ¥å£æ²¡æœ‰ä¸¥æ ¼æ—¶åºä¸Šçš„å…³ç³»ã€ä¸æ˜¯åŸå­æ“ä½œã€ä¸å½±å“é€»è¾‘æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨å¼‚æ­¥è°ƒç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="providerå¼‚æ­¥">Providerå¼‚æ­¥&lt;/h2>
&lt;h3 id="1ä½¿ç”¨completablefutureå®ç°å¼‚æ­¥">1ã€ä½¿ç”¨CompletableFutureå®ç°å¼‚æ­¥&lt;/h3>
&lt;p>æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> * åŒæ­¥è°ƒç”¨æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">invoke&lt;/span>(String param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> * å¼‚æ­¥è°ƒç”¨æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">asyncInvoke&lt;/span>(String param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboService&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">invoke&lt;/span>(String param) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">long&lt;/span> time &lt;span style="color:#719e07">=&lt;/span> ThreadLocalRandom.current().nextLong(1000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(time);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StringBuilder s &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> StringBuilder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s.append(&lt;span style="color:#2aa198">&amp;#34;AsyncService invoke param:&amp;#34;&lt;/span>).append(param).append(&lt;span style="color:#2aa198">&amp;#34;,sleep:&amp;#34;&lt;/span>).append(time);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> s.toString();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.currentThread().interrupt();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">asyncInvoke&lt;/span>(String param) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å»ºè®®ä¸ºsupplyAsyncæä¾›è‡ªå®šä¹‰çº¿ç¨‹æ± &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> CompletableFuture.supplyAsync(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// Do something&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">long&lt;/span> time &lt;span style="color:#719e07">=&lt;/span> ThreadLocalRandom.current().nextLong(1000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(time);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StringBuilder s &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> StringBuilder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s.append(&lt;span style="color:#2aa198">&amp;#34;AsyncService asyncInvoke param:&amp;#34;&lt;/span>).append(param).append(&lt;span style="color:#2aa198">&amp;#34;,sleep:&amp;#34;&lt;/span>).append(time);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> s.toString();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.currentThread().interrupt();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ return CompletableFuture.supplyAsync() ï¼Œä¸šåŠ¡æ‰§è¡Œå·²ä» Dubbo çº¿ç¨‹åˆ‡æ¢åˆ°ä¸šåŠ¡çº¿ç¨‹ï¼Œé¿å…äº†å¯¹ Dubbo çº¿ç¨‹æ± çš„é˜»å¡ã€‚&lt;/p>
&lt;h3 id="2ä½¿ç”¨asynccontextå®ç°å¼‚æ­¥">2ã€ä½¿ç”¨AsyncContextå®ç°å¼‚æ­¥&lt;/h3>
&lt;p>Dubbo æä¾›äº†ä¸€ä¸ªç±»ä¼¼ Servlet 3.0 çš„å¼‚æ­¥æ¥å£AsyncContextï¼Œåœ¨æ²¡æœ‰ CompletableFuture ç­¾åæ¥å£çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å®ç° Provider ç«¯çš„å¼‚æ­¥æ‰§è¡Œã€‚&lt;/p>
&lt;p>æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">final&lt;/span> AsyncContext asyncContext &lt;span style="color:#719e07">=&lt;/span> RpcContext.startAsync();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> Thread(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å¦‚æœè¦ä½¿ç”¨ä¸Šä¸‹æ–‡ï¼Œåˆ™å¿…é¡»è¦æ”¾åœ¨ç¬¬ä¸€å¥æ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.signalContextSwitch();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(500);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å†™å›å“åº”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.write(&lt;span style="color:#2aa198">&amp;#34;Hello &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name &lt;span style="color:#719e07">+&lt;/span> &lt;span style="color:#2aa198">&amp;#34;, response from provider.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="consumerå¼‚æ­¥">Consumerå¼‚æ­¥&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboReference&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">private&lt;/span> AsyncService asyncService;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">run&lt;/span>(String... args) &lt;span style="color:#268bd2">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//è°ƒç”¨å¼‚æ­¥æ¥å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future1 &lt;span style="color:#719e07">=&lt;/span> asyncService.asyncInvoke(&lt;span style="color:#2aa198">&amp;#34;async call request1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future1.whenComplete((v, t) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (t &lt;span style="color:#719e07">!=&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;AsyncTask Response-1: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//ä¸¤æ¬¡è°ƒç”¨å¹¶éé¡ºåºè¿”å›&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future2 &lt;span style="color:#719e07">=&lt;/span> asyncService.asyncInvoke(&lt;span style="color:#2aa198">&amp;#34;async call request2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future2.whenComplete((v, t) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (t &lt;span style="color:#719e07">!=&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;AsyncTask Response-2: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//consumerå¼‚æ­¥è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future3 &lt;span style="color:#719e07">=&lt;/span> CompletableFuture.supplyAsync(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> asyncService.invoke(&lt;span style="color:#2aa198">&amp;#34;invoke call request3&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future3.whenComplete((v, t) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (t &lt;span style="color:#719e07">!=&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;AsyncTask Response-3: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;AsyncTask Executed before response return.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç‰¹æ€§è¯´æ˜">ç‰¹æ€§è¯´æ˜&lt;/h2>
&lt;h4 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h4>
&lt;p>ä» 2.7.0 å¼€å§‹ï¼ŒDubbo çš„æ‰€æœ‰å¼‚æ­¥ç¼–ç¨‹æ¥å£å¼€å§‹ä»¥ &lt;a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture&lt;/a> ä¸ºåŸºç¡€&lt;/p>
&lt;p>åŸºäº NIO çš„éé˜»å¡å®ç°å¹¶è¡Œè°ƒç”¨ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å¯åŠ¨å¤šçº¿ç¨‹å³å¯å®Œæˆå¹¶è¡Œè°ƒç”¨å¤šä¸ªè¿œç¨‹æœåŠ¡ï¼Œç›¸å¯¹å¤šçº¿ç¨‹å¼€é”€è¾ƒå°ã€‚&lt;/p>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/user/future.jpg" alt="/user-guide/images/future.jpg">&lt;/p>
&lt;h2 id="ä½¿ç”¨åœºæ™¯-1">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>å°†ç”¨æˆ·è¯·æ±‚å†…å®¹å‘é€åˆ°ç›®æ ‡è¯·æ±‚ï¼Œå½“ç›®æ ‡è¯·æ±‚é‡åˆ°é«˜æµé‡æˆ–éœ€è¦é•¿æ—¶é—´å¤„ç†ï¼Œå¼‚æ­¥è°ƒç”¨åŠŸèƒ½å°†å…è®¸ç«‹å³å‘ç”¨æˆ·è¿”å›å“åº”ï¼ŒåŒæ—¶ç›®æ ‡è¯·æ±‚ç»§ç»­åå°å¤„ç†è¯·æ±‚ï¼Œå½“ç›®æ ‡è¯·æ±‚è¿”å›ç»“æœæ—¶ï¼Œå°†å†…å®¹æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å‚è€ƒç”¨ä¾‹
&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-async">https://github.com/apache/dubbo-samples/tree/master/dubbo-samples-async&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;h3 id="ä½¿ç”¨-completablefuture-ç­¾åçš„æ¥å£">ä½¿ç”¨ CompletableFuture ç­¾åçš„æ¥å£&lt;/h3>
&lt;p>éœ€è¦æœåŠ¡æä¾›è€…äº‹å…ˆå®šä¹‰ CompletableFuture ç­¾åçš„æœåŠ¡ï¼Œæ¥å£å®šä¹‰æŒ‡å—å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>Providerç«¯å¼‚æ­¥æ‰§è¡Œå°†é˜»å¡çš„ä¸šåŠ¡ä»Dubboå†…éƒ¨çº¿ç¨‹æ± åˆ‡æ¢åˆ°ä¸šåŠ¡è‡ªå®šä¹‰çº¿ç¨‹ï¼Œé¿å…Dubboçº¿ç¨‹æ± çš„è¿‡åº¦å ç”¨ï¼Œæœ‰åŠ©äºé¿å…ä¸åŒæœåŠ¡é—´çš„äº’ç›¸å½±å“ã€‚å¼‚æ­¥æ‰§è¡Œæ— å¼‚äºèŠ‚çœèµ„æºæˆ–æå‡RPCå“åº”æ€§èƒ½ï¼Œå› ä¸ºå¦‚æœä¸šåŠ¡æ‰§è¡Œéœ€è¦é˜»å¡ï¼Œåˆ™å§‹ç»ˆè¿˜æ˜¯è¦æœ‰çº¿ç¨‹æ¥è´Ÿè´£æ‰§è¡Œã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Provider ç«¯å¼‚æ­¥æ‰§è¡Œå’Œ Consumer ç«¯å¼‚æ­¥è°ƒç”¨æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä»»æ„æ­£äº¤ç»„åˆä¸¤ç«¯é…ç½®&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ConsumeråŒæ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>ConsumeråŒæ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h3 id="å®šä¹‰-completablefuture-ç­¾åçš„æ¥å£">å®šä¹‰ CompletableFuture ç­¾åçš„æ¥å£&lt;/h3>
&lt;p>æœåŠ¡æ¥å£å®šä¹‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> CompletableFuture.supplyAsync(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(5000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#2aa198">&amp;#34;async response from provider.&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ &lt;code>return CompletableFuture.supplyAsync() &lt;/code>ï¼Œä¸šåŠ¡æ‰§è¡Œå·²ä» Dubbo çº¿ç¨‹åˆ‡æ¢åˆ°ä¸šåŠ¡çº¿ç¨‹ï¼Œé¿å…äº†å¯¹ Dubbo çº¿ç¨‹æ± çš„é˜»å¡ã€‚&lt;/p>
&lt;p>æ³¨æ„æ¥å£çš„è¿”å›ç±»å‹æ˜¯ &lt;code>CompletableFuture&amp;lt;String&amp;gt;&lt;/code>ã€‚&lt;/p>
&lt;p>XML å¼•ç”¨æœåŠ¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span> timeout=&lt;span style="color:#2aa198">&amp;#34;10000&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.alibaba.dubbo.samples.async.api.AsyncService&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è°ƒç”¨è¿œç¨‹æœåŠ¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// è°ƒç”¨ç›´æ¥è¿”å›CompletableFuture&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future &lt;span style="color:#719e07">=&lt;/span> asyncService.sayHello(&lt;span style="color:#2aa198">&amp;#34;async call request&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// å¢åŠ å›è°ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>future.whenComplete((v, t) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (t &lt;span style="color:#719e07">!=&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;Response: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// æ—©äºç»“æœè¾“å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>System.out.println(&lt;span style="color:#2aa198">&amp;#34;Executed before response return.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä½¿ç”¨-asynccontext">ä½¿ç”¨ AsyncContext&lt;/h3>
&lt;p>Dubbo æä¾›äº†ä¸€ä¸ªç±»ä¼¼ Servlet 3.0 çš„å¼‚æ­¥æ¥å£&lt;code>AsyncContext&lt;/code>ï¼Œåœ¨æ²¡æœ‰ CompletableFuture ç­¾åæ¥å£çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å®ç° Provider ç«¯çš„å¼‚æ­¥æ‰§è¡Œã€‚&lt;/p>
&lt;p>æœåŠ¡æ¥å£å®šä¹‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡æš´éœ²ï¼Œå’Œæ™®é€šæœåŠ¡å®Œå…¨ä¸€è‡´&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;bean&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span> class=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.impl.AsyncServiceImpl&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.api.AsyncService&amp;#34;&lt;/span> ref=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">final&lt;/span> AsyncContext asyncContext &lt;span style="color:#719e07">=&lt;/span> RpcContext.startAsync();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> Thread(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å¦‚æœè¦ä½¿ç”¨ä¸Šä¸‹æ–‡ï¼Œåˆ™å¿…é¡»è¦æ”¾åœ¨ç¬¬ä¸€å¥æ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.signalContextSwitch();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(500);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å†™å›å“åº”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.write(&lt;span style="color:#2aa198">&amp;#34;Hello &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name &lt;span style="color:#719e07">+&lt;/span> &lt;span style="color:#2aa198">&amp;#34;, response from provider.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä½¿ç”¨-rpccontext-å®ç°æ¶ˆè´¹ç«¯å¼‚æ­¥è°ƒç”¨">ä½¿ç”¨ RpcContext å®ç°æ¶ˆè´¹ç«¯å¼‚æ­¥è°ƒç”¨&lt;/h3>
&lt;p>åœ¨ consumer.xml ä¸­é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.api.AsyncService&amp;#34;&lt;/span>&lt;span style="color:#268bd2">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:method&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;sayHello&amp;#34;&lt;/span> async=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;/dubbo:reference&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è°ƒç”¨ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// æ­¤è°ƒç”¨ä¼šç«‹å³è¿”å›null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>asyncService.sayHello(&lt;span style="color:#2aa198">&amp;#34;world&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// æ‹¿åˆ°è°ƒç”¨çš„Futureå¼•ç”¨ï¼Œå½“ç»“æœè¿”å›åï¼Œä¼šè¢«é€šçŸ¥å’Œè®¾ç½®åˆ°æ­¤Future&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> helloFuture &lt;span style="color:#719e07">=&lt;/span> RpcContext.getServiceContext().getCompletableFuture();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// ä¸ºFutureæ·»åŠ å›è°ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>helloFuture.whenComplete((retValue, exception) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (exception &lt;span style="color:#719e07">==&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(retValue);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exception.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…ï¼Œä¹Ÿå¯ä»¥è¿™æ ·åšå¼‚æ­¥è°ƒç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future &lt;span style="color:#719e07">=&lt;/span> RpcContext.getServiceContext().asyncCall(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> () &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncService.sayHello(&lt;span style="color:#2aa198">&amp;#34;oneway call request1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>future.get();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å¼‚æ­¥æ€»æ˜¯ä¸ç­‰å¾…è¿”å›&lt;/strong>ï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®æ˜¯å¦ç­‰å¾…æ¶ˆæ¯å‘å‡º&lt;/p>
&lt;ul>
&lt;li>&lt;code>sent=&amp;quot;true&amp;quot;&lt;/code> ç­‰å¾…æ¶ˆæ¯å‘å‡ºï¼Œæ¶ˆæ¯å‘é€å¤±è´¥å°†æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/li>
&lt;li>&lt;code>sent=&amp;quot;false&amp;quot;&lt;/code> ä¸ç­‰å¾…æ¶ˆæ¯å‘å‡ºï¼Œå°†æ¶ˆæ¯æ”¾å…¥ IO é˜Ÿåˆ—ï¼Œå³åˆ»è¿”å›ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:method&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;findFoo&amp;#34;&lt;/span> async=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> sent=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœä½ åªæ˜¯æƒ³å¼‚æ­¥ï¼Œå®Œå…¨å¿½ç•¥è¿”å›å€¼ï¼Œå¯ä»¥é…ç½® &lt;code>return=&amp;quot;false&amp;quot;&lt;/code>ï¼Œä»¥å‡å°‘ Future å¯¹è±¡çš„åˆ›å»ºå’Œç®¡ç†æˆæœ¬&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:method&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;findFoo&amp;#34;&lt;/span> async=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> return=&lt;span style="color:#2aa198">&amp;#34;false&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;div class="pageinfo pageinfo-primary">
&lt;p>æ­¤æ–‡æ¡£å·²ç»ä¸å†ç»´æŠ¤ã€‚æ‚¨å½“å‰æŸ¥çœ‹çš„æ˜¯å¿«ç…§ç‰ˆæœ¬ã€‚å¦‚æœæƒ³è¦æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬çš„æ–‡æ¡£ï¼Œè¯·å‚é˜…&lt;a href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/advanced-features-and-usage/service/attachment/">æœ€æ–°ç‰ˆæœ¬&lt;/a>ã€‚&lt;/p>
&lt;/div>
&lt;p>Providerç«¯å¼‚æ­¥æ‰§è¡Œå°†é˜»å¡çš„ä¸šåŠ¡ä»Dubboå†…éƒ¨çº¿ç¨‹æ± åˆ‡æ¢åˆ°ä¸šåŠ¡è‡ªå®šä¹‰çº¿ç¨‹ï¼Œé¿å…Dubboçº¿ç¨‹æ± çš„è¿‡åº¦å ç”¨ï¼Œæœ‰åŠ©äºé¿å…ä¸åŒæœåŠ¡é—´çš„äº’ç›¸å½±å“ã€‚å¼‚æ­¥æ‰§è¡Œæ— å¼‚äºèŠ‚çœèµ„æºæˆ–æå‡RPCå“åº”æ€§èƒ½ï¼Œå› ä¸ºå¦‚æœä¸šåŠ¡æ‰§è¡Œéœ€è¦é˜»å¡ï¼Œåˆ™å§‹ç»ˆè¿˜æ˜¯è¦æœ‰çº¿ç¨‹æ¥è´Ÿè´£æ‰§è¡Œã€‚&lt;/p>
&lt;div class="alert alert-warning" role="alert">
&lt;h4 class="alert-heading">æ³¨æ„&lt;/h4>
&lt;p>Provider ç«¯å¼‚æ­¥æ‰§è¡Œå’Œ Consumer ç«¯å¼‚æ­¥è°ƒç”¨æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä½ å¯ä»¥ä»»æ„æ­£äº¤ç»„åˆä¸¤ç«¯é…ç½®&lt;/p>
&lt;ul>
&lt;li>ConsumeråŒæ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>ConsumeråŒæ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h2 id="å®šä¹‰-completablefuture-ç­¾åçš„æ¥å£-1">å®šä¹‰ CompletableFuture ç­¾åçš„æ¥å£&lt;/h2>
&lt;p>æœåŠ¡æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RpcContext savedContext &lt;span style="color:#719e07">=&lt;/span> RpcContext.getContext();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å»ºè®®ä¸ºsupplyAsyncæä¾›è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œé¿å…ä½¿ç”¨JDKå…¬ç”¨çº¿ç¨‹æ± &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> CompletableFuture.supplyAsync(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(savedContext.getAttachment(&lt;span style="color:#2aa198">&amp;#34;consumer-key1&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(5000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#2aa198">&amp;#34;async response from provider.&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ &lt;code>return CompletableFuture.supplyAsync() &lt;/code>ï¼Œä¸šåŠ¡æ‰§è¡Œå·²ä» Dubbo çº¿ç¨‹åˆ‡æ¢åˆ°ä¸šåŠ¡çº¿ç¨‹ï¼Œé¿å…äº†å¯¹ Dubbo çº¿ç¨‹æ± çš„é˜»å¡ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨asynccontext">ä½¿ç”¨AsyncContext&lt;/h2>
&lt;p>Dubbo æä¾›äº†ä¸€ä¸ªç±»ä¼¼ Servlet 3.0 çš„å¼‚æ­¥æ¥å£&lt;code>AsyncContext&lt;/code>ï¼Œåœ¨æ²¡æœ‰ CompletableFuture ç­¾åæ¥å£çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å®ç° Provider ç«¯çš„å¼‚æ­¥æ‰§è¡Œã€‚&lt;/p>
&lt;p>æœåŠ¡æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡æš´éœ²ï¼Œå’Œæ™®é€šæœåŠ¡å®Œå…¨ä¸€è‡´ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;bean&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span> class=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.impl.AsyncServiceImpl&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.api.AsyncService&amp;#34;&lt;/span> ref=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">final&lt;/span> AsyncContext asyncContext &lt;span style="color:#719e07">=&lt;/span> RpcContext.startAsync();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> Thread(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å¦‚æœè¦ä½¿ç”¨ä¸Šä¸‹æ–‡ï¼Œåˆ™å¿…é¡»è¦æ”¾åœ¨ç¬¬ä¸€å¥æ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.signalContextSwitch();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(500);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å†™å›å“åº”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.write(&lt;span style="color:#2aa198">&amp;#34;Hello &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name &lt;span style="color:#719e07">+&lt;/span> &lt;span style="color:#2aa198">&amp;#34;, response from provider.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Overview: å¼‚æ­¥è°ƒç”¨</title><link>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/timeout/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/timeout/</guid><description>
&lt;p>æ–‡æ¡£å®Œæ•´çš„ç¤ºä¾‹åœ°å€è¯·å‚è§&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-async/dubbo-samples-async-simple-boot">æœåŠ¡è°ƒç”¨å¼‚æ­¥&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-async/dubbo-samples-async-provider">æœåŠ¡æ‰§è¡Œå¼‚æ­¥&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-async/dubbo-samples-async-original-future">å®šä¹‰ CompletableFuture æ–¹æ³•ç­¾åçš„æœåŠ¡&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="å¼‚æ­¥è°ƒç”¨">å¼‚æ­¥è°ƒç”¨&lt;/h2>
&lt;p>Dubboå¼‚æ­¥è°ƒç”¨åˆ†ä¸ºProviderç«¯å¼‚æ­¥è°ƒç”¨å’ŒConsumerç«¯å¼‚æ­¥è°ƒç”¨ã€‚
Providerç«¯å¼‚æ­¥æ‰§è¡Œå°†é˜»å¡çš„ä¸šåŠ¡ä»Dubboå†…éƒ¨çº¿ç¨‹æ± åˆ‡æ¢åˆ°ä¸šåŠ¡è‡ªå®šä¹‰çº¿ç¨‹ï¼Œ
é¿å…Dubboçº¿ç¨‹æ± çš„è¿‡åº¦å ç”¨ï¼Œæœ‰åŠ©äºé¿å…ä¸åŒæœåŠ¡é—´çš„äº’ç›¸å½±å“ã€‚å¼‚æ­¥æ‰§è¡Œæ— å¼‚äºèŠ‚çœèµ„æºæˆ–æå‡RPCå“åº”æ€§èƒ½ã€‚&lt;/p>
&lt;p>&lt;em>&lt;font color='#FF7D00' size=4 > æ³¨æ„ &lt;/font>&lt;/em>&lt;/p>
&lt;blockquote>
&lt;p>Provider ç«¯å¼‚æ­¥æ‰§è¡Œå’Œ Consumer ç«¯å¼‚æ­¥è°ƒç”¨æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä½ å¯ä»¥ä»»æ„æ­£äº¤ç»„åˆä¸¤ç«¯é…ç½®&lt;/p>
&lt;ul>
&lt;li>ConsumeråŒæ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>ConsumeråŒæ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;ul>
&lt;li>å¯¹äºProviderç«¯æ¥è¯´ï¼Œå¦‚æœæ¥å£æ¯”è¾ƒè€—æ—¶ï¼Œé¿å…dubboçº¿ç¨‹è¢«é˜»å¡ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥å°†çº¿ç¨‹åˆ‡æ¢åˆ°ä¸šåŠ¡çº¿ç¨‹ã€‚&lt;/li>
&lt;li>å¯¹äºConsumerç«¯æ¥è¯´ï¼Œè°ƒç”¨Dubboæ¥å£æ²¡æœ‰ä¸¥æ ¼æ—¶åºä¸Šçš„å…³ç³»ã€ä¸æ˜¯åŸå­æ“ä½œã€ä¸å½±å“é€»è¾‘æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨å¼‚æ­¥è°ƒç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="providerå¼‚æ­¥">Providerå¼‚æ­¥&lt;/h2>
&lt;h3 id="1ä½¿ç”¨completablefutureå®ç°å¼‚æ­¥">1ã€ä½¿ç”¨CompletableFutureå®ç°å¼‚æ­¥&lt;/h3>
&lt;p>æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> * åŒæ­¥è°ƒç”¨æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">invoke&lt;/span>(String param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> * å¼‚æ­¥è°ƒç”¨æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">asyncInvoke&lt;/span>(String param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboService&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">invoke&lt;/span>(String param) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">long&lt;/span> time &lt;span style="color:#719e07">=&lt;/span> ThreadLocalRandom.current().nextLong(1000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(time);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StringBuilder s &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> StringBuilder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s.append(&lt;span style="color:#2aa198">&amp;#34;AsyncService invoke param:&amp;#34;&lt;/span>).append(param).append(&lt;span style="color:#2aa198">&amp;#34;,sleep:&amp;#34;&lt;/span>).append(time);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> s.toString();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.currentThread().interrupt();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">asyncInvoke&lt;/span>(String param) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å»ºè®®ä¸ºsupplyAsyncæä¾›è‡ªå®šä¹‰çº¿ç¨‹æ± &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> CompletableFuture.supplyAsync(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// Do something&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">long&lt;/span> time &lt;span style="color:#719e07">=&lt;/span> ThreadLocalRandom.current().nextLong(1000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(time);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StringBuilder s &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> StringBuilder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s.append(&lt;span style="color:#2aa198">&amp;#34;AsyncService asyncInvoke param:&amp;#34;&lt;/span>).append(param).append(&lt;span style="color:#2aa198">&amp;#34;,sleep:&amp;#34;&lt;/span>).append(time);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> s.toString();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.currentThread().interrupt();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ return CompletableFuture.supplyAsync() ï¼Œä¸šåŠ¡æ‰§è¡Œå·²ä» Dubbo çº¿ç¨‹åˆ‡æ¢åˆ°ä¸šåŠ¡çº¿ç¨‹ï¼Œé¿å…äº†å¯¹ Dubbo çº¿ç¨‹æ± çš„é˜»å¡ã€‚&lt;/p>
&lt;h3 id="2ä½¿ç”¨asynccontextå®ç°å¼‚æ­¥">2ã€ä½¿ç”¨AsyncContextå®ç°å¼‚æ­¥&lt;/h3>
&lt;p>Dubbo æä¾›äº†ä¸€ä¸ªç±»ä¼¼ Servlet 3.0 çš„å¼‚æ­¥æ¥å£AsyncContextï¼Œåœ¨æ²¡æœ‰ CompletableFuture ç­¾åæ¥å£çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å®ç° Provider ç«¯çš„å¼‚æ­¥æ‰§è¡Œã€‚&lt;/p>
&lt;p>æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">final&lt;/span> AsyncContext asyncContext &lt;span style="color:#719e07">=&lt;/span> RpcContext.startAsync();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> Thread(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å¦‚æœè¦ä½¿ç”¨ä¸Šä¸‹æ–‡ï¼Œåˆ™å¿…é¡»è¦æ”¾åœ¨ç¬¬ä¸€å¥æ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.signalContextSwitch();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(500);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å†™å›å“åº”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.write(&lt;span style="color:#2aa198">&amp;#34;Hello &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name &lt;span style="color:#719e07">+&lt;/span> &lt;span style="color:#2aa198">&amp;#34;, response from provider.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="consumerå¼‚æ­¥">Consumerå¼‚æ­¥&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboReference&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">private&lt;/span> AsyncService asyncService;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">run&lt;/span>(String... args) &lt;span style="color:#268bd2">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//è°ƒç”¨å¼‚æ­¥æ¥å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future1 &lt;span style="color:#719e07">=&lt;/span> asyncService.asyncInvoke(&lt;span style="color:#2aa198">&amp;#34;async call request1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future1.whenComplete((v, t) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (t &lt;span style="color:#719e07">!=&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;AsyncTask Response-1: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//ä¸¤æ¬¡è°ƒç”¨å¹¶éé¡ºåºè¿”å›&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future2 &lt;span style="color:#719e07">=&lt;/span> asyncService.asyncInvoke(&lt;span style="color:#2aa198">&amp;#34;async call request2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future2.whenComplete((v, t) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (t &lt;span style="color:#719e07">!=&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;AsyncTask Response-2: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//consumerå¼‚æ­¥è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future3 &lt;span style="color:#719e07">=&lt;/span> CompletableFuture.supplyAsync(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> asyncService.invoke(&lt;span style="color:#2aa198">&amp;#34;invoke call request3&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future3.whenComplete((v, t) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (t &lt;span style="color:#719e07">!=&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;AsyncTask Response-3: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;AsyncTask Executed before response return.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç‰¹æ€§è¯´æ˜">ç‰¹æ€§è¯´æ˜&lt;/h2>
&lt;h4 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h4>
&lt;p>ä» 2.7.0 å¼€å§‹ï¼ŒDubbo çš„æ‰€æœ‰å¼‚æ­¥ç¼–ç¨‹æ¥å£å¼€å§‹ä»¥ &lt;a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture&lt;/a> ä¸ºåŸºç¡€&lt;/p>
&lt;p>åŸºäº NIO çš„éé˜»å¡å®ç°å¹¶è¡Œè°ƒç”¨ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å¯åŠ¨å¤šçº¿ç¨‹å³å¯å®Œæˆå¹¶è¡Œè°ƒç”¨å¤šä¸ªè¿œç¨‹æœåŠ¡ï¼Œç›¸å¯¹å¤šçº¿ç¨‹å¼€é”€è¾ƒå°ã€‚&lt;/p>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/user/future.jpg" alt="/user-guide/images/future.jpg">&lt;/p>
&lt;h2 id="ä½¿ç”¨åœºæ™¯-1">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>å°†ç”¨æˆ·è¯·æ±‚å†…å®¹å‘é€åˆ°ç›®æ ‡è¯·æ±‚ï¼Œå½“ç›®æ ‡è¯·æ±‚é‡åˆ°é«˜æµé‡æˆ–éœ€è¦é•¿æ—¶é—´å¤„ç†ï¼Œå¼‚æ­¥è°ƒç”¨åŠŸèƒ½å°†å…è®¸ç«‹å³å‘ç”¨æˆ·è¿”å›å“åº”ï¼ŒåŒæ—¶ç›®æ ‡è¯·æ±‚ç»§ç»­åå°å¤„ç†è¯·æ±‚ï¼Œå½“ç›®æ ‡è¯·æ±‚è¿”å›ç»“æœæ—¶ï¼Œå°†å†…å®¹æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å‚è€ƒç”¨ä¾‹
&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-async">https://github.com/apache/dubbo-samples/tree/master/dubbo-samples-async&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;h3 id="ä½¿ç”¨-completablefuture-ç­¾åçš„æ¥å£">ä½¿ç”¨ CompletableFuture ç­¾åçš„æ¥å£&lt;/h3>
&lt;p>éœ€è¦æœåŠ¡æä¾›è€…äº‹å…ˆå®šä¹‰ CompletableFuture ç­¾åçš„æœåŠ¡ï¼Œæ¥å£å®šä¹‰æŒ‡å—å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>Providerç«¯å¼‚æ­¥æ‰§è¡Œå°†é˜»å¡çš„ä¸šåŠ¡ä»Dubboå†…éƒ¨çº¿ç¨‹æ± åˆ‡æ¢åˆ°ä¸šåŠ¡è‡ªå®šä¹‰çº¿ç¨‹ï¼Œé¿å…Dubboçº¿ç¨‹æ± çš„è¿‡åº¦å ç”¨ï¼Œæœ‰åŠ©äºé¿å…ä¸åŒæœåŠ¡é—´çš„äº’ç›¸å½±å“ã€‚å¼‚æ­¥æ‰§è¡Œæ— å¼‚äºèŠ‚çœèµ„æºæˆ–æå‡RPCå“åº”æ€§èƒ½ï¼Œå› ä¸ºå¦‚æœä¸šåŠ¡æ‰§è¡Œéœ€è¦é˜»å¡ï¼Œåˆ™å§‹ç»ˆè¿˜æ˜¯è¦æœ‰çº¿ç¨‹æ¥è´Ÿè´£æ‰§è¡Œã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Provider ç«¯å¼‚æ­¥æ‰§è¡Œå’Œ Consumer ç«¯å¼‚æ­¥è°ƒç”¨æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä»»æ„æ­£äº¤ç»„åˆä¸¤ç«¯é…ç½®&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ConsumeråŒæ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>ConsumeråŒæ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h3 id="å®šä¹‰-completablefuture-ç­¾åçš„æ¥å£">å®šä¹‰ CompletableFuture ç­¾åçš„æ¥å£&lt;/h3>
&lt;p>æœåŠ¡æ¥å£å®šä¹‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> CompletableFuture.supplyAsync(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(5000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#2aa198">&amp;#34;async response from provider.&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ &lt;code>return CompletableFuture.supplyAsync() &lt;/code>ï¼Œä¸šåŠ¡æ‰§è¡Œå·²ä» Dubbo çº¿ç¨‹åˆ‡æ¢åˆ°ä¸šåŠ¡çº¿ç¨‹ï¼Œé¿å…äº†å¯¹ Dubbo çº¿ç¨‹æ± çš„é˜»å¡ã€‚&lt;/p>
&lt;p>æ³¨æ„æ¥å£çš„è¿”å›ç±»å‹æ˜¯ &lt;code>CompletableFuture&amp;lt;String&amp;gt;&lt;/code>ã€‚&lt;/p>
&lt;p>XML å¼•ç”¨æœåŠ¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span> timeout=&lt;span style="color:#2aa198">&amp;#34;10000&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.alibaba.dubbo.samples.async.api.AsyncService&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è°ƒç”¨è¿œç¨‹æœåŠ¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// è°ƒç”¨ç›´æ¥è¿”å›CompletableFuture&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future &lt;span style="color:#719e07">=&lt;/span> asyncService.sayHello(&lt;span style="color:#2aa198">&amp;#34;async call request&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// å¢åŠ å›è°ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>future.whenComplete((v, t) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (t &lt;span style="color:#719e07">!=&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;Response: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// æ—©äºç»“æœè¾“å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>System.out.println(&lt;span style="color:#2aa198">&amp;#34;Executed before response return.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä½¿ç”¨-asynccontext">ä½¿ç”¨ AsyncContext&lt;/h3>
&lt;p>Dubbo æä¾›äº†ä¸€ä¸ªç±»ä¼¼ Servlet 3.0 çš„å¼‚æ­¥æ¥å£&lt;code>AsyncContext&lt;/code>ï¼Œåœ¨æ²¡æœ‰ CompletableFuture ç­¾åæ¥å£çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å®ç° Provider ç«¯çš„å¼‚æ­¥æ‰§è¡Œã€‚&lt;/p>
&lt;p>æœåŠ¡æ¥å£å®šä¹‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡æš´éœ²ï¼Œå’Œæ™®é€šæœåŠ¡å®Œå…¨ä¸€è‡´&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;bean&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span> class=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.impl.AsyncServiceImpl&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.api.AsyncService&amp;#34;&lt;/span> ref=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">final&lt;/span> AsyncContext asyncContext &lt;span style="color:#719e07">=&lt;/span> RpcContext.startAsync();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> Thread(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å¦‚æœè¦ä½¿ç”¨ä¸Šä¸‹æ–‡ï¼Œåˆ™å¿…é¡»è¦æ”¾åœ¨ç¬¬ä¸€å¥æ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.signalContextSwitch();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(500);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å†™å›å“åº”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.write(&lt;span style="color:#2aa198">&amp;#34;Hello &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name &lt;span style="color:#719e07">+&lt;/span> &lt;span style="color:#2aa198">&amp;#34;, response from provider.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä½¿ç”¨-rpccontext-å®ç°æ¶ˆè´¹ç«¯å¼‚æ­¥è°ƒç”¨">ä½¿ç”¨ RpcContext å®ç°æ¶ˆè´¹ç«¯å¼‚æ­¥è°ƒç”¨&lt;/h3>
&lt;p>åœ¨ consumer.xml ä¸­é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.api.AsyncService&amp;#34;&lt;/span>&lt;span style="color:#268bd2">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:method&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;sayHello&amp;#34;&lt;/span> async=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;/dubbo:reference&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è°ƒç”¨ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// æ­¤è°ƒç”¨ä¼šç«‹å³è¿”å›null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>asyncService.sayHello(&lt;span style="color:#2aa198">&amp;#34;world&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// æ‹¿åˆ°è°ƒç”¨çš„Futureå¼•ç”¨ï¼Œå½“ç»“æœè¿”å›åï¼Œä¼šè¢«é€šçŸ¥å’Œè®¾ç½®åˆ°æ­¤Future&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> helloFuture &lt;span style="color:#719e07">=&lt;/span> RpcContext.getServiceContext().getCompletableFuture();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// ä¸ºFutureæ·»åŠ å›è°ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>helloFuture.whenComplete((retValue, exception) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (exception &lt;span style="color:#719e07">==&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(retValue);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exception.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…ï¼Œä¹Ÿå¯ä»¥è¿™æ ·åšå¼‚æ­¥è°ƒç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future &lt;span style="color:#719e07">=&lt;/span> RpcContext.getServiceContext().asyncCall(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> () &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncService.sayHello(&lt;span style="color:#2aa198">&amp;#34;oneway call request1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>future.get();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å¼‚æ­¥æ€»æ˜¯ä¸ç­‰å¾…è¿”å›&lt;/strong>ï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®æ˜¯å¦ç­‰å¾…æ¶ˆæ¯å‘å‡º&lt;/p>
&lt;ul>
&lt;li>&lt;code>sent=&amp;quot;true&amp;quot;&lt;/code> ç­‰å¾…æ¶ˆæ¯å‘å‡ºï¼Œæ¶ˆæ¯å‘é€å¤±è´¥å°†æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/li>
&lt;li>&lt;code>sent=&amp;quot;false&amp;quot;&lt;/code> ä¸ç­‰å¾…æ¶ˆæ¯å‘å‡ºï¼Œå°†æ¶ˆæ¯æ”¾å…¥ IO é˜Ÿåˆ—ï¼Œå³åˆ»è¿”å›ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:method&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;findFoo&amp;#34;&lt;/span> async=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> sent=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœä½ åªæ˜¯æƒ³å¼‚æ­¥ï¼Œå®Œå…¨å¿½ç•¥è¿”å›å€¼ï¼Œå¯ä»¥é…ç½® &lt;code>return=&amp;quot;false&amp;quot;&lt;/code>ï¼Œä»¥å‡å°‘ Future å¯¹è±¡çš„åˆ›å»ºå’Œç®¡ç†æˆæœ¬&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:method&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;findFoo&amp;#34;&lt;/span> async=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> return=&lt;span style="color:#2aa198">&amp;#34;false&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;div class="pageinfo pageinfo-primary">
&lt;p>æ­¤æ–‡æ¡£å·²ç»ä¸å†ç»´æŠ¤ã€‚æ‚¨å½“å‰æŸ¥çœ‹çš„æ˜¯å¿«ç…§ç‰ˆæœ¬ã€‚å¦‚æœæƒ³è¦æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬çš„æ–‡æ¡£ï¼Œè¯·å‚é˜…&lt;a href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/advanced-features-and-usage/service/attachment/">æœ€æ–°ç‰ˆæœ¬&lt;/a>ã€‚&lt;/p>
&lt;/div>
&lt;p>Providerç«¯å¼‚æ­¥æ‰§è¡Œå°†é˜»å¡çš„ä¸šåŠ¡ä»Dubboå†…éƒ¨çº¿ç¨‹æ± åˆ‡æ¢åˆ°ä¸šåŠ¡è‡ªå®šä¹‰çº¿ç¨‹ï¼Œé¿å…Dubboçº¿ç¨‹æ± çš„è¿‡åº¦å ç”¨ï¼Œæœ‰åŠ©äºé¿å…ä¸åŒæœåŠ¡é—´çš„äº’ç›¸å½±å“ã€‚å¼‚æ­¥æ‰§è¡Œæ— å¼‚äºèŠ‚çœèµ„æºæˆ–æå‡RPCå“åº”æ€§èƒ½ï¼Œå› ä¸ºå¦‚æœä¸šåŠ¡æ‰§è¡Œéœ€è¦é˜»å¡ï¼Œåˆ™å§‹ç»ˆè¿˜æ˜¯è¦æœ‰çº¿ç¨‹æ¥è´Ÿè´£æ‰§è¡Œã€‚&lt;/p>
&lt;div class="alert alert-warning" role="alert">
&lt;h4 class="alert-heading">æ³¨æ„&lt;/h4>
&lt;p>Provider ç«¯å¼‚æ­¥æ‰§è¡Œå’Œ Consumer ç«¯å¼‚æ­¥è°ƒç”¨æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä½ å¯ä»¥ä»»æ„æ­£äº¤ç»„åˆä¸¤ç«¯é…ç½®&lt;/p>
&lt;ul>
&lt;li>ConsumeråŒæ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>ConsumeråŒæ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h2 id="å®šä¹‰-completablefuture-ç­¾åçš„æ¥å£-1">å®šä¹‰ CompletableFuture ç­¾åçš„æ¥å£&lt;/h2>
&lt;p>æœåŠ¡æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RpcContext savedContext &lt;span style="color:#719e07">=&lt;/span> RpcContext.getContext();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å»ºè®®ä¸ºsupplyAsyncæä¾›è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œé¿å…ä½¿ç”¨JDKå…¬ç”¨çº¿ç¨‹æ± &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> CompletableFuture.supplyAsync(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(savedContext.getAttachment(&lt;span style="color:#2aa198">&amp;#34;consumer-key1&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(5000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#2aa198">&amp;#34;async response from provider.&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ &lt;code>return CompletableFuture.supplyAsync() &lt;/code>ï¼Œä¸šåŠ¡æ‰§è¡Œå·²ä» Dubbo çº¿ç¨‹åˆ‡æ¢åˆ°ä¸šåŠ¡çº¿ç¨‹ï¼Œé¿å…äº†å¯¹ Dubbo çº¿ç¨‹æ± çš„é˜»å¡ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨asynccontext">ä½¿ç”¨AsyncContext&lt;/h2>
&lt;p>Dubbo æä¾›äº†ä¸€ä¸ªç±»ä¼¼ Servlet 3.0 çš„å¼‚æ­¥æ¥å£&lt;code>AsyncContext&lt;/code>ï¼Œåœ¨æ²¡æœ‰ CompletableFuture ç­¾åæ¥å£çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å®ç° Provider ç«¯çš„å¼‚æ­¥æ‰§è¡Œã€‚&lt;/p>
&lt;p>æœåŠ¡æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡æš´éœ²ï¼Œå’Œæ™®é€šæœåŠ¡å®Œå…¨ä¸€è‡´ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;bean&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span> class=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.impl.AsyncServiceImpl&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.api.AsyncService&amp;#34;&lt;/span> ref=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">final&lt;/span> AsyncContext asyncContext &lt;span style="color:#719e07">=&lt;/span> RpcContext.startAsync();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> Thread(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å¦‚æœè¦ä½¿ç”¨ä¸Šä¸‹æ–‡ï¼Œåˆ™å¿…é¡»è¦æ”¾åœ¨ç¬¬ä¸€å¥æ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.signalContextSwitch();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(500);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å†™å›å“åº”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.write(&lt;span style="color:#2aa198">&amp;#34;Hello &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name &lt;span style="color:#719e07">+&lt;/span> &lt;span style="color:#2aa198">&amp;#34;, response from provider.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Overview: å¼‚æ­¥è°ƒç”¨</title><link>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/async/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/async/</guid><description>
&lt;p>æ–‡æ¡£å®Œæ•´çš„ç¤ºä¾‹åœ°å€è¯·å‚è§&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-async/dubbo-samples-async-simple-boot">æœåŠ¡è°ƒç”¨å¼‚æ­¥&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-async/dubbo-samples-async-provider">æœåŠ¡æ‰§è¡Œå¼‚æ­¥&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-async/dubbo-samples-async-original-future">å®šä¹‰ CompletableFuture æ–¹æ³•ç­¾åçš„æœåŠ¡&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="å¼‚æ­¥è°ƒç”¨">å¼‚æ­¥è°ƒç”¨&lt;/h2>
&lt;p>Dubboå¼‚æ­¥è°ƒç”¨åˆ†ä¸ºProviderç«¯å¼‚æ­¥è°ƒç”¨å’ŒConsumerç«¯å¼‚æ­¥è°ƒç”¨ã€‚
Providerç«¯å¼‚æ­¥æ‰§è¡Œå°†é˜»å¡çš„ä¸šåŠ¡ä»Dubboå†…éƒ¨çº¿ç¨‹æ± åˆ‡æ¢åˆ°ä¸šåŠ¡è‡ªå®šä¹‰çº¿ç¨‹ï¼Œ
é¿å…Dubboçº¿ç¨‹æ± çš„è¿‡åº¦å ç”¨ï¼Œæœ‰åŠ©äºé¿å…ä¸åŒæœåŠ¡é—´çš„äº’ç›¸å½±å“ã€‚å¼‚æ­¥æ‰§è¡Œæ— å¼‚äºèŠ‚çœèµ„æºæˆ–æå‡RPCå“åº”æ€§èƒ½ã€‚&lt;/p>
&lt;p>&lt;em>&lt;font color='#FF7D00' size=4 > æ³¨æ„ &lt;/font>&lt;/em>&lt;/p>
&lt;blockquote>
&lt;p>Provider ç«¯å¼‚æ­¥æ‰§è¡Œå’Œ Consumer ç«¯å¼‚æ­¥è°ƒç”¨æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä½ å¯ä»¥ä»»æ„æ­£äº¤ç»„åˆä¸¤ç«¯é…ç½®&lt;/p>
&lt;ul>
&lt;li>ConsumeråŒæ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>ConsumeråŒæ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;ul>
&lt;li>å¯¹äºProviderç«¯æ¥è¯´ï¼Œå¦‚æœæ¥å£æ¯”è¾ƒè€—æ—¶ï¼Œé¿å…dubboçº¿ç¨‹è¢«é˜»å¡ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥å°†çº¿ç¨‹åˆ‡æ¢åˆ°ä¸šåŠ¡çº¿ç¨‹ã€‚&lt;/li>
&lt;li>å¯¹äºConsumerç«¯æ¥è¯´ï¼Œè°ƒç”¨Dubboæ¥å£æ²¡æœ‰ä¸¥æ ¼æ—¶åºä¸Šçš„å…³ç³»ã€ä¸æ˜¯åŸå­æ“ä½œã€ä¸å½±å“é€»è¾‘æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨å¼‚æ­¥è°ƒç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="providerå¼‚æ­¥">Providerå¼‚æ­¥&lt;/h2>
&lt;h3 id="1ä½¿ç”¨completablefutureå®ç°å¼‚æ­¥">1ã€ä½¿ç”¨CompletableFutureå®ç°å¼‚æ­¥&lt;/h3>
&lt;p>æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> * åŒæ­¥è°ƒç”¨æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">invoke&lt;/span>(String param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> * å¼‚æ­¥è°ƒç”¨æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">asyncInvoke&lt;/span>(String param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboService&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">invoke&lt;/span>(String param) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">long&lt;/span> time &lt;span style="color:#719e07">=&lt;/span> ThreadLocalRandom.current().nextLong(1000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(time);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StringBuilder s &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> StringBuilder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s.append(&lt;span style="color:#2aa198">&amp;#34;AsyncService invoke param:&amp;#34;&lt;/span>).append(param).append(&lt;span style="color:#2aa198">&amp;#34;,sleep:&amp;#34;&lt;/span>).append(time);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> s.toString();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.currentThread().interrupt();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">asyncInvoke&lt;/span>(String param) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å»ºè®®ä¸ºsupplyAsyncæä¾›è‡ªå®šä¹‰çº¿ç¨‹æ± &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> CompletableFuture.supplyAsync(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// Do something&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">long&lt;/span> time &lt;span style="color:#719e07">=&lt;/span> ThreadLocalRandom.current().nextLong(1000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(time);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StringBuilder s &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> StringBuilder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s.append(&lt;span style="color:#2aa198">&amp;#34;AsyncService asyncInvoke param:&amp;#34;&lt;/span>).append(param).append(&lt;span style="color:#2aa198">&amp;#34;,sleep:&amp;#34;&lt;/span>).append(time);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> s.toString();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.currentThread().interrupt();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ return CompletableFuture.supplyAsync() ï¼Œä¸šåŠ¡æ‰§è¡Œå·²ä» Dubbo çº¿ç¨‹åˆ‡æ¢åˆ°ä¸šåŠ¡çº¿ç¨‹ï¼Œé¿å…äº†å¯¹ Dubbo çº¿ç¨‹æ± çš„é˜»å¡ã€‚&lt;/p>
&lt;h3 id="2ä½¿ç”¨asynccontextå®ç°å¼‚æ­¥">2ã€ä½¿ç”¨AsyncContextå®ç°å¼‚æ­¥&lt;/h3>
&lt;p>Dubbo æä¾›äº†ä¸€ä¸ªç±»ä¼¼ Servlet 3.0 çš„å¼‚æ­¥æ¥å£AsyncContextï¼Œåœ¨æ²¡æœ‰ CompletableFuture ç­¾åæ¥å£çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å®ç° Provider ç«¯çš„å¼‚æ­¥æ‰§è¡Œã€‚&lt;/p>
&lt;p>æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">final&lt;/span> AsyncContext asyncContext &lt;span style="color:#719e07">=&lt;/span> RpcContext.startAsync();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> Thread(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å¦‚æœè¦ä½¿ç”¨ä¸Šä¸‹æ–‡ï¼Œåˆ™å¿…é¡»è¦æ”¾åœ¨ç¬¬ä¸€å¥æ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.signalContextSwitch();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(500);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å†™å›å“åº”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.write(&lt;span style="color:#2aa198">&amp;#34;Hello &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name &lt;span style="color:#719e07">+&lt;/span> &lt;span style="color:#2aa198">&amp;#34;, response from provider.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="consumerå¼‚æ­¥">Consumerå¼‚æ­¥&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboReference&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">private&lt;/span> AsyncService asyncService;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">run&lt;/span>(String... args) &lt;span style="color:#268bd2">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//è°ƒç”¨å¼‚æ­¥æ¥å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future1 &lt;span style="color:#719e07">=&lt;/span> asyncService.asyncInvoke(&lt;span style="color:#2aa198">&amp;#34;async call request1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future1.whenComplete((v, t) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (t &lt;span style="color:#719e07">!=&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;AsyncTask Response-1: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//ä¸¤æ¬¡è°ƒç”¨å¹¶éé¡ºåºè¿”å›&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future2 &lt;span style="color:#719e07">=&lt;/span> asyncService.asyncInvoke(&lt;span style="color:#2aa198">&amp;#34;async call request2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future2.whenComplete((v, t) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (t &lt;span style="color:#719e07">!=&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;AsyncTask Response-2: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//consumerå¼‚æ­¥è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future3 &lt;span style="color:#719e07">=&lt;/span> CompletableFuture.supplyAsync(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> asyncService.invoke(&lt;span style="color:#2aa198">&amp;#34;invoke call request3&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future3.whenComplete((v, t) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (t &lt;span style="color:#719e07">!=&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;AsyncTask Response-3: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;AsyncTask Executed before response return.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç‰¹æ€§è¯´æ˜">ç‰¹æ€§è¯´æ˜&lt;/h2>
&lt;h4 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h4>
&lt;p>ä» 2.7.0 å¼€å§‹ï¼ŒDubbo çš„æ‰€æœ‰å¼‚æ­¥ç¼–ç¨‹æ¥å£å¼€å§‹ä»¥ &lt;a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture&lt;/a> ä¸ºåŸºç¡€&lt;/p>
&lt;p>åŸºäº NIO çš„éé˜»å¡å®ç°å¹¶è¡Œè°ƒç”¨ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å¯åŠ¨å¤šçº¿ç¨‹å³å¯å®Œæˆå¹¶è¡Œè°ƒç”¨å¤šä¸ªè¿œç¨‹æœåŠ¡ï¼Œç›¸å¯¹å¤šçº¿ç¨‹å¼€é”€è¾ƒå°ã€‚&lt;/p>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/user/future.jpg" alt="/user-guide/images/future.jpg">&lt;/p>
&lt;h2 id="ä½¿ç”¨åœºæ™¯-1">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>å°†ç”¨æˆ·è¯·æ±‚å†…å®¹å‘é€åˆ°ç›®æ ‡è¯·æ±‚ï¼Œå½“ç›®æ ‡è¯·æ±‚é‡åˆ°é«˜æµé‡æˆ–éœ€è¦é•¿æ—¶é—´å¤„ç†ï¼Œå¼‚æ­¥è°ƒç”¨åŠŸèƒ½å°†å…è®¸ç«‹å³å‘ç”¨æˆ·è¿”å›å“åº”ï¼ŒåŒæ—¶ç›®æ ‡è¯·æ±‚ç»§ç»­åå°å¤„ç†è¯·æ±‚ï¼Œå½“ç›®æ ‡è¯·æ±‚è¿”å›ç»“æœæ—¶ï¼Œå°†å†…å®¹æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å‚è€ƒç”¨ä¾‹
&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-async">https://github.com/apache/dubbo-samples/tree/master/dubbo-samples-async&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;h3 id="ä½¿ç”¨-completablefuture-ç­¾åçš„æ¥å£">ä½¿ç”¨ CompletableFuture ç­¾åçš„æ¥å£&lt;/h3>
&lt;p>éœ€è¦æœåŠ¡æä¾›è€…äº‹å…ˆå®šä¹‰ CompletableFuture ç­¾åçš„æœåŠ¡ï¼Œæ¥å£å®šä¹‰æŒ‡å—å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>Providerç«¯å¼‚æ­¥æ‰§è¡Œå°†é˜»å¡çš„ä¸šåŠ¡ä»Dubboå†…éƒ¨çº¿ç¨‹æ± åˆ‡æ¢åˆ°ä¸šåŠ¡è‡ªå®šä¹‰çº¿ç¨‹ï¼Œé¿å…Dubboçº¿ç¨‹æ± çš„è¿‡åº¦å ç”¨ï¼Œæœ‰åŠ©äºé¿å…ä¸åŒæœåŠ¡é—´çš„äº’ç›¸å½±å“ã€‚å¼‚æ­¥æ‰§è¡Œæ— å¼‚äºèŠ‚çœèµ„æºæˆ–æå‡RPCå“åº”æ€§èƒ½ï¼Œå› ä¸ºå¦‚æœä¸šåŠ¡æ‰§è¡Œéœ€è¦é˜»å¡ï¼Œåˆ™å§‹ç»ˆè¿˜æ˜¯è¦æœ‰çº¿ç¨‹æ¥è´Ÿè´£æ‰§è¡Œã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Provider ç«¯å¼‚æ­¥æ‰§è¡Œå’Œ Consumer ç«¯å¼‚æ­¥è°ƒç”¨æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä»»æ„æ­£äº¤ç»„åˆä¸¤ç«¯é…ç½®&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ConsumeråŒæ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>ConsumeråŒæ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h3 id="å®šä¹‰-completablefuture-ç­¾åçš„æ¥å£">å®šä¹‰ CompletableFuture ç­¾åçš„æ¥å£&lt;/h3>
&lt;p>æœåŠ¡æ¥å£å®šä¹‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> CompletableFuture.supplyAsync(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(5000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#2aa198">&amp;#34;async response from provider.&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ &lt;code>return CompletableFuture.supplyAsync() &lt;/code>ï¼Œä¸šåŠ¡æ‰§è¡Œå·²ä» Dubbo çº¿ç¨‹åˆ‡æ¢åˆ°ä¸šåŠ¡çº¿ç¨‹ï¼Œé¿å…äº†å¯¹ Dubbo çº¿ç¨‹æ± çš„é˜»å¡ã€‚&lt;/p>
&lt;p>æ³¨æ„æ¥å£çš„è¿”å›ç±»å‹æ˜¯ &lt;code>CompletableFuture&amp;lt;String&amp;gt;&lt;/code>ã€‚&lt;/p>
&lt;p>XML å¼•ç”¨æœåŠ¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span> timeout=&lt;span style="color:#2aa198">&amp;#34;10000&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.alibaba.dubbo.samples.async.api.AsyncService&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è°ƒç”¨è¿œç¨‹æœåŠ¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// è°ƒç”¨ç›´æ¥è¿”å›CompletableFuture&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future &lt;span style="color:#719e07">=&lt;/span> asyncService.sayHello(&lt;span style="color:#2aa198">&amp;#34;async call request&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// å¢åŠ å›è°ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>future.whenComplete((v, t) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (t &lt;span style="color:#719e07">!=&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;Response: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// æ—©äºç»“æœè¾“å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>System.out.println(&lt;span style="color:#2aa198">&amp;#34;Executed before response return.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä½¿ç”¨-asynccontext">ä½¿ç”¨ AsyncContext&lt;/h3>
&lt;p>Dubbo æä¾›äº†ä¸€ä¸ªç±»ä¼¼ Servlet 3.0 çš„å¼‚æ­¥æ¥å£&lt;code>AsyncContext&lt;/code>ï¼Œåœ¨æ²¡æœ‰ CompletableFuture ç­¾åæ¥å£çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å®ç° Provider ç«¯çš„å¼‚æ­¥æ‰§è¡Œã€‚&lt;/p>
&lt;p>æœåŠ¡æ¥å£å®šä¹‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡æš´éœ²ï¼Œå’Œæ™®é€šæœåŠ¡å®Œå…¨ä¸€è‡´&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;bean&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span> class=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.impl.AsyncServiceImpl&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.api.AsyncService&amp;#34;&lt;/span> ref=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">final&lt;/span> AsyncContext asyncContext &lt;span style="color:#719e07">=&lt;/span> RpcContext.startAsync();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> Thread(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å¦‚æœè¦ä½¿ç”¨ä¸Šä¸‹æ–‡ï¼Œåˆ™å¿…é¡»è¦æ”¾åœ¨ç¬¬ä¸€å¥æ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.signalContextSwitch();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(500);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å†™å›å“åº”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.write(&lt;span style="color:#2aa198">&amp;#34;Hello &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name &lt;span style="color:#719e07">+&lt;/span> &lt;span style="color:#2aa198">&amp;#34;, response from provider.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä½¿ç”¨-rpccontext-å®ç°æ¶ˆè´¹ç«¯å¼‚æ­¥è°ƒç”¨">ä½¿ç”¨ RpcContext å®ç°æ¶ˆè´¹ç«¯å¼‚æ­¥è°ƒç”¨&lt;/h3>
&lt;p>åœ¨ consumer.xml ä¸­é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.api.AsyncService&amp;#34;&lt;/span>&lt;span style="color:#268bd2">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:method&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;sayHello&amp;#34;&lt;/span> async=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;/dubbo:reference&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è°ƒç”¨ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// æ­¤è°ƒç”¨ä¼šç«‹å³è¿”å›null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>asyncService.sayHello(&lt;span style="color:#2aa198">&amp;#34;world&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// æ‹¿åˆ°è°ƒç”¨çš„Futureå¼•ç”¨ï¼Œå½“ç»“æœè¿”å›åï¼Œä¼šè¢«é€šçŸ¥å’Œè®¾ç½®åˆ°æ­¤Future&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> helloFuture &lt;span style="color:#719e07">=&lt;/span> RpcContext.getServiceContext().getCompletableFuture();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// ä¸ºFutureæ·»åŠ å›è°ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>helloFuture.whenComplete((retValue, exception) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (exception &lt;span style="color:#719e07">==&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(retValue);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exception.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…ï¼Œä¹Ÿå¯ä»¥è¿™æ ·åšå¼‚æ­¥è°ƒç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future &lt;span style="color:#719e07">=&lt;/span> RpcContext.getServiceContext().asyncCall(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> () &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncService.sayHello(&lt;span style="color:#2aa198">&amp;#34;oneway call request1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>future.get();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>å¼‚æ­¥æ€»æ˜¯ä¸ç­‰å¾…è¿”å›&lt;/strong>ï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®æ˜¯å¦ç­‰å¾…æ¶ˆæ¯å‘å‡º&lt;/p>
&lt;ul>
&lt;li>&lt;code>sent=&amp;quot;true&amp;quot;&lt;/code> ç­‰å¾…æ¶ˆæ¯å‘å‡ºï¼Œæ¶ˆæ¯å‘é€å¤±è´¥å°†æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/li>
&lt;li>&lt;code>sent=&amp;quot;false&amp;quot;&lt;/code> ä¸ç­‰å¾…æ¶ˆæ¯å‘å‡ºï¼Œå°†æ¶ˆæ¯æ”¾å…¥ IO é˜Ÿåˆ—ï¼Œå³åˆ»è¿”å›ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:method&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;findFoo&amp;#34;&lt;/span> async=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> sent=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœä½ åªæ˜¯æƒ³å¼‚æ­¥ï¼Œå®Œå…¨å¿½ç•¥è¿”å›å€¼ï¼Œå¯ä»¥é…ç½® &lt;code>return=&amp;quot;false&amp;quot;&lt;/code>ï¼Œä»¥å‡å°‘ Future å¯¹è±¡çš„åˆ›å»ºå’Œç®¡ç†æˆæœ¬&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:method&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;findFoo&amp;#34;&lt;/span> async=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> return=&lt;span style="color:#2aa198">&amp;#34;false&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;div class="pageinfo pageinfo-primary">
&lt;p>æ­¤æ–‡æ¡£å·²ç»ä¸å†ç»´æŠ¤ã€‚æ‚¨å½“å‰æŸ¥çœ‹çš„æ˜¯å¿«ç…§ç‰ˆæœ¬ã€‚å¦‚æœæƒ³è¦æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬çš„æ–‡æ¡£ï¼Œè¯·å‚é˜…&lt;a href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/advanced-features-and-usage/service/attachment/">æœ€æ–°ç‰ˆæœ¬&lt;/a>ã€‚&lt;/p>
&lt;/div>
&lt;p>Providerç«¯å¼‚æ­¥æ‰§è¡Œå°†é˜»å¡çš„ä¸šåŠ¡ä»Dubboå†…éƒ¨çº¿ç¨‹æ± åˆ‡æ¢åˆ°ä¸šåŠ¡è‡ªå®šä¹‰çº¿ç¨‹ï¼Œé¿å…Dubboçº¿ç¨‹æ± çš„è¿‡åº¦å ç”¨ï¼Œæœ‰åŠ©äºé¿å…ä¸åŒæœåŠ¡é—´çš„äº’ç›¸å½±å“ã€‚å¼‚æ­¥æ‰§è¡Œæ— å¼‚äºèŠ‚çœèµ„æºæˆ–æå‡RPCå“åº”æ€§èƒ½ï¼Œå› ä¸ºå¦‚æœä¸šåŠ¡æ‰§è¡Œéœ€è¦é˜»å¡ï¼Œåˆ™å§‹ç»ˆè¿˜æ˜¯è¦æœ‰çº¿ç¨‹æ¥è´Ÿè´£æ‰§è¡Œã€‚&lt;/p>
&lt;div class="alert alert-warning" role="alert">
&lt;h4 class="alert-heading">æ³¨æ„&lt;/h4>
&lt;p>Provider ç«¯å¼‚æ­¥æ‰§è¡Œå’Œ Consumer ç«¯å¼‚æ­¥è°ƒç”¨æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä½ å¯ä»¥ä»»æ„æ­£äº¤ç»„åˆä¸¤ç«¯é…ç½®&lt;/p>
&lt;ul>
&lt;li>ConsumeråŒæ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - ProvideråŒæ­¥&lt;/li>
&lt;li>ConsumeråŒæ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;li>Consumerå¼‚æ­¥ - Providerå¼‚æ­¥&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h2 id="å®šä¹‰-completablefuture-ç­¾åçš„æ¥å£-1">å®šä¹‰ CompletableFuture ç­¾åçš„æ¥å£&lt;/h2>
&lt;p>æœåŠ¡æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RpcContext savedContext &lt;span style="color:#719e07">=&lt;/span> RpcContext.getContext();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å»ºè®®ä¸ºsupplyAsyncæä¾›è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œé¿å…ä½¿ç”¨JDKå…¬ç”¨çº¿ç¨‹æ± &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> CompletableFuture.supplyAsync(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(savedContext.getAttachment(&lt;span style="color:#2aa198">&amp;#34;consumer-key1&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(5000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#2aa198">&amp;#34;async response from provider.&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ &lt;code>return CompletableFuture.supplyAsync() &lt;/code>ï¼Œä¸šåŠ¡æ‰§è¡Œå·²ä» Dubbo çº¿ç¨‹åˆ‡æ¢åˆ°ä¸šåŠ¡çº¿ç¨‹ï¼Œé¿å…äº†å¯¹ Dubbo çº¿ç¨‹æ± çš„é˜»å¡ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨asynccontext">ä½¿ç”¨AsyncContext&lt;/h2>
&lt;p>Dubbo æä¾›äº†ä¸€ä¸ªç±»ä¼¼ Servlet 3.0 çš„å¼‚æ­¥æ¥å£&lt;code>AsyncContext&lt;/code>ï¼Œåœ¨æ²¡æœ‰ CompletableFuture ç­¾åæ¥å£çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å®ç° Provider ç«¯çš„å¼‚æ­¥æ‰§è¡Œã€‚&lt;/p>
&lt;p>æœåŠ¡æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">AsyncService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡æš´éœ²ï¼Œå’Œæ™®é€šæœåŠ¡å®Œå…¨ä¸€è‡´ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;bean&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span> class=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.impl.AsyncServiceImpl&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.governance.api.AsyncService&amp;#34;&lt;/span> ref=&lt;span style="color:#2aa198">&amp;#34;asyncService&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">AsyncServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> AsyncService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">final&lt;/span> AsyncContext asyncContext &lt;span style="color:#719e07">=&lt;/span> RpcContext.startAsync();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> Thread(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å¦‚æœè¦ä½¿ç”¨ä¸Šä¸‹æ–‡ï¼Œåˆ™å¿…é¡»è¦æ”¾åœ¨ç¬¬ä¸€å¥æ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.signalContextSwitch();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(500);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// å†™å›å“åº”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> asyncContext.write(&lt;span style="color:#2aa198">&amp;#34;Hello &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name &lt;span style="color:#719e07">+&lt;/span> &lt;span style="color:#2aa198">&amp;#34;, response from provider.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#cb4b16">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Overview: ç‰ˆæœ¬ä¸åˆ†ç»„</title><link>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/version_group/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/version_group/</guid><description>
&lt;h2 id="ç‰ˆæœ¬ä¸åˆ†ç»„">ç‰ˆæœ¬ä¸åˆ†ç»„&lt;/h2>
&lt;p>DubboæœåŠ¡ä¸­ï¼Œæ¥å£å¹¶ä¸èƒ½å”¯ä¸€ç¡®å®šä¸€ä¸ªæœåŠ¡ï¼Œåªæœ‰æ¥å£+åˆ†ç»„+ç‰ˆæœ¬å·æ‰èƒ½å”¯ä¸€ç¡®å®šä¸€ä¸ªæœåŠ¡ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;ul>
&lt;li>å½“åŒä¸€ä¸ªæ¥å£é’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ã€ä¸åŒçš„ä½¿ç”¨éœ€æ±‚æˆ–è€…ä¸åŒçš„åŠŸèƒ½æ¨¡å—ç­‰åœºæ™¯ï¼Œå¯ä½¿ç”¨æœåŠ¡åˆ†ç»„æ¥åŒºåˆ†ä¸åŒçš„å®ç°æ–¹å¼ã€‚åŒæ—¶ï¼Œè¿™äº›ä¸åŒå®ç°æ‰€æä¾›çš„æœåŠ¡æ˜¯å¯å¹¶å­˜çš„ï¼Œä¹Ÿæ”¯æŒäº’ç›¸è°ƒç”¨ã€‚&lt;/li>
&lt;li>å½“æ¥å£å®ç°éœ€è¦å‡çº§åˆè¦ä¿ç•™åŸæœ‰å®ç°çš„æƒ…å†µä¸‹ï¼Œå³å‡ºç°ä¸å…¼å®¹å‡çº§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åŒç‰ˆæœ¬å·è¿›è¡ŒåŒºåˆ†ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;p>ä½¿ç”¨ @DubboService æ³¨è§£ï¼Œæ·»åŠ  group å‚æ•°å’Œ version å‚æ•°
æœ¬ç¤ºä¾‹ä¸­ä½¿ç”¨&amp;quot;å‘å¸ƒå’Œè°ƒç”¨&amp;quot; ä¸­ç¤ºä¾‹ä»£ç &lt;/p>
&lt;p>æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">DevelopService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">invoke&lt;/span>(String param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥å£å®ç°1ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboService&lt;/span>(group &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;group1&amp;#34;&lt;/span>,version &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;1.0&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">DevelopProviderServiceV1&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> DevelopService{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">invoke&lt;/span>(String param) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StringBuilder s &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> StringBuilder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s.append(&lt;span style="color:#2aa198">&amp;#34;ServiceV1 param:&amp;#34;&lt;/span>).append(param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> s.toString();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥å£å®ç°2ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboService&lt;/span>(group &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;group2&amp;#34;&lt;/span>,version &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;2.0&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">DevelopProviderServiceV2&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> DevelopService{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">invoke&lt;/span>(String param) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StringBuilder s &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> StringBuilder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s.append(&lt;span style="color:#2aa198">&amp;#34;ServiceV2 param:&amp;#34;&lt;/span>).append(param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> s.toString();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯åŠ¨æœåŠ¡åï¼Œå¯ä»¥åœ¨æ³¨å†Œä¸­å¿ƒçœ‹åˆ°å¯¹åº”çš„æœåŠ¡åˆ—è¡¨ï¼Œå¦‚ä¸‹ï¼š
&lt;code>![serviceList](/imgs/v3/develop/develop-service-list.png)&lt;/code>&lt;/p>
&lt;p>å®¢æˆ·ç«¯æ¥å£è°ƒç”¨ï¼š&lt;/p>
&lt;blockquote>
&lt;p>ä½¿ç”¨ @DubboReference æ³¨è§£ï¼Œæ·»åŠ  group å‚æ•°å’Œ version å‚æ•°&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboReference&lt;/span>(group &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;group1&amp;#34;&lt;/span>,version &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;1.0&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">private&lt;/span> DevelopService developService;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboReference&lt;/span>(group &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;group2&amp;#34;&lt;/span>,version &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;2.0&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">private&lt;/span> DevelopService developServiceV2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">run&lt;/span>(String... args) &lt;span style="color:#268bd2">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//è°ƒç”¨DevelopServiceçš„group1åˆ†ç»„å®ç°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;Dubbo Remote Return ======&amp;gt; &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> developService.invoke(&lt;span style="color:#2aa198">&amp;#34;1&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//è°ƒç”¨DevelopServiceçš„å¦ä¸€ä¸ªå®ç°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;Dubbo Remote Return ======&amp;gt; &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> developServiceV2.invoke(&lt;span style="color:#2aa198">&amp;#34;2&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç‰¹æ€§è¯´æ˜">ç‰¹æ€§è¯´æ˜&lt;/h2>
&lt;p>åŒä¸€ä¸ªæ¥å£é’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ã€ä¸åŒçš„ä½¿ç”¨éœ€æ±‚æˆ–è€…ä¸åŒçš„åŠŸèƒ½æ¨¡å—ç­‰åœºæ™¯ï¼Œå¯ä½¿ç”¨æœåŠ¡åˆ†ç»„æ¥åŒºåˆ†ä¸åŒçš„å®ç°æ–¹å¼ã€‚åŒæ—¶ï¼Œè¿™äº›ä¸åŒå®ç°æ‰€æä¾›çš„æœåŠ¡æ˜¯å¯å¹¶å­˜çš„ï¼Œä¹Ÿæ”¯æŒäº’ç›¸è°ƒç”¨ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨åœºæ™¯-1">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>å½“ä¸€ä¸ªæ¥å£æœ‰å¤šç§å®ç°æ—¶ï¼Œå¯ä»¥ç”¨ group åŒºåˆ†ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å‚è€ƒç”¨ä¾‹
&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-group">https://github.com/apache/dubbo-samples/tree/master/dubbo-samples-group&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä½¿ç”¨æ–¹å¼-1">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;h3 id="æ³¨è§£é…ç½®">æ³¨è§£é…ç½®&lt;/h3>
&lt;h4 id="æœåŠ¡æä¾›ç«¯æ³¨è§£é…ç½®">æœåŠ¡æä¾›ç«¯(æ³¨è§£é…ç½®)&lt;/h4>
&lt;p>ä½¿ç”¨ @DubboService æ³¨è§£ï¼Œæ·»åŠ  group å‚æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboService&lt;/span>(group &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;demo&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">DemoServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> DemoService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboService&lt;/span>(group &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;demo2&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">Demo2ServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> DemoService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯åŠ¨ Dubbo æœåŠ¡ï¼Œå¯åœ¨æ³¨å†Œä¸­å¿ƒçœ‹åˆ°ç›¸åŒæœåŠ¡åä¸åŒåˆ†ç»„çš„æœåŠ¡ï¼Œä»¥ Nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒä¸ºä¾‹ï¼Œæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/blog/service-group-1.png" alt="image-service-group-1.png">&lt;/p>
&lt;h4 id="æœåŠ¡æ¶ˆè´¹ç«¯æ³¨è§£é…ç½®">æœåŠ¡æ¶ˆè´¹ç«¯(æ³¨è§£é…ç½®)&lt;/h4>
&lt;p>ä½¿ç”¨ @DubboReference æ³¨è§£ï¼Œæ·»åŠ  group å‚æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboReference&lt;/span>(group &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;demo&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">private&lt;/span> DemoService demoService;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboReference&lt;/span>(group &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;demo2&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">private&lt;/span> DemoService demoService2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">//groupå€¼ä¸º*ï¼Œæ ‡è¯†åŒ¹é…ä»»æ„æœåŠ¡åˆ†ç»„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboReference&lt;/span>(group &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;*&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">private&lt;/span> DemoService demoService2;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŒæ ·å¯åŠ¨ Dubbo æœåŠ¡åï¼Œå¯åœ¨æ³¨å†Œä¸­å¿ƒçœ‹åˆ°ç›¸åŒæœåŠ¡åä¸åŒåˆ†ç»„çš„å¼•ç”¨è€…ï¼Œä»¥ Nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒä¸ºä¾‹ï¼Œæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹ï¼š
&lt;img src="https://dubbo.apache.org/imgs/blog/service-group-2.png" alt="image-service-group-2.png">&lt;/p>
&lt;h3 id="xmlé…ç½®">xmlé…ç½®&lt;/h3>
&lt;h4 id="æœåŠ¡æä¾›ç«¯-xml-é…ç½®">æœåŠ¡æä¾›ç«¯( xml é…ç½®)&lt;/h4>
&lt;p>ä½¿ç”¨ &amp;lt;dubbo:service /&amp;gt; æ ‡ç­¾ï¼Œæ·»åŠ  group å‚æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#719e07">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;beans&lt;/span> xmlns=&lt;span style="color:#2aa198">&amp;#34;http://www.springframework.org/schema/beans&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xmlns:xsi=&lt;span style="color:#2aa198">&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xmlns:dubbo=&lt;span style="color:#2aa198">&amp;#34;http://dubbo.apache.org/schema/dubbo&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xsi:schemaLocation=&lt;span style="color:#2aa198">&amp;#34;http://www.springframework.org/schema/beans
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#2aa198"> http://www.springframework.org/schema/beans/spring-beans-4.3.xsd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#2aa198"> http://dubbo.apache.org/schema/dubbo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#2aa198"> http://dubbo.apache.org/schema/dubbo/dubbo.xsd&amp;#34;&lt;/span>&lt;span style="color:#268bd2">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.example.service.DemoService&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;demo&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.example.service.DemoService&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;demo2&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;/beans&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯åŠ¨ Dubbo æœåŠ¡ï¼Œå¯åœ¨æ³¨å†Œä¸­å¿ƒçœ‹åˆ°ç›¸åŒæœåŠ¡åä¸åŒåˆ†ç»„çš„æœåŠ¡ï¼Œä»¥ Nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒä¸ºä¾‹ï¼Œæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/blog/service-group-1.png" alt="image-service-group-1.png">&lt;/p>
&lt;h4 id="æœåŠ¡æ¶ˆè´¹ç«¯-xml-é…ç½®">æœåŠ¡æ¶ˆè´¹ç«¯( xml é…ç½®)&lt;/h4>
&lt;p>ä½¿ç”¨ &lt;a href="dubbo:reference/">dubbo:reference/&lt;/a> æ³¨è§£ï¼Œæ·»åŠ  group å‚æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#719e07">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;beans&lt;/span> xmlns=&lt;span style="color:#2aa198">&amp;#34;http://www.springframework.org/schema/beans&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xmlns:xsi=&lt;span style="color:#2aa198">&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xmlns:dubbo=&lt;span style="color:#2aa198">&amp;#34;http://dubbo.apache.org/schema/dubbo&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xsi:schemaLocation=&lt;span style="color:#2aa198">&amp;#34;http://www.springframework.org/schema/beans
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#2aa198"> http://www.springframework.org/schema/beans/spring-beans-4.3.xsd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#2aa198"> http://dubbo.apache.org/schema/dubbo
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#2aa198"> http://dubbo.apache.org/schema/dubbo/dubbo.xsd&amp;#34;&lt;/span>&lt;span style="color:#268bd2">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">&amp;lt;!-- å¼•ç”¨æœåŠ¡æ¥å£ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;demoService&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.example.service.DemoService&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;demo&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;demoService2&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.example.service.DemoService&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;demo2&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">&amp;lt;!-- groupå€¼ä¸º*ï¼Œæ ‡è¯†åŒ¹é…ä»»æ„æœåŠ¡åˆ†ç»„ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;demoService3&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.example.service.DemoService&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;*&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;/beans&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŒæ ·å¯åŠ¨ Dubbo æœåŠ¡åï¼Œå¯åœ¨æ³¨å†Œä¸­å¿ƒçœ‹åˆ°ç›¸åŒæœåŠ¡åä¸åŒåˆ†ç»„çš„å¼•ç”¨è€…ï¼Œä»¥ Nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒä¸ºä¾‹ï¼Œæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/blog/service-group-2.png" alt="image-service-group-2.png">&lt;/p>
&lt;h3 id="apié…ç½®">APIé…ç½®&lt;/h3>
&lt;h4 id="æœåŠ¡æä¾›ç«¯-api-é…ç½®">æœåŠ¡æä¾›ç«¯( API é…ç½®)&lt;/h4>
&lt;p>ä½¿ç”¨ org.apache.dubbo.config.ServiceConfig ç±»ï¼Œæ·»åŠ  group å‚æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// ServiceConfigä¸ºé‡å¯¹è±¡ï¼Œå†…éƒ¨å°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ï¼Œä»¥åŠå¼€å¯æœåŠ¡ç«¯å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// è¯·è‡ªè¡Œç¼“å­˜ï¼Œå¦åˆ™å¯èƒ½é€ æˆå†…å­˜å’Œè¿æ¥æ³„æ¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ServiceConfig&lt;span style="color:#719e07">&amp;lt;&lt;/span>DemoService&lt;span style="color:#719e07">&amp;gt;&lt;/span> service &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ServiceConfig&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service.setInterface(DemoService.class);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service.setGroup(&lt;span style="color:#2aa198">&amp;#34;demo&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ServiceConfig&lt;span style="color:#719e07">&amp;lt;&lt;/span>DemoService&lt;span style="color:#719e07">&amp;gt;&lt;/span> service2 &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ServiceConfig&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service.setInterface(DemoService.class);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service.setGroup(&lt;span style="color:#2aa198">&amp;#34;demo2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯åŠ¨ Dubbo æœåŠ¡ï¼Œå¯åœ¨æ³¨å†Œä¸­å¿ƒçœ‹åˆ°ç›¸åŒæœåŠ¡åä¸åŒåˆ†ç»„çš„æœåŠ¡ï¼Œä»¥ Nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒä¸ºä¾‹ï¼Œæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/blog/service-group-1.png" alt="image-service-group-1.png">&lt;/p>
&lt;h4 id="æœåŠ¡æ¶ˆè´¹ç«¯-api-é…ç½®">æœåŠ¡æ¶ˆè´¹ç«¯( API é…ç½®)&lt;/h4>
&lt;p>ä½¿ç”¨ org.apache.dubbo.config.ReferenceConfigï¼Œæ·»åŠ  group å‚æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// ReferenceConfigä¸ºé‡å¯¹è±¡ï¼Œå†…éƒ¨å°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ï¼Œä»¥åŠå¼€å¯æœåŠ¡ç«¯å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// è¯·è‡ªè¡Œç¼“å­˜ï¼Œå¦åˆ™å¯èƒ½é€ æˆå†…å­˜å’Œè¿æ¥æ³„æ¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ReferenceConfig&lt;span style="color:#719e07">&amp;lt;&lt;/span>DemoService&lt;span style="color:#719e07">&amp;gt;&lt;/span> reference &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ReferenceConfig&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reference.setInterface(DemoService.class);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reference.setGroup(&lt;span style="color:#2aa198">&amp;#34;demo&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ReferenceConfig&lt;span style="color:#719e07">&amp;lt;&lt;/span>DemoService&lt;span style="color:#719e07">&amp;gt;&lt;/span> reference2 &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ReferenceConfig&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reference2.setInterface(DemoService.class);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reference2.setGroup(&lt;span style="color:#2aa198">&amp;#34;demo2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ReferenceConfig&lt;span style="color:#719e07">&amp;lt;&lt;/span>DemoService&lt;span style="color:#719e07">&amp;gt;&lt;/span> reference3 &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ReferenceConfig&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reference3.setInterface(DemoService.class);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reference3.setGroup(&lt;span style="color:#2aa198">&amp;#34;*&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŒæ ·å¯åŠ¨ Dubbo æœåŠ¡åï¼Œå¯åœ¨æ³¨å†Œä¸­å¿ƒçœ‹åˆ°ç›¸åŒæœåŠ¡åä¸åŒåˆ†ç»„çš„å¼•ç”¨è€…ï¼Œä»¥ Nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒä¸ºä¾‹ï¼Œæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹ï¼š
&lt;img src="https://dubbo.apache.org/imgs/blog/service-group-2.png" alt="image-service-group-2.png">&lt;/p>
&lt;blockquote>
&lt;p>æ€»æ˜¯ &lt;strong>åªè°ƒ&lt;/strong> ä¸€ä¸ªå¯ç”¨ç»„çš„å®ç°&lt;/p>
&lt;/blockquote>
&lt;h2 id="ç‰¹æ€§è¯´æ˜-1">ç‰¹æ€§è¯´æ˜&lt;/h2>
&lt;p>é€šè¿‡åˆ†ç»„å¯¹ç»“æœè¿›è¡Œèšåˆå¹¶è¿”å›èšåˆåçš„ç»“æœï¼Œæ¯”å¦‚èœå•æœåŠ¡ï¼Œç”¨ group åŒºåˆ†åŒä¸€æ¥å£çš„å¤šç§å®ç°ï¼Œç°åœ¨æ¶ˆè´¹æ–¹éœ€ä»æ¯ç§ group ä¸­è°ƒç”¨ä¸€æ¬¡å¹¶è¿”å›ç»“æœï¼Œå¯¹ç»“æœè¿›è¡Œåˆå¹¶ä¹‹åè¿”å›ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°èšåˆèœå•é¡¹ã€‚&lt;/p>
&lt;p>ç›¸å…³ä»£ç å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-merge">dubbo é¡¹ç›®ä¸­çš„ç¤ºä¾‹&lt;/a>&lt;/p>
&lt;h2 id="ä½¿ç”¨åœºæ™¯-2">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>å°†å¤šä¸ªæœåŠ¡æä¾›è€…åˆ†ç»„ä½œä¸ºä¸€ä¸ªæä¾›è€…è¿›è¡Œè®¿é—®ã€‚åº”ç”¨ç¨‹åºèƒ½å¤Ÿåƒè®¿é—®ä¸€ä¸ªæœåŠ¡ä¸€æ ·è®¿é—®å¤šä¸ªæœåŠ¡ï¼Œå¹¶å…è®¸æ›´æœ‰æ•ˆåœ°ä½¿ç”¨èµ„æºã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨æ–¹å¼-2">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;h3 id="æœç´¢æ‰€æœ‰åˆ†ç»„">æœç´¢æ‰€æœ‰åˆ†ç»„&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.xxx.MenuService&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;*&amp;#34;&lt;/span> merger=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åˆå¹¶æŒ‡å®šåˆ†ç»„">åˆå¹¶æŒ‡å®šåˆ†ç»„&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.xxx.MenuService&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;aaa,bbb&amp;#34;&lt;/span> merger=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æŒ‡å®šæ–¹æ³•åˆå¹¶">æŒ‡å®šæ–¹æ³•åˆå¹¶&lt;/h3>
&lt;p>æŒ‡å®šæ–¹æ³•åˆå¹¶ç»“æœï¼Œå…¶å®ƒæœªæŒ‡å®šçš„æ–¹æ³•ï¼Œå°†åªè°ƒç”¨ä¸€ä¸ª Group&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.xxx.MenuService&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;*&amp;#34;&lt;/span>&lt;span style="color:#268bd2">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:method&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;getMenuItems&amp;#34;&lt;/span> merger=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;/dubbo:reference&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æŸä¸ªæ–¹æ³•ä¸åˆå¹¶">æŸä¸ªæ–¹æ³•ä¸åˆå¹¶&lt;/h3>
&lt;p>æŸä¸ªæ–¹æ³•ä¸åˆå¹¶ç»“æœï¼Œå…¶å®ƒéƒ½åˆå¹¶ç»“æœ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.xxx.MenuService&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;*&amp;#34;&lt;/span> merger=&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span>&lt;span style="color:#268bd2">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:method&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;getMenuItems&amp;#34;&lt;/span> merger=&lt;span style="color:#2aa198">&amp;#34;false&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;/dubbo:reference&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æŒ‡å®šåˆå¹¶ç­–ç•¥">æŒ‡å®šåˆå¹¶ç­–ç•¥&lt;/h3>
&lt;p>æŒ‡å®šåˆå¹¶ç­–ç•¥ï¼Œç¼ºçœæ ¹æ®è¿”å›å€¼ç±»å‹è‡ªåŠ¨åŒ¹é…ï¼Œå¦‚æœåŒä¸€ç±»å‹æœ‰ä¸¤ä¸ªåˆå¹¶å™¨æ—¶ï¼Œéœ€æŒ‡å®šåˆå¹¶å™¨çš„åç§° &lt;a href="../../../reference-manual/spi/description/merger">åˆå¹¶ç»“æœæ‰©å±•&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.xxx.MenuService&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;*&amp;#34;&lt;/span>&lt;span style="color:#268bd2">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:method&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;getMenuItems&amp;#34;&lt;/span> merger=&lt;span style="color:#2aa198">&amp;#34;mymerge&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;/dubbo:reference&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æŒ‡å®šåˆå¹¶æ–¹æ³•">æŒ‡å®šåˆå¹¶æ–¹æ³•&lt;/h3>
&lt;p>æŒ‡å®šåˆå¹¶æ–¹æ³•ï¼Œå°†è°ƒç”¨è¿”å›ç»“æœçš„æŒ‡å®šæ–¹æ³•è¿›è¡Œåˆå¹¶ï¼Œåˆå¹¶æ–¹æ³•çš„å‚æ•°ç±»å‹å¿…é¡»æ˜¯è¿”å›ç»“æœç±»å‹æœ¬èº«&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.xxx.MenuService&amp;#34;&lt;/span> group=&lt;span style="color:#2aa198">&amp;#34;*&amp;#34;&lt;/span>&lt;span style="color:#268bd2">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:method&lt;/span> name=&lt;span style="color:#2aa198">&amp;#34;getMenuItems&amp;#34;&lt;/span> merger=&lt;span style="color:#2aa198">&amp;#34;.addAll&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;/dubbo:reference&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">æç¤º&lt;/h4>
&lt;code>2.1.0&lt;/code> å¼€å§‹æ”¯æŒ
&lt;/div>
&lt;h2 id="ç‰¹æ€§è¯´æ˜-2">ç‰¹æ€§è¯´æ˜&lt;/h2>
&lt;p>&lt;strong>æŒ‰ç…§ä»¥ä¸‹çš„æ­¥éª¤è¿›è¡Œç‰ˆæœ¬è¿ç§»&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>åœ¨ä½å‹åŠ›æ—¶é—´æ®µï¼Œå…ˆå‡çº§ä¸€åŠæä¾›è€…ä¸ºæ–°ç‰ˆæœ¬&lt;/li>
&lt;li>å†å°†æ‰€æœ‰æ¶ˆè´¹è€…å‡çº§ä¸ºæ–°ç‰ˆæœ¬&lt;/li>
&lt;li>ç„¶åå°†å‰©ä¸‹çš„ä¸€åŠæä¾›è€…å‡çº§ä¸ºæ–°ç‰ˆæœ¬&lt;/li>
&lt;/ol>
&lt;h4 id="é…ç½®">é…ç½®&lt;/h4>
&lt;ul>
&lt;li>æ–°è€ç‰ˆæœ¬æœåŠ¡æä¾›è€…&lt;/li>
&lt;li>æ–°è€ç‰ˆæœ¬æœåŠ¡æ¶ˆè´¹è€…&lt;/li>
&lt;/ul>
&lt;h2 id="ä½¿ç”¨åœºæ™¯-3">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>å½“ä¸€ä¸ªæ¥å£å®ç°ï¼Œå‡ºç°ä¸å…¼å®¹å‡çº§æ—¶ï¼Œå¯ä»¥ç”¨ç‰ˆæœ¬å·è¿‡æ¸¡ï¼Œç‰ˆæœ¬å·ä¸åŒçš„æœåŠ¡ç›¸äº’é—´ä¸å¼•ç”¨ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å‚è€ƒç”¨ä¾‹
&lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-version">https://github.com/apache/dubbo-samples/tree/master/dubbo-samples-version&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä½¿ç”¨æ–¹å¼-3">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;h3 id="æœåŠ¡æä¾›è€…">æœåŠ¡æä¾›è€…&lt;/h3>
&lt;p>è€ç‰ˆæœ¬æœåŠ¡æä¾›è€…é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.foo.BarService&amp;#34;&lt;/span> version=&lt;span style="color:#2aa198">&amp;#34;1.0.0&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ–°ç‰ˆæœ¬æœåŠ¡æä¾›è€…é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.foo.BarService&amp;#34;&lt;/span> version=&lt;span style="color:#2aa198">&amp;#34;2.0.0&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æœåŠ¡æ¶ˆè´¹è€…">æœåŠ¡æ¶ˆè´¹è€…&lt;/h3>
&lt;p>è€ç‰ˆæœ¬æœåŠ¡æ¶ˆè´¹è€…é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;barService&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.foo.BarService&amp;#34;&lt;/span> version=&lt;span style="color:#2aa198">&amp;#34;1.0.0&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ–°ç‰ˆæœ¬æœåŠ¡æ¶ˆè´¹è€…é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;barService&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.foo.BarService&amp;#34;&lt;/span> version=&lt;span style="color:#2aa198">&amp;#34;2.0.0&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä¸åŒºåˆ†ç‰ˆæœ¬">ä¸åŒºåˆ†ç‰ˆæœ¬&lt;/h3>
&lt;p>å¦‚æœä¸éœ€è¦åŒºåˆ†ç‰ˆæœ¬ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹çš„æ–¹å¼é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;barService&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.foo.BarService&amp;#34;&lt;/span> version=&lt;span style="color:#2aa198">&amp;#34;*&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Overview: è°ƒç”¨é“¾è·¯ä¼ é€’éšå¼å‚æ•°</title><link>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/attachment/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/attachment/</guid><description>
&lt;h2 id="ç‰¹æ€§è¯´æ˜">ç‰¹æ€§è¯´æ˜&lt;/h2>
&lt;p>å¯ä»¥é€šè¿‡ &lt;code>RpcContext&lt;/code> ä¸Šçš„ &lt;code>setAttachment&lt;/code> å’Œ &lt;code>getAttachment&lt;/code> åœ¨æœåŠ¡æ¶ˆè´¹æ–¹å’Œæä¾›æ–¹ä¹‹é—´è¿›è¡Œå‚æ•°çš„éšå¼ä¼ é€’ã€‚&lt;/p>
&lt;h4 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h4>
&lt;p>ä¸Šä¸‹æ–‡ä¿¡æ¯æ˜¯ RPC æ¡†æ¶å¾ˆé‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œä½¿ç”¨ RpcContext å¯ä»¥ä¸ºå•æ¬¡è°ƒç”¨æŒ‡å®šä¸åŒé…ç½®ã€‚å¦‚åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªåœºæ™¯ï¼Œå…¶å®ç°åŸç†å°±æ˜¯åœ¨å…¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ç»´æŠ¤ä¸€ä¸ª traceIdï¼ŒConsumer å’Œ Provider é€šè¿‡ä¼ é€’ traceId æ¥è¿æ¥ä¸€æ¬¡RPCè°ƒç”¨ï¼Œåˆ†åˆ«ä¸ŠæŠ¥æ—¥å¿—åå¯ä»¥åœ¨è¿½è¸ªç³»ç»Ÿä¸­ä¸²è”å¹¶å±•ç¤ºå®Œæ•´çš„è°ƒç”¨æµç¨‹ã€‚è¿™æ ·å¯ä»¥æ›´æ–¹ä¾¿åœ°å‘ç°å¼‚å¸¸ï¼Œå®šä½é—®é¢˜ã€‚
Dubbo ä¸­çš„ RpcContext æ˜¯ä¸€ä¸ª ThreadLocal çš„ä¸´æ—¶çŠ¶æ€è®°å½•å™¨ï¼Œå½“æ¥æ”¶åˆ° RPC è¯·æ±‚ï¼Œæˆ–å‘èµ· RPC è¯·æ±‚æ—¶ï¼ŒRpcContext çš„çŠ¶æ€éƒ½ä¼šå˜åŒ–ã€‚æ¯”å¦‚ï¼š&lt;strong>A è°ƒ Bï¼ŒB è°ƒ Cï¼Œåˆ™ B æœºå™¨ä¸Šï¼Œåœ¨ B è°ƒ C ä¹‹å‰ï¼ŒRpcContext è®°å½•çš„æ˜¯ A å’Œ B çš„ä¿¡æ¯ï¼Œåœ¨ B è°ƒ C ä¹‹åï¼ŒRpcContext è®°å½•çš„æ˜¯ B å’Œ C çš„ä¿¡æ¯ã€‚&lt;/strong>&lt;/p>
&lt;p>åœ¨ Dubbo 3 ä¸­ï¼ŒRpcContext è¢«æ‹†åˆ†ä¸ºå››å¤§æ¨¡å—ï¼ˆServerContextã€ClientAttachmentã€ServerAttachment å’Œ ServiceContextï¼‰ã€‚&lt;/p>
&lt;p>å®ƒä»¬åˆ†åˆ«æ‰¿æ‹…äº†ä¸åŒçš„èŒè´£ï¼š&lt;/p>
&lt;ul>
&lt;li>ServiceContextï¼šåœ¨ Dubbo å†…éƒ¨ä½¿ç”¨ï¼Œç”¨äºä¼ é€’è°ƒç”¨é“¾è·¯ä¸Šçš„å‚æ•°ä¿¡æ¯ï¼Œå¦‚ invoker å¯¹è±¡ç­‰&lt;/li>
&lt;li>ClientAttachmentï¼šåœ¨ Client ç«¯ä½¿ç”¨ï¼Œå¾€ ClientAttachment ä¸­å†™å…¥çš„å‚æ•°å°†è¢«ä¼ é€’åˆ° Server ç«¯&lt;/li>
&lt;li>ServerAttachmentï¼šåœ¨ Server ç«¯ä½¿ç”¨ï¼Œä» ServerAttachment ä¸­è¯»å–çš„å‚æ•°æ˜¯ä» Client ä¸­ä¼ é€’è¿‡æ¥çš„&lt;/li>
&lt;li>ServerContextï¼šåœ¨ Client ç«¯å’Œ Server ç«¯ä½¿ç”¨ï¼Œç”¨äºä» Server ç«¯å›ä¼  Client ç«¯ä½¿ç”¨ï¼ŒServer ç«¯å†™å…¥åˆ° ServerContext çš„å‚æ•°åœ¨è°ƒç”¨ç»“æŸåå¯ä»¥åœ¨ Client ç«¯çš„ ServerContext è·å–åˆ°&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://dubbo.apache.org/imgs/v3/concepts/rpccontext.png" alt="/imgs/v3/concepts/rpccontext.png">&lt;/p>
&lt;p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¶ˆè´¹ç«¯å‘èµ·è°ƒç”¨çš„æ—¶å€™å¯ä»¥ç›´æ¥é€šè¿‡ Method Invoke å‘è¿œç¨‹çš„æœåŠ¡å‘èµ·è°ƒç”¨ï¼ŒåŒæ—¶æ¶ˆè´¹ç«¯å¾€ RpcClientAttachment å†™å…¥çš„æ•°æ®ä¼šè¿åŒ Invoke çš„å‚æ•°ä¿¡æ¯å†™å…¥åˆ° Invocation ä¸­ã€‚
æ¶ˆè´¹ç«¯çš„ Invocation ç»è¿‡åºåˆ—åŒ–åé€šè¿‡ç½‘ç»œä¼ è¾“å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯è§£æ Invocation ç”Ÿæˆ Method Invoke çš„å‚æ•°å’Œ RpcServerAttachmentï¼Œç„¶åå‘èµ·çœŸå®è°ƒç”¨ã€‚
åœ¨æœåŠ¡ç«¯å¤„ç†ç»“æŸä¹‹åï¼ŒMethod Response ç»“æœä¼šè¿åŒ RpcServiceContext ä¸€èµ·ç”Ÿæˆ Result å¯¹è±¡ã€‚
æœåŠ¡ç«¯çš„ Result ç»“æœå¯¹è±¡ç»è¿‡åºåˆ—åŒ–åé€šè¿‡ç½‘ç»œä¼ è¾“å‘é€å›æ¶ˆè´¹ç«¯ï¼Œæ¶ˆè´¹ç«¯è§£æ Result ç”Ÿæˆ Method Response ç»“æœå’Œ RpcServiceContextï¼Œè¿”å›çœŸå®è°ƒç”¨ç»“æœå’Œä¸Šä¸‹æ–‡ç»™æ¶ˆè´¹ç«¯ã€‚&lt;/p>
&lt;blockquote>
&lt;p>path, group, version, dubbo, token, timeout å‡ ä¸ª key æ˜¯ä¿ç•™å­—æ®µï¼Œè¯·ä½¿ç”¨å…¶å®ƒå€¼ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>å†…éƒ¨ç³»ç»Ÿé€šè¿‡ Dubbo è°ƒç”¨æ—¶, traceId å¦‚ä½•é€ä¼ åˆ°æœåŠ¡æä¾›æ–¹ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;blockquote>
&lt;p>&lt;code>setAttachment&lt;/code> è®¾ç½®çš„ KV å¯¹ï¼Œåœ¨å®Œæˆä¸‹é¢ä¸€æ¬¡è¿œç¨‹è°ƒç”¨ä¼šè¢«æ¸…ç©ºï¼Œå³å¤šæ¬¡è¿œç¨‹è°ƒç”¨è¦å¤šæ¬¡è®¾ç½®ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="åœ¨æœåŠ¡æ¶ˆè´¹æ–¹ç«¯è®¾ç½®éšå¼å‚æ•°">åœ¨æœåŠ¡æ¶ˆè´¹æ–¹ç«¯è®¾ç½®éšå¼å‚æ•°&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>RpcContext.getClientAttachment().setAttachment(&lt;span style="color:#2aa198">&amp;#34;index&amp;#34;&lt;/span>, &lt;span style="color:#2aa198">&amp;#34;1&amp;#34;&lt;/span>); &lt;span style="color:#586e75">// éšå¼ä¼ å‚ï¼Œåé¢çš„è¿œç¨‹è°ƒç”¨éƒ½ä¼šéšå¼å°†è¿™äº›å‚æ•°å‘é€åˆ°æœåŠ¡å™¨ç«¯ï¼Œç±»ä¼¼cookieï¼Œç”¨äºæ¡†æ¶é›†æˆï¼Œä¸å»ºè®®å¸¸è§„ä¸šåŠ¡ä½¿ç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>xxxService.xxx(); &lt;span style="color:#586e75">// è¿œç¨‹è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// ...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åœ¨æœåŠ¡æä¾›æ–¹ç«¯è·å–éšå¼å‚æ•°">åœ¨æœåŠ¡æä¾›æ–¹ç«¯è·å–éšå¼å‚æ•°&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">XxxServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> XxxService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">xxx&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">// è·å–å®¢æˆ·ç«¯éšå¼ä¼ å…¥çš„å‚æ•°ï¼Œç”¨äºæ¡†æ¶é›†æˆï¼Œä¸å»ºè®®å¸¸è§„ä¸šåŠ¡ä½¿ç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String index &lt;span style="color:#719e07">=&lt;/span> RpcContext.getServerAttachment().getAttachment(&lt;span style="color:#2aa198">&amp;#34;index&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åœ¨æœåŠ¡æä¾›æ–¹å†™å…¥å›ä¼ å‚æ•°">åœ¨æœåŠ¡æä¾›æ–¹å†™å…¥å›ä¼ å‚æ•°&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">XxxServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> XxxService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">xxx&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String index &lt;span style="color:#719e07">=&lt;/span> xxx;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RpcContext.getServerContext().setAttachment(&lt;span style="color:#2aa198">&amp;#34;result&amp;#34;&lt;/span>, index);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åœ¨æ¶ˆè´¹ç«¯è·å–å›ä¼ å‚æ•°">åœ¨æ¶ˆè´¹ç«¯è·å–å›ä¼ å‚æ•°&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>xxxService.xxx(); &lt;span style="color:#586e75">// è¿œç¨‹è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>String result &lt;span style="color:#719e07">=&lt;/span> RpcContext.getServerContext().getAttachment(&lt;span style="color:#2aa198">&amp;#34;result&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// ...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>å‚æ•°é€ä¼ é—®é¢˜&lt;/p>
&lt;/blockquote>
&lt;p>åœ¨ Dubbo 2.7 ä¸­ï¼Œåœ¨ A ç«¯è®¾ç½®çš„å‚æ•°ï¼Œè°ƒç”¨ B ä»¥åï¼Œå¦‚æœ B ç»§ç»­è°ƒç”¨äº† Cï¼ŒåŸæ¥åœ¨ A ä¸­è®¾ç½®çš„å‚æ•°ä¹Ÿä¼šè¢«å¸¦åˆ° C ç«¯è¿‡å»ï¼Œé€ æˆå‚æ•°æ±¡æŸ“çš„é—®é¢˜ã€‚
Dubbo 3 å¯¹ RpcContext è¿›è¡Œäº†é‡æ„ï¼Œæ”¯æŒå¯é€‰å‚æ•°é€ä¼ ï¼Œé»˜è®¤å¼€å¯å‚æ•°é€ä¼ ã€‚&lt;/p>
&lt;p>åœ¨ Dubbo 3 ä¸­æä¾›äº†å¦‚ä¸‹çš„ SPIï¼Œé»˜è®¤æ— å®ç°ï¼Œç”¨æˆ·å¯ä»¥è‡ªè¡Œå®šä¹‰å®ç°ï¼Œ&lt;code>select&lt;/code> çš„ç»“æœï¼ˆå¯ä»¥ä» RpcClientAttachment è·å–å½“å‰æ‰€æœ‰å‚æ•°ï¼‰å°†ä½œä¸ºéœ€è¦é€ä¼ çš„é”®å€¼å¯¹ä¼ é€’åˆ°ä¸‹ä¸€è·³ï¼Œå¦‚æœè¿”å› null åˆ™è¡¨ç¤ºä¸é€ä¼ å‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@SPI&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">PenetrateAttachmentSelector&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> * Select some attachments to pass to next hop.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> * These attachments can fetch from {@link RpcContext#getServerAttachment()} or user defined.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> * @return attachment pass to next hop
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Map&lt;span style="color:#719e07">&amp;lt;&lt;/span>String, Object&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">select&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ä¸Šä¸‹æ–‡å‚æ•°ä¼ é€’">ä¸Šä¸‹æ–‡å‚æ•°ä¼ é€’&lt;/h2>
&lt;p>åœ¨ Dubbo 3 ä¸­ï¼ŒRpcContext è¢«æ‹†åˆ†ä¸ºå››å¤§æ¨¡å—ï¼ˆServerContextã€ClientAttachmentã€ServerAttachment å’Œ ServiceContextï¼‰ã€‚&lt;/p>
&lt;p>å®ƒä»¬åˆ†åˆ«æ‰¿æ‹…äº†ä¸åŒçš„èŒè´£ï¼š&lt;/p>
&lt;ul>
&lt;li>ServiceContextï¼šåœ¨ Dubbo å†…éƒ¨ä½¿ç”¨ï¼Œç”¨äºä¼ é€’è°ƒç”¨é“¾è·¯ä¸Šçš„å‚æ•°ä¿¡æ¯ï¼Œå¦‚ invoker å¯¹è±¡ç­‰&lt;/li>
&lt;li>ClientAttachmentï¼šåœ¨ Client ç«¯ä½¿ç”¨ï¼Œå¾€ ClientAttachment ä¸­å†™å…¥çš„å‚æ•°å°†è¢«ä¼ é€’åˆ° Server ç«¯&lt;/li>
&lt;li>ServerAttachmentï¼šåœ¨ Server ç«¯ä½¿ç”¨ï¼Œä» ServerAttachment ä¸­è¯»å–çš„å‚æ•°æ˜¯ä» Client ä¸­ä¼ é€’è¿‡æ¥çš„&lt;/li>
&lt;li>ServerContextï¼šåœ¨ Client ç«¯å’Œ Server ç«¯ä½¿ç”¨ï¼Œç”¨äºä» Server ç«¯å›ä¼  Client ç«¯ä½¿ç”¨ï¼ŒServer ç«¯å†™å…¥åˆ° ServerContext çš„å‚æ•°åœ¨è°ƒç”¨ç»“æŸåå¯ä»¥åœ¨ Client ç«¯çš„ ServerContext è·å–åˆ°&lt;/li>
&lt;/ul>
&lt;h2 id="ä½¿ç”¨åœºæ™¯-1">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>1ã€Dubboç³»ç»Ÿé—´è°ƒç”¨æ—¶ï¼Œæƒ³ä¼ é€’ä¸€äº›é€šç”¨å‚æ•°ï¼Œå¯é€šè¿‡Dubboæä¾›çš„æ‰©å±•å¦‚Filterç­‰å®ç°ç»Ÿä¸€çš„å‚æ•°ä¼ é€’&lt;/p>
&lt;p>2ã€Dubboç³»ç»Ÿé—´è°ƒç”¨æ—¶ï¼Œæƒ³ä¼ é€’æ¥å£å®šä¹‰ä¹‹å¤–çš„å‚æ•°ï¼Œå¯åœ¨è°ƒç”¨æ¥å£å‰ä½¿ç”¨setAttachmentä¼ é€’å‚æ•°ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨æ–¹å¼-1">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;p>setAttachment è®¾ç½®çš„ KV å¯¹ï¼Œåœ¨å®Œæˆä¸‹é¢ä¸€æ¬¡è¿œç¨‹è°ƒç”¨ä¼šè¢«æ¸…ç©ºï¼Œå³å¤šæ¬¡è¿œç¨‹è°ƒç”¨è¦å¤šæ¬¡è®¾ç½®ã€‚&lt;/p>
&lt;p>æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">ContextService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">invoke&lt;/span>(String param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœåŠ¡å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboService&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">ContextServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> ContextService{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">invoke&lt;/span>(String param) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//ServerAttachmentæ¥æ”¶å®¢æˆ·ç«¯ä¼ é€’è¿‡æ¥çš„å‚æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Map&lt;span style="color:#719e07">&amp;lt;&lt;/span>String, Object&lt;span style="color:#719e07">&amp;gt;&lt;/span> serverAttachments &lt;span style="color:#719e07">=&lt;/span> RpcContext.getServerAttachment().getObjectAttachments();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;ContextService serverAttachments:&amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> JSON.toJSONString(serverAttachments));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//å¾€å®¢æˆ·ç«¯ä¼ é€’å‚æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RpcContext.getServerContext().setAttachment(&lt;span style="color:#2aa198">&amp;#34;serverKey&amp;#34;&lt;/span>,&lt;span style="color:#2aa198">&amp;#34;serverValue&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StringBuilder s &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> StringBuilder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s.append(&lt;span style="color:#2aa198">&amp;#34;ContextService param:&amp;#34;&lt;/span>).append(param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> s.toString();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥å£è°ƒç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//å¾€æœåŠ¡ç«¯ä¼ é€’å‚æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RpcContext.getClientAttachment().setAttachment(&lt;span style="color:#2aa198">&amp;#34;clientKey1&amp;#34;&lt;/span>,&lt;span style="color:#2aa198">&amp;#34;clientValue1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String res &lt;span style="color:#719e07">=&lt;/span> contextService.invoke(&lt;span style="color:#2aa198">&amp;#34;context1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//æ¥æ”¶ä¼ é€’å›æ¥å‚æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Map&lt;span style="color:#719e07">&amp;lt;&lt;/span>String, Object&lt;span style="color:#719e07">&amp;gt;&lt;/span> clientAttachment &lt;span style="color:#719e07">=&lt;/span> RpcContext.getServerContext().getObjectAttachments();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;ContextTask clientAttachment:&amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> JSON.toJSONString(clientAttachment));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;ContextService Return : &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> res);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>&lt;font color='#FF7D00' size=4 > æ³¨æ„ &lt;/font>&lt;/em>&lt;/p>
&lt;blockquote>
&lt;p>path, group, version, dubbo, token, timeout å‡ ä¸ª key æ˜¯ä¿ç•™å­—æ®µï¼Œè¯·ä½¿ç”¨å…¶å®ƒå€¼ã€‚&lt;/p>
&lt;/blockquote></description></item><item><title>Overview: å¼€å‘æœåŠ¡</title><link>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/generic/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/generic/</guid><description>
&lt;h2 id="æ³›åŒ–è°ƒç”¨">æ³›åŒ–è°ƒç”¨&lt;/h2>
&lt;p>æ³›åŒ–è°ƒç”¨ï¼ˆå®¢æˆ·ç«¯æ³›åŒ–è°ƒç”¨ï¼‰æ˜¯æŒ‡åœ¨è°ƒç”¨æ–¹æ²¡æœ‰æœåŠ¡æ–¹æä¾›çš„ APIï¼ˆSDKï¼‰çš„æƒ…å†µä¸‹ï¼Œå¯¹æœåŠ¡æ–¹è¿›è¡Œè°ƒç”¨ï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸æ‹¿åˆ°è°ƒç”¨ç»“æœã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>è°ƒç”¨æ–¹æ²¡æœ‰æ¥å£åŠæ¨¡å‹ç±»å…ƒï¼ŒçŸ¥é“æœåŠ¡çš„æ¥å£çš„å…¨é™å®šç±»åå’Œæ–¹æ³•åçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡æ³›åŒ–è°ƒç”¨è°ƒç”¨å¯¹åº”æ¥å£ã€‚
æ¯”å¦‚ï¼šå®ç°ä¸€ä¸ªé€šç”¨çš„æœåŠ¡æµ‹è¯•æ¡†æ¶&lt;/p>
&lt;h2 id="ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;p>æœ¬ç¤ºä¾‹ä¸­ä½¿ç”¨&amp;quot;å‘å¸ƒå’Œè°ƒç”¨&amp;quot; ä¸­ç¤ºä¾‹ä»£ç &lt;/p>
&lt;p>æ¥å£å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">DevelopService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">invoke&lt;/span>(String param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥å£å®ç°1ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@DubboService&lt;/span>(group &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;group1&amp;#34;&lt;/span>,version &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;1.0&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">DevelopProviderServiceV1&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> DevelopService{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">invoke&lt;/span>(String param) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> StringBuilder s &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> StringBuilder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s.append(&lt;span style="color:#2aa198">&amp;#34;ServiceV1 param:&amp;#34;&lt;/span>).append(param);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> s.toString();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å®¢æˆ·ç«¯è°ƒç”¨">å®¢æˆ·ç«¯è°ƒç”¨&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">GenericTask&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> CommandLineRunner {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">run&lt;/span>(String... args) &lt;span style="color:#268bd2">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> GenericService genericService &lt;span style="color:#719e07">=&lt;/span> buildGenericService(&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.develop.DevelopService&amp;#34;&lt;/span>,&lt;span style="color:#2aa198">&amp;#34;group2&amp;#34;&lt;/span>,&lt;span style="color:#2aa198">&amp;#34;2.0&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//ä¼ å…¥éœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œå‚æ•°ç±»å‹åˆ—è¡¨ï¼Œå‚æ•°åˆ—è¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object result &lt;span style="color:#719e07">=&lt;/span> genericService.$invoke(&lt;span style="color:#2aa198">&amp;#34;invoke&amp;#34;&lt;/span>, &lt;span style="color:#719e07">new&lt;/span> String&lt;span style="color:#719e07">[]&lt;/span>{&lt;span style="color:#2aa198">&amp;#34;java.lang.String&amp;#34;&lt;/span>}, &lt;span style="color:#719e07">new&lt;/span> Object&lt;span style="color:#719e07">[]&lt;/span>{&lt;span style="color:#2aa198">&amp;#34;g1&amp;#34;&lt;/span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;GenericTask Response: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> JSON.toJSONString(result));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">private&lt;/span> GenericService &lt;span style="color:#268bd2">buildGenericService&lt;/span>(String interfaceClass, String group, String version) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ReferenceConfig&lt;span style="color:#719e07">&amp;lt;&lt;/span>GenericService&lt;span style="color:#719e07">&amp;gt;&lt;/span> reference &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ReferenceConfig&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> reference.setInterface(interfaceClass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> reference.setVersion(version);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//å¼€å¯æ³›åŒ–è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> reference.setGeneric(&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> reference.setTimeout(30000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> reference.setGroup(group);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ReferenceCache cache &lt;span style="color:#719e07">=&lt;/span> SimpleReferenceCache.getCache();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> cache.get(reference);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (Exception e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">throw&lt;/span> &lt;span style="color:#719e07">new&lt;/span> RuntimeException(e.getMessage());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç‰¹æ€§è¯´æ˜">ç‰¹æ€§è¯´æ˜&lt;/h2>
&lt;p>æ³›åŒ–è°ƒç”¨æ˜¯æŒ‡åœ¨è°ƒç”¨æ–¹æ²¡æœ‰æœåŠ¡æ–¹æä¾›çš„ APIï¼ˆSDKï¼‰çš„æƒ…å†µä¸‹ï¼Œå¯¹æœåŠ¡æ–¹è¿›è¡Œè°ƒç”¨ï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸æ‹¿åˆ°è°ƒç”¨ç»“æœã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨åœºæ™¯-1">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>æ³›åŒ–è°ƒç”¨ä¸»è¦ç”¨äºå®ç°ä¸€ä¸ªé€šç”¨çš„è¿œç¨‹æœåŠ¡ Mock æ¡†æ¶ï¼Œå¯é€šè¿‡å®ç° GenericService æ¥å£å¤„ç†æ‰€æœ‰æœåŠ¡è¯·æ±‚ã€‚æ¯”å¦‚å¦‚ä¸‹åœºæ™¯ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ç½‘å…³æœåŠ¡ï¼šå¦‚æœè¦æ­å»ºä¸€ä¸ªç½‘å…³æœåŠ¡ï¼Œé‚£ä¹ˆæœåŠ¡ç½‘å…³è¦ä½œä¸ºæ‰€æœ‰ RPC æœåŠ¡çš„è°ƒç”¨ç«¯ã€‚ä½†æ˜¯ç½‘å…³æœ¬èº«ä¸åº”è¯¥ä¾èµ–äºæœåŠ¡æä¾›æ–¹çš„æ¥å£ APIï¼ˆè¿™æ ·ä¼šå¯¼è‡´æ¯æœ‰ä¸€ä¸ªæ–°çš„æœåŠ¡å‘å¸ƒï¼Œå°±éœ€è¦ä¿®æ”¹ç½‘å…³çš„ä»£ç ä»¥åŠé‡æ–°éƒ¨ç½²ï¼‰ï¼Œæ‰€ä»¥éœ€è¦æ³›åŒ–è°ƒç”¨çš„æ”¯æŒã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æµ‹è¯•å¹³å°ï¼šå¦‚æœè¦æ­å»ºä¸€ä¸ªå¯ä»¥æµ‹è¯• RPC è°ƒç”¨çš„å¹³å°ï¼Œç”¨æˆ·è¾“å…¥åˆ†ç»„åã€æ¥å£ã€æ–¹æ³•åç­‰ä¿¡æ¯ï¼Œå°±å¯ä»¥æµ‹è¯•å¯¹åº”çš„ RPC æœåŠ¡ã€‚é‚£ä¹ˆç”±äºåŒæ ·çš„åŸå› ï¼ˆå³ä¼šå¯¼è‡´æ¯æœ‰ä¸€ä¸ªæ–°çš„æœåŠ¡å‘å¸ƒï¼Œå°±éœ€è¦ä¿®æ”¹ç½‘å…³çš„ä»£ç ä»¥åŠé‡æ–°éƒ¨ç½²ï¼‰ï¼Œæ‰€ä»¥å¹³å°æœ¬èº«ä¸åº”è¯¥ä¾èµ–äºæœåŠ¡æä¾›æ–¹çš„æ¥å£ APIã€‚æ‰€ä»¥éœ€è¦æ³›åŒ–è°ƒç”¨çš„æ”¯æŒã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="ä½¿ç”¨æ–¹å¼-1">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;p>demo å¯è§ &lt;a href="https://github.com/apache/dubbo-samples/tree/master/2-advanced/dubbo-samples-generic">dubbo é¡¹ç›®ä¸­çš„ç¤ºä¾‹ä»£ç &lt;/a>&lt;/p>
&lt;p>API éƒ¨åˆ†ä»¥æ­¤ demo ä¸ºä¾‹è®²è§£ä½¿ç”¨æ–¹å¼ã€‚&lt;/p>
&lt;h3 id="æœåŠ¡å®šä¹‰">æœåŠ¡å®šä¹‰&lt;/h3>
&lt;h4 id="æœåŠ¡æ¥å£">æœåŠ¡æ¥å£&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">interface&lt;/span> &lt;span style="color:#268bd2">HelloService&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHelloAsync&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>Person&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHelloAsyncComplex&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>GenericType&lt;span style="color:#719e07">&amp;lt;&lt;/span>Person&lt;span style="color:#719e07">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHelloAsyncGenericComplex&lt;/span>(String name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æœåŠ¡å®ç°ç±»">æœåŠ¡å®ç°ç±»&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">HelloServiceImpl&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> HelloService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">sayHello&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#2aa198">&amp;#34;sayHello: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHelloAsync&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> Thread(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(5000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future.complete(&lt;span style="color:#2aa198">&amp;#34;sayHelloAsync: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> future;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>Person&lt;span style="color:#719e07">&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHelloAsyncComplex&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Person person &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> Person(1, &lt;span style="color:#2aa198">&amp;#34;sayHelloAsyncComplex: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>Person&lt;span style="color:#719e07">&amp;gt;&lt;/span> future &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> Thread(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(5000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future.complete(person);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> future;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>GenericType&lt;span style="color:#719e07">&amp;lt;&lt;/span>Person&lt;span style="color:#719e07">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#268bd2">sayHelloAsyncGenericComplex&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Person person &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> Person(1, &lt;span style="color:#2aa198">&amp;#34;sayHelloAsyncGenericComplex: &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> GenericType&lt;span style="color:#719e07">&amp;lt;&lt;/span>Person&lt;span style="color:#719e07">&amp;gt;&lt;/span> genericType &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> GenericType&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>(person);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>GenericType&lt;span style="color:#719e07">&amp;lt;&lt;/span>Person&lt;span style="color:#719e07">&amp;gt;&amp;gt;&lt;/span> future &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> Thread(() &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.sleep(5000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#719e07">catch&lt;/span> (InterruptedException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e.printStackTrace();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future.complete(genericType);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }).start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> future;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é€šè¿‡apiä½¿ç”¨æ³›åŒ–è°ƒç”¨">é€šè¿‡APIä½¿ç”¨æ³›åŒ–è°ƒç”¨&lt;/h3>
&lt;h4 id="æœåŠ¡å¯åŠ¨æ–¹">æœåŠ¡å¯åŠ¨æ–¹&lt;/h4>
&lt;ol>
&lt;li>
&lt;p>åœ¨è®¾ç½® &lt;code>ServiceConfig&lt;/code> æ—¶ï¼Œä½¿ç”¨&lt;code>setGeneric(&amp;quot;true&amp;quot;)&lt;/code>æ¥å¼€å¯æ³›åŒ–è°ƒç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨è®¾ç½® &lt;code>ServiceConfig&lt;/code> æ—¶ï¼Œä½¿ç”¨ setRef æŒ‡å®šå®ç°ç±»æ—¶ï¼Œè¦è®¾ç½®ä¸€ä¸ª &lt;code>GenericService&lt;/code> çš„å¯¹è±¡ã€‚è€Œä¸æ˜¯çœŸæ­£çš„æœåŠ¡å®ç°ç±»å¯¹è±¡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å…¶ä»–è®¾ç½®ä¸æ­£å¸¸ Api æœåŠ¡å¯åŠ¨ä¸€è‡´å³å¯&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">private&lt;/span> &lt;span style="color:#268bd2">static&lt;/span> String zookeeperAddress &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;zookeeper://&amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> System.getProperty(&lt;span style="color:#2aa198">&amp;#34;zookeeper.address&amp;#34;&lt;/span>, &lt;span style="color:#2aa198">&amp;#34;127.0.0.1&amp;#34;&lt;/span>) &lt;span style="color:#719e07">+&lt;/span> &lt;span style="color:#2aa198">&amp;#34;:2181&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">static&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">main&lt;/span>(String&lt;span style="color:#719e07">[]&lt;/span> args) &lt;span style="color:#268bd2">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> EmbeddedZooKeeper(2181, &lt;span style="color:#cb4b16">false&lt;/span>).start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//åˆ›å»ºApplicationConfig&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ApplicationConfig applicationConfig &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ApplicationConfig();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> applicationConfig.setName(&lt;span style="color:#2aa198">&amp;#34;generic-impl-provider&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//åˆ›å»ºæ³¨å†Œä¸­å¿ƒé…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RegistryConfig registryConfig &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> RegistryConfig();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> registryConfig.setAddress(zookeeperAddress);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//æ–°å»ºæœåŠ¡å®ç°ç±»ï¼Œæ³¨æ„è¦ä½¿ç”¨GenericServiceæ¥æ”¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> GenericService helloService &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> GenericImplOfHelloService();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//åˆ›å»ºæœåŠ¡ç›¸å…³é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ServiceConfig&lt;span style="color:#719e07">&amp;lt;&lt;/span>GenericService&lt;span style="color:#719e07">&amp;gt;&lt;/span> service &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ServiceConfig&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> service.setApplication(applicationConfig);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> service.setRegistry(registryConfig);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> service.setInterface(&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.generic.call.api.HelloService&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> service.setRef(helloService);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//é‡ç‚¹ï¼šè®¾ç½®ä¸ºæ³›åŒ–è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//æ³¨ï¼šä¸å†æ¨èä½¿ç”¨å‚æ•°ä¸ºå¸ƒå°”å€¼çš„setGenericå‡½æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//åº”è¯¥ä½¿ç”¨referenceConfig.setGeneric(&amp;#34;true&amp;#34;)ä»£æ›¿&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> service.setGeneric(&lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> service.export();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.out.println(&lt;span style="color:#2aa198">&amp;#34;dubbo service started&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> CountDownLatch(1).await();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ³›åŒ–è°ƒç”¨æ–¹">æ³›åŒ–è°ƒç”¨æ–¹&lt;/h4>
&lt;p>æ­¥éª¤ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>åœ¨è®¾ç½® &lt;code>ReferenceConfig&lt;/code> æ—¶ï¼Œä½¿ç”¨ &lt;code>setGeneric(&amp;quot;true&amp;quot;)&lt;/code> æ¥å¼€å¯æ³›åŒ–è°ƒç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é…ç½®å®Œ &lt;code>ReferenceConfig&lt;/code> åï¼Œä½¿ç”¨ &lt;code>referenceConfig.get()&lt;/code> è·å–åˆ° &lt;code>GenericService&lt;/code> ç±»çš„å®ä¾‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨å…¶ &lt;code>$invoke&lt;/code> æ–¹æ³•è·å–ç»“æœ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å…¶ä»–è®¾ç½®ä¸æ­£å¸¸ Api æœåŠ¡å¯åŠ¨ä¸€è‡´å³å¯&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//å®šä¹‰æ³›åŒ–è°ƒç”¨æœåŠ¡ç±»&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">private&lt;/span> &lt;span style="color:#268bd2">static&lt;/span> GenericService genericService;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">static&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">main&lt;/span>(String&lt;span style="color:#719e07">[]&lt;/span> args) &lt;span style="color:#268bd2">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//åˆ›å»ºApplicationConfig&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ApplicationConfig applicationConfig &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ApplicationConfig();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> applicationConfig.setName(&lt;span style="color:#2aa198">&amp;#34;generic-call-consumer&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//åˆ›å»ºæ³¨å†Œä¸­å¿ƒé…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RegistryConfig registryConfig &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> RegistryConfig();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> registryConfig.setAddress(&lt;span style="color:#2aa198">&amp;#34;zookeeper://127.0.0.1:2181&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//åˆ›å»ºæœåŠ¡å¼•ç”¨é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ReferenceConfig&lt;span style="color:#719e07">&amp;lt;&lt;/span>GenericService&lt;span style="color:#719e07">&amp;gt;&lt;/span> referenceConfig &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ReferenceConfig&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//è®¾ç½®æ¥å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> referenceConfig.setInterface(&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.generic.call.api.HelloService&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> applicationConfig.setRegistry(registryConfig);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> referenceConfig.setApplication(applicationConfig);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//é‡ç‚¹ï¼šè®¾ç½®ä¸ºæ³›åŒ–è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//æ³¨ï¼šä¸å†æ¨èä½¿ç”¨å‚æ•°ä¸ºå¸ƒå°”å€¼çš„setGenericå‡½æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//åº”è¯¥ä½¿ç”¨referenceConfig.setGeneric(&amp;#34;true&amp;#34;)ä»£æ›¿&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> referenceConfig.setGeneric(&lt;span style="color:#cb4b16">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//è®¾ç½®å¼‚æ­¥ï¼Œä¸å¿…é¡»ï¼Œæ ¹æ®ä¸šåŠ¡è€Œå®šã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> referenceConfig.setAsync(&lt;span style="color:#cb4b16">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//è®¾ç½®è¶…æ—¶æ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> referenceConfig.setTimeout(7000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//è·å–æœåŠ¡ï¼Œç”±äºæ˜¯æ³›åŒ–è°ƒç”¨ï¼Œæ‰€ä»¥è·å–çš„ä¸€å®šæ˜¯GenericServiceç±»å‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> genericService &lt;span style="color:#719e07">=&lt;/span> referenceConfig.get();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//ä½¿ç”¨GenericServiceç±»å¯¹è±¡çš„$invokeæ–¹æ³•å¯ä»¥ä»£æ›¿åŸæ–¹æ³•ä½¿ç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦è°ƒç”¨çš„æ–¹æ³•å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//ç¬¬äºŒä¸ªå‚æ•°æ˜¯éœ€è¦è°ƒç”¨çš„æ–¹æ³•çš„å‚æ•°ç±»å‹æ•°ç»„ï¼Œä¸ºStringæ•°ç»„ï¼Œé‡Œé¢å­˜å…¥å‚æ•°çš„å…¨ç±»åã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯éœ€è¦è°ƒç”¨çš„æ–¹æ³•çš„å‚æ•°æ•°ç»„ï¼Œä¸ºObjectæ•°ç»„ï¼Œé‡Œé¢å­˜å…¥éœ€è¦çš„å‚æ•°ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object result &lt;span style="color:#719e07">=&lt;/span> genericService.$invoke(&lt;span style="color:#2aa198">&amp;#34;sayHello&amp;#34;&lt;/span>, &lt;span style="color:#719e07">new&lt;/span> String&lt;span style="color:#719e07">[]&lt;/span>{&lt;span style="color:#2aa198">&amp;#34;java.lang.String&amp;#34;&lt;/span>}, &lt;span style="color:#719e07">new&lt;/span> Object&lt;span style="color:#719e07">[]&lt;/span>{&lt;span style="color:#2aa198">&amp;#34;world&amp;#34;&lt;/span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//ä½¿ç”¨CountDownLatchï¼Œå¦‚æœä½¿ç”¨åŒæ­¥è°ƒç”¨åˆ™ä¸éœ€è¦è¿™ä¹ˆåšã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CountDownLatch latch &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> CountDownLatch(1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//è·å–ç»“æœ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CompletableFuture&lt;span style="color:#719e07">&amp;lt;&lt;/span>String&lt;span style="color:#719e07">&amp;gt;&lt;/span> future &lt;span style="color:#719e07">=&lt;/span> RpcContext.getContext().getCompletableFuture();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> future.whenComplete((value, t) &lt;span style="color:#719e07">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.err.println(&lt;span style="color:#2aa198">&amp;#34;invokeSayHello(whenComplete): &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> value);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> latch.countDown();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//æ‰“å°ç»“æœ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.err.println(&lt;span style="color:#2aa198">&amp;#34;invokeSayHello(return): &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> latch.await();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é€šè¿‡-spring-ä½¿ç”¨æ³›åŒ–è°ƒç”¨">é€šè¿‡ Spring ä½¿ç”¨æ³›åŒ–è°ƒç”¨&lt;/h3>
&lt;p>Spring ä¸­æœåŠ¡æš´éœ²ä¸æœåŠ¡å‘ç°æœ‰å¤šç§ä½¿ç”¨æ–¹å¼ï¼Œå¦‚ xmlï¼Œæ³¨è§£ã€‚è¿™é‡Œä»¥ xml ä¸ºä¾‹ã€‚
æ­¥éª¤ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ç”Ÿäº§è€…ç«¯æ— éœ€æ”¹åŠ¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¶ˆè´¹è€…ç«¯åŸæœ‰çš„ &lt;code>dubbo:reference&lt;/code> æ ‡ç­¾åŠ ä¸Š &lt;code>generic=true&lt;/code> çš„å±æ€§ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;helloService&amp;#34;&lt;/span> generic = &lt;span style="color:#2aa198">&amp;#34;true&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.samples.generic.call.api.HelloService&amp;#34;&lt;/span>&lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>
&lt;p>è·å–åˆ° Bean å®¹å™¨ï¼Œé€šè¿‡ Bean å®¹å™¨æ‹¿åˆ° &lt;code>GenericService&lt;/code> å®ä¾‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è°ƒç”¨ &lt;code>$invoke&lt;/code> æ–¹æ³•è·å–ç»“æœ&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">private&lt;/span> &lt;span style="color:#268bd2">static&lt;/span> GenericService genericService;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">static&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">main&lt;/span>(String&lt;span style="color:#719e07">[]&lt;/span> args) &lt;span style="color:#268bd2">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ClassPathXmlApplicationContext context &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ClassPathXmlApplicationContext(&lt;span style="color:#2aa198">&amp;#34;spring/generic-impl-consumer.xml&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> context.start();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//æœåŠ¡å¯¹åº”beançš„åå­—ç”±xmlæ ‡ç­¾çš„idå†³å®š&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> genericService &lt;span style="color:#719e07">=&lt;/span> context.getBean(&lt;span style="color:#2aa198">&amp;#34;helloService&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#586e75">//è·å¾—ç»“æœ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object result &lt;span style="color:#719e07">=&lt;/span> genericService.$invoke(&lt;span style="color:#2aa198">&amp;#34;sayHello&amp;#34;&lt;/span>, &lt;span style="color:#719e07">new&lt;/span> String&lt;span style="color:#719e07">[]&lt;/span>{&lt;span style="color:#2aa198">&amp;#34;java.lang.String&amp;#34;&lt;/span>}, &lt;span style="color:#719e07">new&lt;/span> Object&lt;span style="color:#719e07">[]&lt;/span>{&lt;span style="color:#2aa198">&amp;#34;world&amp;#34;&lt;/span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="protobuf-å¯¹è±¡æ³›åŒ–è°ƒç”¨">Protobuf å¯¹è±¡æ³›åŒ–è°ƒç”¨&lt;/h3>
&lt;p>ä¸€èˆ¬æ³›åŒ–è°ƒç”¨åªèƒ½ç”¨äºç”Ÿæˆçš„æœåŠ¡å‚æ•°ä¸º POJO çš„æƒ…å†µï¼Œè€Œ GoogleProtobuf çš„å¯¹è±¡æ˜¯åŸºäº Builder ç”Ÿæˆçš„éæ­£å¸¸ POJOï¼Œå¯ä»¥é€šè¿‡ protobuf-json æ³›åŒ–è°ƒç”¨ã€‚&lt;/p>
&lt;p>GoogleProtobuf åºåˆ—åŒ–ç›¸å…³çš„ Demo å¯ä»¥å‚è€ƒ &lt;a href="https://github.com/apache/dubbo-samples/tree/master/3-extensions/serialization/dubbo-samples-protobuf">protobuf-demo&lt;/a>&lt;/p>
&lt;h4 id="é€šè¿‡-spring-å¯¹-google-protobuf-å¯¹è±¡æ³›åŒ–è°ƒç”¨">é€šè¿‡ Spring å¯¹ Google Protobuf å¯¹è±¡æ³›åŒ–è°ƒç”¨&lt;/h4>
&lt;p>åœ¨ Spring ä¸­é…ç½®å£°æ˜ generic = &amp;ldquo;protobuf-json&amp;rdquo;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:reference&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;barService&amp;#34;&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.foo.BarService&amp;#34;&lt;/span> generic=&lt;span style="color:#2aa198">&amp;#34;protobuf-json&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ Java ä»£ç è·å– barService å¹¶å¼€å§‹æ³›åŒ–è°ƒç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>GenericService barService &lt;span style="color:#719e07">=&lt;/span> (GenericService) applicationContext.getBean(&lt;span style="color:#2aa198">&amp;#34;barService&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Object result &lt;span style="color:#719e07">=&lt;/span> barService.$invoke(&lt;span style="color:#2aa198">&amp;#34;sayHello&amp;#34;&lt;/span>,&lt;span style="color:#719e07">new&lt;/span> String&lt;span style="color:#719e07">[]&lt;/span>{&lt;span style="color:#2aa198">&amp;#34;org.apache.dubbo.protobuf.GooglePbBasic$CDubboGooglePBRequestType&amp;#34;&lt;/span>}, &lt;span style="color:#719e07">new&lt;/span> Object&lt;span style="color:#719e07">[]&lt;/span>{&lt;span style="color:#2aa198">&amp;#34;{\&amp;#34;double\&amp;#34;:0.0,\&amp;#34;float\&amp;#34;:0.0,\&amp;#34;bytesType\&amp;#34;:\&amp;#34;Base64String\&amp;#34;,\&amp;#34;int32\&amp;#34;:0}&amp;#34;&lt;/span>});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="é€šè¿‡-api-æ–¹å¼å¯¹-google-protobuf-å¯¹è±¡æ³›åŒ–è°ƒç”¨">é€šè¿‡ API æ–¹å¼å¯¹ Google Protobuf å¯¹è±¡æ³›åŒ–è°ƒç”¨&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>ReferenceConfig&lt;span style="color:#719e07">&amp;lt;&lt;/span>GenericService&lt;span style="color:#719e07">&amp;gt;&lt;/span> reference &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ReferenceConfig&lt;span style="color:#719e07">&amp;lt;&lt;/span>GenericService&lt;span style="color:#719e07">&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// å¼±ç±»å‹æ¥å£å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reference.setInterface(GenericService.class.getName());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reference.setInterface(&lt;span style="color:#2aa198">&amp;#34;com.xxx.XxxService&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// å£°æ˜ä¸ºProtobuf-json&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reference.setGeneric(Constants.GENERIC_SERIALIZATION_PROTOBUF);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>GenericService genericService &lt;span style="color:#719e07">=&lt;/span> reference.get();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Map&lt;span style="color:#719e07">&amp;lt;&lt;/span>String, Object&lt;span style="color:#719e07">&amp;gt;&lt;/span> person &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> HashMap&lt;span style="color:#719e07">&amp;lt;&lt;/span>String, Object&lt;span style="color:#719e07">&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>person.put(&lt;span style="color:#2aa198">&amp;#34;fixed64&amp;#34;&lt;/span>, &lt;span style="color:#2aa198">&amp;#34;0&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>person.put(&lt;span style="color:#2aa198">&amp;#34;int64&amp;#34;&lt;/span>, &lt;span style="color:#2aa198">&amp;#34;0&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// å‚è€ƒgoogleå®˜æ–¹çš„protobuf 3 çš„è¯­æ³•ï¼ŒæœåŠ¡çš„æ¯ä¸ªæ–¹æ³•ä¸­åªä¼ è¾“ä¸€ä¸ªPOJOå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// protobufçš„æ³›åŒ–è°ƒç”¨åªå…è®¸ä¼ é€’ä¸€ä¸ªç±»å‹ä¸ºStringçš„jsonå¯¹è±¡æ¥ä»£è¡¨è¯·æ±‚å‚æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>String requestString &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> Gson().toJson(person);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// è¿”å›å¯¹è±¡æ˜¯GoolgeProtobufå“åº”å¯¹è±¡çš„jsonå­—ç¬¦ä¸²ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Object result &lt;span style="color:#719e07">=&lt;/span> genericService.$invoke(&lt;span style="color:#2aa198">&amp;#34;sayHello&amp;#34;&lt;/span>, &lt;span style="color:#719e07">new&lt;/span> String&lt;span style="color:#719e07">[]&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#2aa198">&amp;#34;com.xxx.XxxService.GooglePbBasic$CDubboGooglePBRequestType&amp;#34;&lt;/span>},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">new&lt;/span> Object&lt;span style="color:#719e07">[]&lt;/span> {requestString});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="googleprotobuf-å¯¹è±¡çš„å¤„ç†">GoogleProtobuf å¯¹è±¡çš„å¤„ç†&lt;/h4>
&lt;p>GoogleProtobuf å¯¹è±¡æ˜¯ç”± Protocol å¥‘çº¦ç”Ÿæˆ,ç›¸å…³çŸ¥è¯†è¯·å‚è€ƒ &lt;a href="https://developers.google.com/protocol-buffers/?hl=zh-CN">ProtocolBuffers æ–‡æ¡£&lt;/a>ã€‚å‡å¦‚æœ‰å¦‚ä¸‹ Protobuf å¥‘çº¦&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-proto" data-lang="proto">&lt;span style="display:flex;">&lt;span>syntax &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">&amp;#34;proto3&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#719e07">package&lt;/span> com&lt;span style="color:#719e07">.&lt;/span>xxx.XxxService.GooglePbBasic.basic;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">message&lt;/span> &lt;span style="color:#268bd2">CDubboGooglePBRequestType&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">double&lt;/span> &lt;span style="color:#dc322f">double&lt;/span> &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">float&lt;/span> &lt;span style="color:#dc322f">float&lt;/span> &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">int32&lt;/span> &lt;span style="color:#dc322f">int32&lt;/span> &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">3&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">bool&lt;/span> &lt;span style="color:#dc322f">bool&lt;/span> &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">13&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">string&lt;/span> &lt;span style="color:#dc322f">string&lt;/span> &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">14&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">bytes&lt;/span> bytesType &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">15&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">message&lt;/span> &lt;span style="color:#268bd2">CDubboGooglePBResponseType&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">string&lt;/span> msg &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#2aa198">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">service&lt;/span> CDubboGooglePBService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">rpc&lt;/span> sayHello (CDubboGooglePBRequestType) &lt;span style="color:#719e07">returns&lt;/span> (CDubboGooglePBResponseType);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ™å¯¹åº”è¯·æ±‚æŒ‰ç…§å¦‚ä¸‹æ–¹æ³•æ„é€ &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>Map&lt;span style="color:#719e07">&amp;lt;&lt;/span>String, Object&lt;span style="color:#719e07">&amp;gt;&lt;/span> person &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> HashMap&lt;span style="color:#719e07">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>person.put(&lt;span style="color:#2aa198">&amp;#34;double&amp;#34;&lt;/span>, &lt;span style="color:#2aa198">&amp;#34;1.000&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>person.put(&lt;span style="color:#2aa198">&amp;#34;float&amp;#34;&lt;/span>, &lt;span style="color:#2aa198">&amp;#34;1.00&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>person.put(&lt;span style="color:#2aa198">&amp;#34;int32&amp;#34;&lt;/span>,&lt;span style="color:#2aa198">&amp;#34;1&amp;#34;&lt;/span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>person.put(&lt;span style="color:#2aa198">&amp;#34;bool&amp;#34;&lt;/span>,&lt;span style="color:#2aa198">&amp;#34;false&amp;#34;&lt;/span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">//String çš„å¯¹è±¡éœ€è¦ç»è¿‡base64ç¼–ç &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>person.put(&lt;span style="color:#2aa198">&amp;#34;string&amp;#34;&lt;/span>,&lt;span style="color:#2aa198">&amp;#34;someBaseString&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>person.put(&lt;span style="color:#2aa198">&amp;#34;bytesType&amp;#34;&lt;/span>,&lt;span style="color:#2aa198">&amp;#34;150&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="googleprotobuf-æœåŠ¡å…ƒæ•°æ®è§£æ">GoogleProtobuf æœåŠ¡å…ƒæ•°æ®è§£æ&lt;/h4>
&lt;p>Google Protobuf å¯¹è±¡ç¼ºå°‘æ ‡å‡†çš„ JSON æ ¼å¼ï¼Œç”Ÿæˆçš„æœåŠ¡å…ƒæ•°æ®ä¿¡æ¯å­˜åœ¨é”™è¯¯ã€‚è¯·æ·»åŠ å¦‚ä¸‹ä¾èµ–å…ƒæ•°æ®è§£æçš„ä¾èµ–ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;groupId&amp;gt;&lt;/span>org.apache.dubbo&lt;span style="color:#268bd2">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;artifactId&amp;gt;&lt;/span>dubbo-metadata-definition-protobuf&lt;span style="color:#268bd2">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">&amp;lt;version&amp;gt;&lt;/span>${dubbo.version}&lt;span style="color:#268bd2">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»æœåŠ¡å…ƒæ•°æ®ä¸­ä¹Ÿå¯ä»¥æ¯”è¾ƒå®¹æ˜“æ„å»ºæ³›åŒ–è°ƒç”¨å¯¹è±¡ã€‚&lt;/p>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">æ³¨æ„äº‹é¡¹&lt;/h4>
&lt;ol>
&lt;li>
&lt;p>å¦‚æœå‚æ•°ä¸ºåŸºæœ¬ç±»å‹æˆ–è€… Date,List,Map ç­‰ï¼Œåˆ™ä¸éœ€è¦è½¬æ¢ï¼Œç›´æ¥è°ƒç”¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœå‚æ•°ä¸ºå…¶ä»– POJOï¼Œåˆ™ä½¿ç”¨ Map ä»£æ›¿ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div>
&lt;p>å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">Student&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dc322f">int&lt;/span> age;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> String &lt;span style="color:#268bd2">getName&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">setName&lt;/span>(String name) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">this&lt;/span>.name &lt;span style="color:#719e07">=&lt;/span> name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#dc322f">int&lt;/span> &lt;span style="color:#268bd2">getAge&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> age;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#dc322f">void&lt;/span> &lt;span style="color:#268bd2">setAge&lt;/span>(&lt;span style="color:#dc322f">int&lt;/span> age) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">this&lt;/span>.age &lt;span style="color:#719e07">=&lt;/span> age;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è°ƒç”¨æ—¶åº”è¯¥è½¬æ¢ä¸ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>Map&lt;span style="color:#719e07">&amp;lt;&lt;/span>String, Object&lt;span style="color:#719e07">&amp;gt;&lt;/span> student &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> HashMap&lt;span style="color:#719e07">&amp;lt;&lt;/span>String, Object&lt;span style="color:#719e07">&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>student.put(&lt;span style="color:#2aa198">&amp;#34;name&amp;#34;&lt;/span>, &lt;span style="color:#2aa198">&amp;#34;xxx&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>student.put(&lt;span style="color:#2aa198">&amp;#34;age&amp;#34;&lt;/span>, &lt;span style="color:#2aa198">&amp;#34;xxx&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>å¯¹äºå…¶ä»–åºåˆ—åŒ–æ ¼å¼ï¼Œéœ€è¦ç‰¹æ®Šé…ç½®&lt;/li>
&lt;/ol>
&lt;h2 id="ç‰¹æ€§è¯´æ˜-1">ç‰¹æ€§è¯´æ˜&lt;/h2>
&lt;p>æ³›æ¥å£å®ç°æ–¹å¼ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯æ²¡æœ‰ API æ¥å£åŠæ¨¡å‹ç±»å…ƒçš„æƒ…å†µï¼Œå‚æ•°åŠè¿”å›å€¼ä¸­çš„æ‰€æœ‰ POJO å‡ç”¨ Map è¡¨ç¤ºï¼Œé€šå¸¸ç”¨äºæ¡†æ¶é›†æˆï¼Œæ¯”å¦‚ï¼šå®ç°ä¸€ä¸ªé€šç”¨çš„è¿œç¨‹æœåŠ¡ Mock æ¡†æ¶ï¼Œå¯é€šè¿‡å®ç° GenericService æ¥å£å¤„ç†æ‰€æœ‰æœåŠ¡è¯·æ±‚ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨åœºæ™¯-2">ä½¿ç”¨åœºæ™¯&lt;/h2>
&lt;p>æ³¨å†ŒæœåŠ¡: æœåŠ¡æä¾›è€…åœ¨æœåŠ¡æ³¨å†Œè¡¨ä¸­æ³¨å†ŒæœåŠ¡ï¼Œä¾‹å¦‚ Zookeeperï¼ŒæœåŠ¡æ³¨å†Œè¡¨å­˜å‚¨æœ‰å…³æœåŠ¡çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å…¶æ¥å£ã€å®ç°ç±»å’Œåœ°å€ã€‚&lt;/p>
&lt;p>éƒ¨ç½²æœåŠ¡: æœåŠ¡æä¾›å•†å°†æœåŠ¡éƒ¨ç½²åœ¨æœåŠ¡å™¨å¹¶ä½¿å…¶å¯¹æ¶ˆè´¹è€…å¯ç”¨ã€‚&lt;/p>
&lt;p>è°ƒç”¨æœåŠ¡: ä½¿ç”¨è€…ä½¿ç”¨æœåŠ¡æ³¨å†Œè¡¨ç”Ÿæˆçš„ä»£ç†è°ƒç”¨æœåŠ¡ï¼Œä»£ç†å°†è¯·æ±‚è½¬å‘ç»™æœåŠ¡æä¾›å•†ï¼ŒæœåŠ¡æä¾›å•†æ‰§è¡ŒæœåŠ¡å¹¶å°†å“åº”å‘é€å›æ¶ˆè´¹è€…ã€‚&lt;/p>
&lt;p>ç›‘è§†æœåŠ¡ï¼šæä¾›è€…å’Œä½¿ç”¨è€…å¯ä»¥ä½¿ç”¨ Dubbo æ¡†æ¶ç›‘è§†æœåŠ¡ï¼Œå…è®¸ä»–ä»¬æŸ¥çœ‹æœåŠ¡çš„æ‰§è¡Œæƒ…å†µï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œè°ƒæ•´ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨æ–¹å¼-2">ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;p>åœ¨ Java ä»£ç ä¸­å®ç° &lt;code>GenericService&lt;/code> æ¥å£&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#719e07">package&lt;/span> com.foo;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">public&lt;/span> &lt;span style="color:#268bd2">class&lt;/span> &lt;span style="color:#268bd2">MyGenericService&lt;/span> &lt;span style="color:#268bd2">implements&lt;/span> GenericService {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#268bd2">public&lt;/span> Object &lt;span style="color:#268bd2">$invoke&lt;/span>(String methodName, String&lt;span style="color:#719e07">[]&lt;/span> parameterTypes, Object&lt;span style="color:#719e07">[]&lt;/span> args) &lt;span style="color:#268bd2">throws&lt;/span> GenericException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">if&lt;/span> (&lt;span style="color:#2aa198">&amp;#34;sayHello&amp;#34;&lt;/span>.equals(methodName)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#719e07">return&lt;/span> &lt;span style="color:#2aa198">&amp;#34;Welcome &amp;#34;&lt;/span> &lt;span style="color:#719e07">+&lt;/span> args&lt;span style="color:#719e07">[&lt;/span>0&lt;span style="color:#719e07">]&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é€šè¿‡-spring-æš´éœ²æ³›åŒ–å®ç°">é€šè¿‡ Spring æš´éœ²æ³›åŒ–å®ç°&lt;/h3>
&lt;p>åœ¨ Spring é…ç½®ç”³æ˜æœåŠ¡çš„å®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;bean&lt;/span> id=&lt;span style="color:#2aa198">&amp;#34;genericService&amp;#34;&lt;/span> class=&lt;span style="color:#2aa198">&amp;#34;com.foo.MyGenericService&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#268bd2">&amp;lt;dubbo:service&lt;/span> interface=&lt;span style="color:#2aa198">&amp;#34;com.foo.BarService&amp;#34;&lt;/span> ref=&lt;span style="color:#2aa198">&amp;#34;genericService&amp;#34;&lt;/span> &lt;span style="color:#268bd2">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é€šè¿‡-api-æ–¹å¼æš´éœ²æ³›åŒ–å®ç°">é€šè¿‡ API æ–¹å¼æš´éœ²æ³›åŒ–å®ç°&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// ç”¨org.apache.dubbo.rpc.service.GenericServiceå¯ä»¥æ›¿ä»£æ‰€æœ‰æ¥å£å®ç°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>GenericService xxxService &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> XxxGenericService();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// è¯¥å®ä¾‹å¾ˆé‡é‡ï¼Œé‡Œé¢å°è£…äº†æ‰€æœ‰ä¸æ³¨å†Œä¸­å¿ƒåŠæœåŠ¡æä¾›æ–¹è¿æ¥ï¼Œè¯·ç¼“å­˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ServiceConfig&lt;span style="color:#719e07">&amp;lt;&lt;/span>GenericService&lt;span style="color:#719e07">&amp;gt;&lt;/span> service &lt;span style="color:#719e07">=&lt;/span> &lt;span style="color:#719e07">new&lt;/span> ServiceConfig&lt;span style="color:#719e07">&amp;lt;&lt;/span>GenericService&lt;span style="color:#719e07">&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// å¼±ç±»å‹æ¥å£å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service.setInterface(&lt;span style="color:#2aa198">&amp;#34;com.xxx.XxxService&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service.setVersion(&lt;span style="color:#2aa198">&amp;#34;1.0.0&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// æŒ‡å‘ä¸€ä¸ªé€šç”¨æœåŠ¡å®ç°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service.setRef(xxxService);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#586e75">// æš´éœ²åŠæ³¨å†ŒæœåŠ¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service.export();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Overview: Dubbo ä½œä¸ºè½»é‡ RPC æ¡†æ¶è§£å†³ç»„ä»¶é€šä¿¡é—®é¢˜</title><link>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/more/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/more/</guid><description/></item></channel></rss>